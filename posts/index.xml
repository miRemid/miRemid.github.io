<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on ç‹¸çŒ«çª</title><link>https://blog.thinkmoe.icu/posts/</link><description>Recent content in Posts on ç‹¸çŒ«çª</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><copyright>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</copyright><lastBuildDate>Thu, 16 Mar 2023 10:40:57 +0800</lastBuildDate><atom:link href="https://blog.thinkmoe.icu/posts/index.xml" rel="self" type="application/rss+xml"/><item><title>è¯¡å¼‚çš„nerdctlç«¯å£è½¬å‘é—®é¢˜</title><link>https://blog.thinkmoe.icu/posts/%E8%AF%A1%E5%BC%82%E7%9A%84nerdctl%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E9%97%AE%E9%A2%98/</link><pubDate>Thu, 16 Mar 2023 10:40:57 +0800</pubDate><guid>https://blog.thinkmoe.icu/posts/%E8%AF%A1%E5%BC%82%E7%9A%84nerdctl%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E9%97%AE%E9%A2%98/</guid><description>æ²¡æœ‰ä»€ä¹ˆæ˜¯é‡å¯è§£å†³ä¸äº†çš„ï¼Œå¦‚æœæœ‰é‚£å°±é‡å¯ä¸¤æ¬¡å§ ç”±äºæŸäº›åŸå› ï¼Œéœ€è¦ä»Dockerè½¬åˆ°containerdä¸Šé¢æ¥ï¼Œä¸ºäº†ä¿æŒå’ŒDockerç›¸åŒçš„ä½“</description><content type="html"><![CDATA[<blockquote>
<p>æ²¡æœ‰ä»€ä¹ˆæ˜¯é‡å¯è§£å†³ä¸äº†çš„ï¼Œå¦‚æœæœ‰é‚£å°±é‡å¯ä¸¤æ¬¡å§</p>
</blockquote>
<p>ç”±äºæŸäº›åŸå› ï¼Œéœ€è¦ä»Dockerè½¬åˆ°containerdä¸Šé¢æ¥ï¼Œä¸ºäº†ä¿æŒå’ŒDockerç›¸åŒçš„ä½“éªŒé€‰æ‹©Nerdctlä½œä¸ºcliå·¥å…·</p>
<p>ä½†æ˜¯åœ¨å®‰è£…ä¹‹åè¿è¡Œç®€å•çš„nginxæµ‹è¯•æ—¶å‡ºç°äº†ç½‘ç»œé—®é¢˜</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">nerdctl pull nginx:alpine
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">nerdctl run -d --name nginx -p 80:80 nginx:alpine
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">âœ  ~ nerdctl ps
</span></span><span class="line"><span class="cl">CONTAINER ID    IMAGE                             COMMAND                   CREATED          STATUS    PORTS                 NAMES
</span></span><span class="line"><span class="cl">25ec8773aa63    docker.io/library/nginx:alpine    <span class="s2">&#34;/docker-entrypoint.â€¦&#34;</span>    <span class="m">5</span> minutes ago    Up        0.0.0.0:80-&gt;80/tcp    nginx
</span></span></code></pre></div><p>ä»æ‰“å°çš„æ—¥å¿—ä¸Šæ¥çœ‹ï¼Œå½“å‰Nerdctlå·²ç»å°†nginxå®¹å™¨çš„80ç«¯å£è½¬å‘åˆ°å®¿ä¸»æœºçš„80ç«¯å£ï¼Œåœ¨å®¿ä¸»æœºçš„shellä¸­ä½¿ç”¨curlè®¿é—®80ç«¯å£ä¹Ÿèƒ½æ­£å¸¸è®¿é—®</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">âœ  ~ curl http://localhost:80
</span></span><span class="line"><span class="cl">&lt;!DOCTYPE html&gt;
</span></span><span class="line"><span class="cl">&lt;html&gt;
</span></span><span class="line"><span class="cl">&lt;head&gt;
</span></span><span class="line"><span class="cl">&lt;title&gt;Welcome to nginx!&lt;/title&gt;
</span></span><span class="line"><span class="cl">&lt;style&gt;
</span></span><span class="line"><span class="cl">html <span class="o">{</span> color-scheme: light dark<span class="p">;</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl">body <span class="o">{</span> width: 35em<span class="p">;</span> margin: <span class="m">0</span> auto<span class="p">;</span>
</span></span><span class="line"><span class="cl">font-family: Tahoma, Verdana, Arial, sans-serif<span class="p">;</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl">&lt;/style&gt;
</span></span><span class="line"><span class="cl">&lt;/head&gt;
</span></span><span class="line"><span class="cl">&lt;body&gt;
</span></span><span class="line"><span class="cl">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
</span></span><span class="line"><span class="cl">&lt;p&gt;If you see this page, the nginx web server is successfully installed and
</span></span><span class="line"><span class="cl">working. Further configuration is required.&lt;/p&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;p&gt;For online documentation and support please refer to
</span></span><span class="line"><span class="cl">&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&#34;http://nginx.org/&#34;</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
</span></span><span class="line"><span class="cl">Commercial support is available at
</span></span><span class="line"><span class="cl">&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&#34;http://nginx.com/&#34;</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;p&gt;&lt;em&gt;Thank you <span class="k">for</span> using nginx.&lt;/em&gt;&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;/body&gt;
</span></span><span class="line"><span class="cl">&lt;/html&gt;
</span></span></code></pre></div><p>ä½†æ˜¯ä»å®¿ä¸»æœºå¤–éƒ¨è®¿é—®æ—¶ï¼Œå´æ€ä¹ˆä¹Ÿè®¿é—®ä¸åˆ°</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl http://10.0.8.9:80
</span></span></code></pre></div><p>ä½†æ˜¯æˆ‘æ¢Dockeråˆ™ä¸€åˆ‡æ­£å¸¸</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker pull nginx:alpine
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">docker run -d --name nginx -p 80:80 nginx:alpine
</span></span><span class="line"><span class="cl">curl http://10.0.8.9:80
</span></span></code></pre></div><p>æ£€æŸ¥iptableså¯ä»¥å‘ç°ï¼Œnerdctlå·²ç»å¸®æˆ‘ä»¬æŠŠnerdctlåˆ›å»ºçš„ç½‘æ¡¥è½¬å‘å‡ºå»äº†</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># è¿™æ˜¯è¿˜æ²¡åˆ›å»ºå®¹å™¨æ—¶çš„iptables</span>
</span></span><span class="line"><span class="cl">âœ  ~ iptables --list-rules
</span></span><span class="line"><span class="cl">-P INPUT ACCEPT
</span></span><span class="line"><span class="cl">-P FORWARD DROP
</span></span><span class="line"><span class="cl">-P OUTPUT ACCEPT
</span></span><span class="line"><span class="cl">-N CNI-ADMIN
</span></span><span class="line"><span class="cl">-N CNI-FORWARD
</span></span><span class="line"><span class="cl">-N CNI-ISOLATION-STAGE-1
</span></span><span class="line"><span class="cl">-N CNI-ISOLATION-STAGE-2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-A FORWARD -m comment --comment <span class="s2">&#34;CNI firewall plugin rules (ingressPolicy: same-bridge)&#34;</span> -j CNI-ISOLATION-STAGE-1
</span></span><span class="line"><span class="cl">-A FORWARD -m comment --comment <span class="s2">&#34;CNI firewall plugin rules&#34;</span> -j CNI-FORWARD
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-A CNI-FORWARD -m comment --comment <span class="s2">&#34;CNI firewall plugin admin overrides&#34;</span> -j CNI-ADMIN
</span></span><span class="line"><span class="cl">-A CNI-ISOLATION-STAGE-1 -i nerdctl0 ! -o nerdctl0 -m comment --comment <span class="s2">&#34;CNI firewall plugin rules (ingressPolicy: same-bridge)&#34;</span> -j CNI-ISOLATION-STAGE-2
</span></span><span class="line"><span class="cl">-A CNI-ISOLATION-STAGE-1 -m comment --comment <span class="s2">&#34;CNI firewall plugin rules (ingressPolicy: same-bridge)&#34;</span> -j RETURN
</span></span><span class="line"><span class="cl">-A CNI-ISOLATION-STAGE-2 -o nerdctl0 -m comment --comment <span class="s2">&#34;CNI firewall plugin rules (ingressPolicy: same-bridge)&#34;</span> -j DROP
</span></span><span class="line"><span class="cl">-A CNI-ISOLATION-STAGE-2 -m comment --comment <span class="s2">&#34;CNI firewall plugin rules (ingressPolicy: same-bridge)&#34;</span> -j RETURN
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å½“åˆ›å»ºnginxå®¹å™¨ä¹‹åçš„iptables</span>
</span></span><span class="line"><span class="cl">-P INPUT ACCEPT
</span></span><span class="line"><span class="cl">-P FORWARD DROP
</span></span><span class="line"><span class="cl">-P OUTPUT ACCEPT
</span></span><span class="line"><span class="cl">-N CNI-ADMIN
</span></span><span class="line"><span class="cl">-N CNI-FORWARD
</span></span><span class="line"><span class="cl">-N CNI-ISOLATION-STAGE-1
</span></span><span class="line"><span class="cl">-N CNI-ISOLATION-STAGE-2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-A FORWARD -m comment --comment <span class="s2">&#34;CNI firewall plugin rules (ingressPolicy: same-bridge)&#34;</span> -j CNI-ISOLATION-STAGE-1
</span></span><span class="line"><span class="cl">-A FORWARD -m comment --comment <span class="s2">&#34;CNI firewall plugin rules&#34;</span> -j CNI-FORWARD
</span></span><span class="line"><span class="cl">-A FORWARD -j DOCKER-USER
</span></span><span class="line"><span class="cl">-A FORWARD -j DOCKER-ISOLATION-STAGE-1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-A CNI-FORWARD -m comment --comment <span class="s2">&#34;CNI firewall plugin admin overrides&#34;</span> -j CNI-ADMIN
</span></span><span class="line"><span class="cl">-A CNI-FORWARD -d 10.4.0.8/32 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
</span></span><span class="line"><span class="cl">-A CNI-FORWARD -s 10.4.0.8/32 -j ACCEPT
</span></span><span class="line"><span class="cl">-A CNI-ISOLATION-STAGE-1 -i nerdctl0 ! -o nerdctl0 -m comment --comment <span class="s2">&#34;CNI firewall plugin rules (ingressPolicy: same-bridge)&#34;</span> -j CNI-ISOLATION-STAGE-2
</span></span><span class="line"><span class="cl">-A CNI-ISOLATION-STAGE-1 -m comment --comment <span class="s2">&#34;CNI firewall plugin rules (ingressPolicy: same-bridge)&#34;</span> -j RETURN
</span></span><span class="line"><span class="cl">-A CNI-ISOLATION-STAGE-2 -o nerdctl0 -m comment --comment <span class="s2">&#34;CNI firewall plugin rules (ingressPolicy: same-bridge)&#34;</span> -j DROP
</span></span><span class="line"><span class="cl">-A CNI-ISOLATION-STAGE-2 -m comment --comment <span class="s2">&#34;CNI firewall plugin rules (ingressPolicy: same-bridge)&#34;</span> -j RETURN
</span></span></code></pre></div><p>å¯ä»¥å‘ç°ï¼Œnerdctlå¸®åŠ©æˆ‘ä»¬ä¸ºnginxå®¹å™¨åˆ›å»ºäº†ä¸¤æ¡iptablesè§„åˆ™ï¼Œæ£€æŸ¥nginxå®¹å™¨çš„ipåœ°å€å¯ä»¥å‘ç°ä¸ä¸Šè¿°è§„åˆ™æ˜¯å¯¹åº”çš„</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">âœ  ~ nerdctl inspect nginx
</span></span><span class="line"><span class="cl"><span class="o">[</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Id&#34;</span>: <span class="s2">&#34;029f32038d2ab668cae206620b83f143fa799638d6fd623808aa55175825b251&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Created&#34;</span>: <span class="s2">&#34;2023-03-16T02:58:34.799160852Z&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Path&#34;</span>: <span class="s2">&#34;/docker-entrypoint.sh&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Args&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;nginx&#34;</span>,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;-g&#34;</span>,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;daemon off;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="o">]</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;State&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Status&#34;</span>: <span class="s2">&#34;running&#34;</span>,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Running&#34;</span>: true,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Paused&#34;</span>: false,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Restarting&#34;</span>: false,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Pid&#34;</span>: 1552,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;ExitCode&#34;</span>: 0,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;FinishedAt&#34;</span>: <span class="s2">&#34;0001-01-01T00:00:00Z&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Image&#34;</span>: <span class="s2">&#34;docker.io/library/nginx:alpine&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ResolvConfPath&#34;</span>: <span class="s2">&#34;/var/lib/nerdctl/1935db59/containers/default/029f32038d2ab668cae206620b83f143fa799638d6fd623808aa55175825b251/resolv.conf&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;HostnamePath&#34;</span>: <span class="s2">&#34;/var/lib/nerdctl/1935db59/containers/default/029f32038d2ab668cae206620b83f143fa799638d6fd623808aa55175825b251/hostname&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;LogPath&#34;</span>: <span class="s2">&#34;/var/lib/nerdctl/1935db59/containers/default/029f32038d2ab668cae206620b83f143fa799638d6fd623808aa55175825b251/029f32038d2ab668cae206620b83f143fa799638d6fd623808aa55175825b251-json.log&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Name&#34;</span>: <span class="s2">&#34;nginx&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;RestartCount&#34;</span>: 0,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Driver&#34;</span>: <span class="s2">&#34;overlayfs&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Platform&#34;</span>: <span class="s2">&#34;linux&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;AppArmorProfile&#34;</span>: <span class="s2">&#34;&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Mounts&#34;</span>: null,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Config&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">          ...
</span></span><span class="line"><span class="cl">        <span class="o">}</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;NetworkSettings&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Ports&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;80/tcp&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl">                    <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;HostIp&#34;</span>: <span class="s2">&#34;0.0.0.0&#34;</span>,
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;HostPort&#34;</span>: <span class="s2">&#34;80&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="o">]</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;GlobalIPv6Address&#34;</span>: <span class="s2">&#34;&#34;</span>,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;GlobalIPv6PrefixLen&#34;</span>: 0,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;IPAddress&#34;</span>: <span class="s2">&#34;10.4.0.8&#34;</span>,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;IPPrefixLen&#34;</span>: 24,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;MacAddress&#34;</span>: <span class="s2">&#34;02:52:2f:d9:d2:52&#34;</span>,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Networks&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;unknown-eth0&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;IPAddress&#34;</span>: <span class="s2">&#34;10.4.0.8&#34;</span>, <span class="c1"># IPåœ°å€</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;IPPrefixLen&#34;</span>: 24,
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;GlobalIPv6Address&#34;</span>: <span class="s2">&#34;&#34;</span>,
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;GlobalIPv6PrefixLen&#34;</span>: 0,
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;MacAddress&#34;</span>: <span class="s2">&#34;02:52:2f:d9:d2:52&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">]</span>
</span></span></code></pre></div><p>æŒ‰é“ç†æŒ‰ç…§è§„åˆ™<code>-A CNI-FORWARD -s 10.4.0.8/32 -j ACCEPT</code>å·²ç»å¯ä»¥ä»å¤–éƒ¨è®¿é—®80ç«¯å£çš„æœåŠ¡äº†ï¼Œä½†æ˜¯æ€ä¹ˆéƒ½è¡Œä¸é€šï¼Œæ‰€ä»¥å¹²è„†æ‰‹åŠ¨æ·»åŠ ä¸€æ¡iptableè§„åˆ™å§ï¼Œç›´æ¥æŒ‡å®šè½¬å‘80ç«¯å£å‡ºå»</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">âœ  ~ iptables -A CNI-FORWARD -p tcp -m tcp --dport <span class="m">80</span> -j ACCEPT
</span></span></code></pre></div><p>è¿™æ—¶ï¼Œè®¿é—®å¯¹åº”åœ°å€çš„80ç«¯å£å°±å¯ä»¥è®¿é—®æœåŠ¡äº†ï¼Œä½†è¿™æ˜æ˜¾åªæ˜¯ä¸€ä¸ªä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼Œé‚£å¦‚ä½•å½»åº•è§£å†³å‘¢ï¼Ÿç›´åˆ°æˆ‘æ‰¾åˆ°è¿™ä¸ª<a href="https://github.com/containerd/nerdctl/issues/1048#issuecomment-1325991013">issue</a>&hellip;</p>
<p>æ²¡æœ‰ä»€ä¹ˆæ˜¯é‡å¯è§£å†³ä¸äº†çš„ï¼Œå¦‚æœæœ‰é‚£å°±é‡å¯ä¸¤æ¬¡ï¼é‡å¯ä¹‹åï¼Œåˆ é™¤åˆšæ‰ä¸´æ—¶æ·»åŠ çš„iptableä¹‹åæµ‹è¯•ç›´æ¥å¯åŠ¨nginxæœåŠ¡ï¼Œå‘ç°å°±å¯ä»¥ä»å¤–éƒ¨è®¿é—®äº†ğŸ¤£</p>
]]></content></item><item><title>TopKé¢è¯•é¢˜1</title><link>https://blog.thinkmoe.icu/posts/topk%E9%9D%A2%E8%AF%95%E9%A2%981/</link><pubDate>Thu, 09 Mar 2023 14:42:35 +0800</pubDate><guid>https://blog.thinkmoe.icu/posts/topk%E9%9D%A2%E8%AF%95%E9%A2%981/</guid><description>TopKæ¥æº ä½¿ç”¨é€’å½’åŠéé€’å½’ä¸¤ç§æ–¹å¼å®ç°å¿«é€Ÿæ’åº å¿«æ’æ€æƒ³ï¼Œé€‰å–ä¸€ä¸ªå“¨å…µèŠ‚ç‚¹ï¼Œä»å·¦è¾¹å¯»æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯”å“¨å…µå¤§çš„èŠ‚ç‚¹ï¼Œä»å³è¾¹å¯»æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯”å“¨å…µå°çš„èŠ‚</description><content type="html"><![CDATA[<blockquote>
<p><a href="https://osjobs.net/topk/all/">TopKæ¥æº</a></p>
</blockquote>
<h2 id="ä½¿ç”¨é€’å½’åŠéé€’å½’ä¸¤ç§æ–¹å¼å®ç°å¿«é€Ÿæ’åº">ä½¿ç”¨é€’å½’åŠéé€’å½’ä¸¤ç§æ–¹å¼å®ç°å¿«é€Ÿæ’åº</h2>
<p>å¿«æ’æ€æƒ³ï¼Œé€‰å–ä¸€ä¸ªå“¨å…µèŠ‚ç‚¹ï¼Œä»å·¦è¾¹å¯»æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯”å“¨å…µå¤§çš„èŠ‚ç‚¹ï¼Œä»å³è¾¹å¯»æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯”å“¨å…µå°çš„èŠ‚ç‚¹ï¼Œäº¤æ¢ä¸¤è€…ä½ç½®ã€‚
å¦‚æœå¯»æ‰¾è¿‡ç¨‹ä¸­æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„å…ƒç´ ï¼Œåˆ™è¯´æ˜æ’åºå·²ç»å®Œæˆ</p>
<p>é¦–å…ˆæ˜¯é€’å½’çš„æ–¹å¼</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-golang" data-lang="golang"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">quick_sort</span><span class="p">(</span><span class="nx">nums</span> <span class="p">[]</span><span class="kt">int</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nf">_quick_sort</span><span class="p">(</span><span class="nx">nums</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">_quick_sort</span><span class="p">(</span><span class="nx">nums</span> <span class="p">[]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">right</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">left</span> <span class="o">&gt;=</span> <span class="nx">right</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">k</span> <span class="o">:=</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">right</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nx">l</span><span class="p">,</span> <span class="nx">r</span> <span class="o">:=</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">right</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">l</span> <span class="p">&lt;</span> <span class="nx">r</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="nx">l</span> <span class="p">&lt;</span> <span class="nx">r</span> <span class="o">&amp;&amp;</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">&lt;</span> <span class="nx">k</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">l</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">l</span> <span class="o">&amp;&amp;</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span> <span class="p">&gt;</span> <span class="nx">k</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">r</span><span class="o">--</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">nums</span><span class="p">[</span><span class="nx">l</span><span class="p">],</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span> <span class="p">=</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">r</span><span class="p">],</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">l</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">nums</span><span class="p">[</span><span class="nx">right</span><span class="p">],</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">l</span><span class="p">]</span> <span class="p">=</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">l</span><span class="p">],</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">right</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nf">_quick_sort</span><span class="p">(</span><span class="nx">nums</span><span class="p">,</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">l</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">_quick_sort</span><span class="p">(</span><span class="nx">nums</span><span class="p">,</span> <span class="nx">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">right</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>éé€’å½’ç‰ˆæœ¬ï¼Œå…¶å®å°±æ˜¯ç”¨æ ˆæ¨¡æ‹Ÿé€’å½’</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-golang" data-lang="golang"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">quick_sort_with_stack</span><span class="p">(</span><span class="nx">nums</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">type</span> <span class="nx">pair</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">s</span> <span class="p">=</span> <span class="nb">make</span><span class="p">([]</span><span class="nx">pair</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">)</span> <span class="p">&lt;</span> <span class="mi">2</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">s</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">pair</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">p</span> <span class="o">:=</span> <span class="nx">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="nx">s</span> <span class="p">=</span> <span class="nx">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">        <span class="nx">left</span><span class="p">,</span> <span class="nx">right</span> <span class="o">:=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nx">left</span> <span class="o">&gt;=</span> <span class="nx">right</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">k</span> <span class="o">:=</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="nx">left</span> <span class="p">&lt;</span> <span class="nx">right</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="nx">left</span> <span class="p">&lt;</span> <span class="nx">right</span> <span class="o">&amp;&amp;</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">left</span><span class="p">]</span> <span class="p">&lt;</span> <span class="nx">k</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">left</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="nx">left</span> <span class="p">&lt;</span> <span class="nx">right</span> <span class="o">&amp;&amp;</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">right</span><span class="p">]</span> <span class="p">&gt;</span> <span class="nx">k</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">right</span><span class="o">--</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="nx">nums</span><span class="p">[</span><span class="nx">left</span><span class="p">],</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">right</span><span class="p">]</span> <span class="p">=</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">right</span><span class="p">],</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">left</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">nums</span><span class="p">[</span><span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="p">],</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">left</span><span class="p">]</span> <span class="p">=</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">left</span><span class="p">],</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="nx">s</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">pair</span><span class="p">{</span><span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">left</span> <span class="o">-</span> <span class="mi">1</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="nx">s</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">pair</span><span class="p">{</span><span class="nx">left</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="ç¯å½¢é“¾è¡¨">ç¯å½¢é“¾è¡¨</h2>
<blockquote>
<p>ç»™ä½ ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ head ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚
å¦‚æœé“¾è¡¨ä¸­æœ‰æŸä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡è¿ç»­è·Ÿè¸ª next æŒ‡é’ˆå†æ¬¡åˆ°è¾¾ï¼Œåˆ™é“¾è¡¨ä¸­å­˜åœ¨ç¯ã€‚ ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œè¯„æµ‹ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨æ•´æ•° pos æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚æ³¨æ„ï¼špos ä¸ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’Â ã€‚ä»…ä»…æ˜¯ä¸ºäº†æ ‡è¯†é“¾è¡¨çš„å®é™…æƒ…å†µã€‚
å¦‚æœé“¾è¡¨ä¸­å­˜åœ¨ç¯Â ï¼Œåˆ™è¿”å› true ã€‚ å¦åˆ™ï¼Œè¿”å› false ã€‚</p>
</blockquote>
<p>ç»å…¸åŒæŒ‡é’ˆé—®é¢˜ï¼Œå¯ä»¥ç”¨hashmapä½†æ²¡å¿…è¦</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-golang" data-lang="golang"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">ListNode</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Val</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Next</span> <span class="o">*</span><span class="nx">ListNode</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">hasCycle</span><span class="p">(</span><span class="nx">head</span> <span class="o">*</span><span class="nx">ListNode</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">head</span> <span class="o">==</span> <span class="kc">nil</span> <span class="o">||</span> <span class="nx">head</span><span class="p">.</span><span class="nx">Next</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="nx">slow</span><span class="p">,</span> <span class="nx">fast</span> <span class="o">:=</span> <span class="nx">head</span><span class="p">,</span> <span class="nx">head</span><span class="p">.</span><span class="nx">Next</span><span class="p">.</span><span class="nx">Next</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">fast</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="o">&amp;&amp;</span> <span class="nx">fast</span><span class="p">.</span><span class="nx">Next</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nx">slow</span> <span class="o">==</span> <span class="nx">fast</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">slow</span> <span class="p">=</span> <span class="nx">slow</span><span class="p">.</span><span class="nx">Next</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fast</span> <span class="p">=</span> <span class="nx">fast</span><span class="p">.</span><span class="nx">Next</span><span class="p">.</span><span class="nx">Next</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ä½†è¿˜æ˜¯åŠ ä¸€ä¸ªHashMapçš„æ–¹æ³•å§ï¼Œä¸‡ä¸€é¢è¯•å®˜è¦æ±‚ç”¨å‘¢</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-golang" data-lang="golang"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">hasCycle</span><span class="p">(</span><span class="nx">head</span> <span class="o">*</span><span class="nx">ListNode</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">hashMap</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="o">*</span><span class="nx">ListNode</span><span class="p">]</span><span class="kd">struct</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">head</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">hashMap</span><span class="p">[</span><span class="nx">head</span><span class="p">];</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">hashMap</span><span class="p">[</span><span class="nx">head</span><span class="p">]</span> <span class="p">=</span> <span class="kd">struct</span><span class="p">{}{}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">head</span> <span class="p">=</span> <span class="nx">head</span><span class="p">.</span><span class="nx">Next</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="lru-ç¼“å­˜æœºåˆ¶">LRU ç¼“å­˜æœºåˆ¶</h2>
<p>ç»å…¸LRUç¼“å­˜æœºåˆ¶ï¼Œç®€å•å¤ä¹ ä¸€ä¸‹LRU</p>
<p>LRUç¼“å­˜ç®€å•æ¥è®²æ˜¯ä¸€ä¸ªæ ˆå…¥ç»“æ„ï¼Œä¿å­˜ç€ä½¿ç”¨æœ€ä¸ºé¢‘ç¹çš„ç¼“å­˜æ•°æ®ï¼Œä½¿å¾—å¯ä»¥å¿«é€Ÿåœ¨å†…å­˜ä¸­æŸ¥è¯¢åˆ°æ•°æ®è€Œä¸éœ€è¦è¿›è¡Œä¸€æ¬¡é¢å¤–çš„æ•°æ®æŸ¥è¯¢ä¾‹å¦‚æ•°æ®åº“æŸ¥è¯¢ä»¥æé«˜æ•ˆç‡ï¼Œåœ¨æ“ä½œç³»ç»Ÿçš„é¡µè¡¨ä¸­ä¹Ÿæœ‰ä½¿ç”¨</p>
<p>ä¸ºäº†å®ç°æœ€çƒ­çš„ç¼“å­˜æ•°æ®ï¼Œæˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„æ˜¯ç”¨æ•°ç»„æ ˆæ¥æ¨¡æ‹Ÿï¼Œä½†ä¸ºäº†æ›´æ–¹ä¾¿æˆ‘ä»¬é€‰æ‹©åŒå‘é“¾è¡¨æ¥å®ç°ï¼Œå½“ç„¶åœ¨Leetcodeå®˜æ–¹é¢˜è§£ä¸­ä¹Ÿä½¿ç”¨äº†åŒå‘é“¾è¡¨</p>
<p>åœ¨è¿™é‡Œï¼Œä¸ºäº†ä½“éªŒGolangçš„æ³›å‹å¹¶ä¸”å……åˆ†äº†è§£åŒå‘é“¾è¡¨çš„ä½¿ç”¨ï¼Œå†³å®šä»å¤´ç¼–å†™åŒå‘é“¾è¡¨è€Œéä½¿ç”¨å®˜æ–¹çš„containeråŒ…</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-golang" data-lang="golang"></code></pre></div><h2 id="åè½¬é“¾è¡¨">åè½¬é“¾è¡¨</h2>
<p>ç»å…¸é¢è¯•é¢˜ï¼Œåˆ†é€’å½’å’Œéé€’å½’ç‰ˆæœ¬ï¼Œé¦–å…ˆæ˜¯é€’å½’ç‰ˆæœ¬</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-golang" data-lang="golang"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">reverseLink</span><span class="p">(</span><span class="nx">head</span> <span class="o">*</span><span class="nx">ListNode</span><span class="p">)</span> <span class="o">*</span><span class="nx">ListNode</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">head</span> <span class="o">==</span> <span class="kc">nil</span> <span class="o">||</span> <span class="nx">head</span><span class="p">.</span><span class="nx">Next</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">head</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">newHead</span> <span class="o">:=</span> <span class="nf">reverseLink</span><span class="p">(</span><span class="nx">head</span><span class="p">.</span><span class="nx">Next</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">head</span><span class="p">.</span><span class="nx">Next</span><span class="p">.</span><span class="nx">Next</span> <span class="p">=</span> <span class="nx">head</span>
</span></span><span class="line"><span class="cl">    <span class="nx">head</span><span class="p">.</span><span class="nx">Next</span> <span class="p">=</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">newHead</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ç„¶åæ˜¯éé€’å½’ç‰ˆæœ¬</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-golang" data-lang="golang"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">reverseLink</span><span class="p">(</span><span class="nx">head</span> <span class="o">*</span><span class="nx">ListNode</span><span class="p">)</span> <span class="o">*</span><span class="nx">ListNode</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">prev</span> <span class="o">*</span><span class="nx">ListNode</span>
</span></span><span class="line"><span class="cl">    <span class="nx">cur</span> <span class="o">:=</span> <span class="nx">head</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">cur</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">next</span> <span class="o">:=</span> <span class="nx">cur</span><span class="p">.</span><span class="nx">Next</span>
</span></span><span class="line"><span class="cl">        <span class="nx">cur</span><span class="p">.</span><span class="nx">Next</span> <span class="p">=</span> <span class="nx">prev</span>
</span></span><span class="line"><span class="cl">        <span class="nx">prev</span> <span class="p">=</span> <span class="nx">cur</span>
</span></span><span class="line"><span class="cl">        <span class="nx">cur</span> <span class="p">=</span> <span class="nx">next</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">prev</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬-n-ä¸ªç»“ç‚¹">åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ N ä¸ªç»“ç‚¹</h2>
<p>ç»å…¸åŒæŒ‡é’ˆé¢˜ç›®ï¼Œå…ˆè®©å¿«æŒ‡é’ˆèµ°Næ¬¡ï¼Œéšåç”Ÿæˆæ–°çš„æŒ‡é’ˆç›´åˆ°å¿«æŒ‡é’ˆèµ°å®Œï¼Œæ…¢æŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹å°±æ˜¯ç¬¬Nä¸ªèŠ‚ç‚¹ï¼Œåˆ é™¤å³å¯</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-golang" data-lang="golang"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">removeNthFromEnd</span><span class="p">(</span><span class="nx">head</span> <span class="o">*</span><span class="nx">ListNode</span><span class="p">,</span> <span class="nx">n</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">ListNode</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">dummyNode</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">ListNode</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Next</span><span class="p">:</span> <span class="nx">head</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fast</span> <span class="o">:=</span> <span class="nx">dummyNode</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">n</span> <span class="o">&amp;&amp;</span> <span class="nx">fast</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fast</span> <span class="p">=</span> <span class="p">(</span><span class="nx">fast</span><span class="p">.</span><span class="nx">Next</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ptr</span> <span class="o">:=</span> <span class="nx">dummyNode</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">fast</span><span class="p">.</span><span class="nx">Next</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">ptr</span> <span class="p">=</span> <span class="nx">ptr</span><span class="p">.</span><span class="nx">Next</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fast</span> <span class="p">=</span> <span class="nx">fast</span><span class="p">.</span><span class="nx">Next</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ptr</span><span class="p">.</span><span class="nx">Next</span> <span class="p">=</span> <span class="nx">ptr</span><span class="p">.</span><span class="nx">Next</span><span class="p">.</span><span class="nx">Next</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">dummyNode</span><span class="p">.</span><span class="nx">Next</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="å¿«é€Ÿæ’åºçš„ç©ºé—´å¤æ‚åº¦æ˜¯å¤šå°‘æ—¶é—´å¤æ‚åº¦çš„æœ€å¥½æœ€åçš„æƒ…å†µæ˜¯å¤šå°‘æœ‰å“ªäº›ä¼˜åŒ–æ–¹æ¡ˆ">å¿«é€Ÿæ’åºçš„ç©ºé—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿæ—¶é—´å¤æ‚åº¦çš„æœ€å¥½æœ€åçš„æƒ…å†µæ˜¯å¤šå°‘ï¼Œæœ‰å“ªäº›ä¼˜åŒ–æ–¹æ¡ˆï¼Ÿ</h2>
<ol>
<li>å¿«é€Ÿæ’åºçš„ç©ºé—´å¤æ‚åº¦å¯ä»¥ä¸º$O(logn)$</li>
<li>æ—¶é—´å¤æ‚åº¦æœ€å¥½çš„æƒ…å†µä¸‹ä¸ºO(nlogn)ï¼Œæœ€åæƒ…å†µä¸‹ä¸ºO(n^2)</li>
<li>å¿«é€Ÿæ’åºçš„ä¼˜åŒ–ç‚¹å¦‚ä¸‹
<ul>
<li>é‡‡ç”¨éšæœºå“¨å…µç­–ç•¥ï¼Œå¦‚[5,4,3,2,1]è¿™ç§æ•°æ®çš„å½±å“ã€‚å¦å¤–ä¹Ÿå¯ä»¥é€‰æ‹©ä¸‰æ•°çš„ä¸­ä½æ•°ï¼ˆå·¦ã€ä¸­ã€å³ï¼Œä¸­é—´æ•°æ®ï¼Œå¦‚8, 0, 6ï¼Œé€‰æ‹©6ä½œä¸ºå“¨å…µï¼‰</li>
<li>å¿«æ’é’ˆå¯¹æ•°æ®é‡å°å¹¶ä¸”éƒ¨åˆ†æœ‰åºçš„æ•°ç»„æ•ˆç‡å¹¶ä¸é«˜ï¼Œå¯ä»¥åœ¨åˆ‡åˆ†ä¸ºä¸€å®šå¤§å°åè½¬æ¢ä¸ºæ’å…¥æ’åº</li>
<li>å°†ä¸å“¨å…µç›¸åŒçš„å…ƒç´ æ”¾åœ¨åˆ†å‰²ç‚¹é™„è¿‘ï¼Œå‡å°‘åˆ†å‰²åçš„æ•°ç»„é•¿åº¦</li>
</ul>
</li>
</ol>
]]></content></item><item><title>Jetson TX2 NX é…ç½®ç¬”è®°</title><link>https://blog.thinkmoe.icu/posts/jetson-tx2-nx-%E9%85%8D%E7%BD%AE%E7%AC%94%E8%AE%B0/</link><pubDate>Sun, 05 Mar 2023 22:01:11 +0800</pubDate><guid>https://blog.thinkmoe.icu/posts/jetson-tx2-nx-%E9%85%8D%E7%BD%AE%E7%AC%94%E8%AE%B0/</guid><description>JetsonçœŸçš„å¥½è´µå•Š&amp;gt; &amp;lt; tx2nxå¼€å‘æ¿ ç”±äºç§‘ç ”çš„éœ€è¦ï¼Œéœ€è¦åœ¨è¾¹ç¼˜è®¾å¤‡ä¸Šå¯¹æ·±åº¦å­¦ä¹ æ¨¡å‹è¿›è¡Œé‡åŒ–æµ‹è¯•ã€‚å®éªŒå®¤å†…åˆšå¥½æœ‰é—²ç½®çš„Nvidia</description><content type="html"><![CDATA[<blockquote>
<p>JetsonçœŸçš„å¥½è´µå•Š&gt; &lt;</p>
</blockquote>
<figure><img src="/images/jetsontx2nx.jpg"
         alt="image"/><figcaption>
            <p>tx2nxå¼€å‘æ¿</p>
        </figcaption>
</figure>

<!-- raw HTML omitted -->
<p>ç”±äºç§‘ç ”çš„éœ€è¦ï¼Œéœ€è¦åœ¨è¾¹ç¼˜è®¾å¤‡ä¸Šå¯¹æ·±åº¦å­¦ä¹ æ¨¡å‹è¿›è¡Œé‡åŒ–æµ‹è¯•ã€‚å®éªŒå®¤å†…åˆšå¥½æœ‰é—²ç½®çš„Nvidia Jetson TX2å¼€å‘æ¿ï¼Œæ‰€ä»¥å°±ç›´æ¥æ‹¿æ¥æµ‹è¯•äº†</p>
<p>åŸæœ¬ä»¥ä¸ºåœ¨å¼€å‘æ¿ä¸Šçš„é…ç½®ä¼šæ¯”è¾ƒç®€å•ï¼Œæ— éå°±æ˜¯ä»x86å¹³å°è½¬æ¢åˆ°armä¸Šé¢ï¼Œä½†å®é™…ä¸Šå‘éå¸¸å¤šä¾‹å¦‚å‰é¢æåˆ°çš„armæ¶æ„ï¼Œå…¶å®åœ¨Jetsonä¸Šé¢å‹æ ¹ä¸æ˜¯ä¼ ç»Ÿçš„armæ¶æ„ï¼Œè€Œæ˜¯ä»armv8ç‹¬ç«‹åˆ†æ”¯å‡ºæ¥çš„aarchæ¶æ„</p>
<p>è™½ç„¶å‘éå¸¸å¤šï¼Œä½†æ€»ä½“ä¸Šé…ç½®æµç¨‹ä¹Ÿéå¸¸ç®€æ´ï¼ŒåŸºæœ¬é…ç½®è¿‡ç¨‹ä¹Ÿå’Œx86å¹³å°ä¸Šé¢å¤§è‡´ç›¸åŒï¼Œåªæ˜¯åœ¨å®‰è£…çš„æ—¶å€™éœ€è¦æ³¨æ„ã€‚æœ¬æ–‡å¤§çº²å¦‚ä¸‹</p>
<ul>
<li>çƒ§å½•å®‰è£…ç³»ç»Ÿ</li>
<li>å®‰è£…condaè™šæ‹Ÿç¯å¢ƒ</li>
<li>å®‰è£…Pytorchå’Œtorchvision</li>
<li>å®‰è£…torch2trt</li>
</ul>
<!-- raw HTML omitted -->
<h2 id="å®‰è£…ç³»ç»Ÿ">å®‰è£…ç³»ç»Ÿ</h2>
<p>é¦–å…ˆéœ€è¦çƒ§å½•é•œåƒåˆ°å¼€å‘æ¿ä¸­ï¼Œç”±äºæˆ‘è¿™å—æ¿å­åœ¨è´­ä¹°çš„æ—¶å€™ä»£ç†å•†å°±å·²ç»çƒ§å½•å¥½äº†ç³»ç»Ÿåˆ°å›ºä»¶ä¸­ï¼Œå› æ­¤ç›´æ¥å¼€æœºå³å¯</p>
<p>å¦‚æœæ˜¯è£¸æ¿å®‰è£…ï¼Œåˆ™å¯ä»¥å‚è€ƒçŸ¥ä¹çš„æ•™ç¨‹è¿›è¡Œçƒ§å½•å®‰è£…</p>
<p>è¿æ¥ç”µæºå¯åŠ¨å¼€å‘æ¿ï¼Œåœ¨å®‰è£…ç•Œé¢ä¸­å¯ä»¥é€‰æ‹©å¯ç”¨CPUæ ¸å¿ƒçš„é€‰é¡¹ï¼Œé»˜è®¤æ˜¯4æ ¸ï¼Œå¯¹åº”çš„SWAPå¤§å°ä¸º2GBï¼Œå¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚è¿›è¡Œæ›´æ”¹ã€‚å½“ç„¶ï¼Œå¦‚æœå·²ç»å®‰è£…å®Œäº†ç³»ç»Ÿä¹Ÿå¯ä»¥åœ¨ç³»ç»Ÿä¸­è¿›è¡Œä¿®æ”¹ã€‚</p>
<p>tx2è‡ªå¸¦çš„å­˜å‚¨å¤§å°éå¸¸å°åªæœ‰16GBï¼ŒæŒ‰éœ€æ±‚è¿›è¡Œæ‰©å®¹ï¼Œæˆ‘è¿™é‡Œæ˜¯å¤–æ¥äº†ä¸€å—128Gçš„SSDç¡¬ç›˜</p>
<h2 id="å®‰è£…condaè™šæ‹Ÿç¯å¢ƒ">å®‰è£…condaè™šæ‹Ÿç¯å¢ƒ</h2>
<p>æŒ‰ç…§æœ¬äººçš„ä¹ æƒ¯ï¼Œéœ€è¦ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒç”¨äºåŒºåˆ†ä¸åŒé¡¹ç›®çš„ç¯å¢ƒï¼Œåœ¨tx2ä¹Ÿä¸ä¾‹å¤–ã€‚è¿™é‡Œå°±å‡ºç°äº†ç¬¬ä¸€ä¸ªå‘ï¼Œé‚£å°±æ˜¯å®˜æ–¹çš„condaå¹¶ä¸èƒ½åœ¨tx2ä¸Šå®Œç¾è¿è¡Œï¼
å°±ç®—ä½ ä¸‹è½½çš„æ˜¯aarchæ¶æ„çš„è„šæœ¬ï¼Œä½ åœ¨å®‰è£…è¿‡ç¨‹ä¸­ä¹Ÿå¯èƒ½æŠ¥é”™ï¼Œåˆæˆ–è€…å³ä½¿å®‰è£…æˆåŠŸä½ åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒé€‰æ‹©ä½ç‰ˆæœ¬çš„Pythonæ—¶ä¹Ÿä¼šå‡ºç°é”™è¯¯</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ä¸ªä¿®æ”¹ç‰ˆçš„condaï¼Œé‚£å°±æ˜¯<a href="https://github.com/conda-forge/miniforge">Mambaforge</a>ã€‚ä»å®˜æ–¹çš„<a href="https://github.com/conda-forge/miniforge/releases">Release</a>ä¸­ä¸‹è½½æ‰€éœ€è¦çš„è„šæœ¬æ–‡ä»¶(<strong>æ³¨æ„å¾—æ˜¯aarchæ¶æ„çš„æ–‡ä»¶ï¼</strong>)ï¼Œå®‰è£…æ–¹å¼åˆ™å’Œæ™®é€šç‰ˆæœ¬çš„condaå¦‚å‡ºä¸€è¾™ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å®‰è£…çš„ä½ç½®éœ€è¦é€‰æ‹©ä¸€ä¸ªå®¹é‡æ›´å¤§çš„ç¡¬ç›˜ä¸Šé¢</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">wget https://github.com/conda-forge/miniforge/releases/download/22.11.1-4/Mambaforge-22.11.1-4-Linux-aarch64.sh
</span></span><span class="line"><span class="cl">sh Mambaforge-22.11.1-4-Linux-aarch64.sh
</span></span></code></pre></div><p>éšååˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªç¯å¢ƒå§</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">conda create -n hello <span class="nv">python</span><span class="o">=</span>3.6
</span></span><span class="line"><span class="cl">conda activate hello
</span></span></code></pre></div><h2 id="å®‰è£…pytorchå’Œtorchvision">å®‰è£…Pytorchå’Œtorchvision</h2>
<p>åœ¨å®‰è£…Pytorchå‰ï¼Œä½ éœ€è¦å®‰è£…Jetsonçš„CUDAç¯å¢ƒï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯æ²¡æœ‰çš„ï¼Œå½“ç„¶åœ¨Nvidiaè‡ªå®¶äº§å“ä¸Šå®‰è£…CUDAç¯å¢ƒéå¸¸ç®€å•ï¼Œä¸åƒLinuxé‚£æ ·æƒ¹äººåŒã€‚å®‰è£…åªéœ€è¦ä¸€æ¡å‘½ä»¤å³å¯</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt install nvidia-jetpack
</span></span></code></pre></div><p>è¿™æ—¶ï¼ŒæŸ¥çœ‹<code>/usr/local</code>ä¸­åº”è¯¥å°±ä¼šå‡ºç°å¯¹åº”çš„CUDAç¯å¢ƒäº†ï¼ŒJetpackä¼šå¸®åŠ©ä½ å®‰è£…CUDAå·¥å…·åŒ…ã€TensorRTå’Œå…¶ä»–å·¥å…·ï¼Œä½ å¯ä»¥é€šè¿‡<code>jetson_release</code>æ¥æŸ¥çœ‹å½“å‰å®‰è£…çš„CUDAç‰ˆæœ¬</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>base<span class="o">)</span> tx2-1@tx2-1-desktop:/usr/local$ jetson_release
</span></span><span class="line"><span class="cl">Software part of jetson-stats 4.1.5 - <span class="o">(</span>c<span class="o">)</span> 2023, Raffaello Bonghi
</span></span><span class="line"><span class="cl">Model: lanai-3636 - Jetpack 4.6.1 <span class="o">[</span>L4T 32.7.1<span class="o">]</span>
</span></span><span class="line"><span class="cl">NV Power Mode: MAXP_CORE_ARM - Type: <span class="m">3</span>
</span></span><span class="line"><span class="cl">jtop:
</span></span><span class="line"><span class="cl"> - Version: 4.1.5
</span></span><span class="line"><span class="cl"> - Service: Active
</span></span><span class="line"><span class="cl">Libraries:
</span></span><span class="line"><span class="cl"> - CUDA: 10.2.300
</span></span><span class="line"><span class="cl"> - cuDNN: 8.2.1.32
</span></span><span class="line"><span class="cl"> - TensorRT: 8.2
</span></span><span class="line"><span class="cl"> - VPI: 1.2.3
</span></span><span class="line"><span class="cl"> - OpenCV: 4.1.1 - with CUDA: NO
</span></span></code></pre></div><p>æ­¤æ—¶ï¼Œä½ ä¹Ÿå¯ä»¥å°†CUDAçš„ç¯å¢ƒæ·»åŠ åˆ°ç»ˆç«¯ä¸­ï¼Œä¸ºåç»­ç¼–è¯‘åšå‡†å¤‡</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># $HOME/.bashrc</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CUDA_HOME</span><span class="o">=</span>/usr/local/cuda
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$CUDA_HOME</span>/bin
</span></span></code></pre></div><p>æ¥ä¸‹æ¥å°±è¦å¼€å§‹å®‰è£…Pytorchäº†ï¼Œæ³¨æ„çš„æ˜¯åœ¨Jetsonè®¾å¤‡ä¸Šå¹¶ä¸èƒ½åƒä¼ ç»Ÿcondaç¯å¢ƒé‚£æ ·ç›´æ¥é€šè¿‡condaæˆ–pipå®‰è£…ï¼Œéœ€è¦åˆ°Nvidiaå®˜æ–¹ä¸‹è½½å¯¹åº”çš„å®‰è£…åŒ…ã€‚è€Œtorchvisionä¹Ÿéœ€è¦è‡ªå·±æ‰‹åŠ¨ç¼–è¯‘å®‰è£…æˆ–ä¸‹è½½ç¬¬ä¸‰æ–¹ç¼–è¯‘å¥½çš„åŒ…è¿›è¡Œå®‰è£…ã€‚ä»¥ä¸‹æµç¨‹å‡æ¥è‡ª<a href="https://forums.developer.nvidia.com/t/pytorch-for-jetson/72048">å®˜æ–¹æ•™ç¨‹</a></p>
<ol>
<li>å®‰è£…Pytorch
åœ¨è¿™é‡Œï¼Œç”±äºè™šæ‹Ÿç¯å¢ƒé€‰æ‹©çš„Pythonç‰ˆæœ¬ä¸º3.6ï¼Œè€Œæœ€é«˜æ”¯æŒ3.6ç‰ˆæœ¬çš„Pytorchç‰ˆæœ¬ä¸º1.8.0ï¼Œæ‰€ä»¥è¿™é‡Œå®‰è£…1.8.0ç‰ˆæœ¬</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">wget https://nvidia.box.com/shared/static/p57jwntv436lfrd78inwl7iml6p13fzh.whl -O torch-1.8.0-cp36-cp36m-linux_aarch64.whl
</span></span><span class="line"><span class="cl">sudo apt-get install python3-pip libopenblas-base libopenmpi-dev libomp-dev
</span></span><span class="line"><span class="cl">conda activate hello
</span></span><span class="line"><span class="cl">pip install cython <span class="nv">numpy</span><span class="o">==</span>1.19.4 torch-1.8.0-cp36-cp36m-linux_aarch64.whl
</span></span></code></pre></div><p>æ³¨æ„ï¼Œè¿™é‡Œ<code>numpy</code>é€‰æ‹©å®‰è£…<code>1.19.4</code>ç‰ˆæœ¬ï¼Œé»˜è®¤çš„<code>1.19.5</code>ç‰ˆæœ¬ä¼šå‡ºç°è«åå…¶å¦™çš„bug</p>
<ol start="2">
<li>å®‰è£…torchvision<br>
å®‰è£…torchvisonéœ€è¦æ³¨æ„æ‰€å®‰è£…çš„torchç‰ˆæœ¬ï¼Œå¯¹åº”åˆ—è¡¨å¦‚ä¸‹</li>
</ol>
<pre tabindex="0"><code>PyTorch v1.0 - torchvision v0.2.2
PyTorch v1.1 - torchvision v0.3.0
PyTorch v1.2 - torchvision v0.4.0
PyTorch v1.3 - torchvision v0.4.2
PyTorch v1.4 - torchvision v0.5.0
PyTorch v1.5 - torchvision v0.6.0
PyTorch v1.6 - torchvision v0.7.0
PyTorch v1.7 - torchvision v0.8.1
PyTorch v1.8 - torchvision v0.9.0
PyTorch v1.9 - torchvision v0.10.0
PyTorch v1.10 - torchvision v0.11.1
PyTorch v1.11 - torchvision v0.12.0
PyTorch v1.12 - torchvision v0.13.0
</code></pre><p>æˆ‘ä»¬å…ˆçœ‹çœ‹è‡ªè¡Œç¼–è¯‘å®‰è£…æ–¹å¼ï¼Œé¦–å…ˆç¡®è®¤æ‰€éœ€è¦çš„ç‰ˆæœ¬ï¼Œè¿™é‡Œä¸º<code>v0.9.0</code>ï¼Œç„¶åæŒ‰ç…§ä¸‹è¿°è¿‡ç¨‹è¿›è¡Œå®‰è£…</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install libjpeg-dev zlib1g-dev libpython3-dev libavcodec-dev libavformat-dev libswscale-dev
</span></span><span class="line"><span class="cl">git clone --branch 0.9.0 https://github.com/pytorch/vision torchvision
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> torchvision
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">BUILD_VERSION</span><span class="o">=</span>0.9.0
</span></span><span class="line"><span class="cl">python3 setup.py install --user
</span></span></code></pre></div><p>å¦‚æœä½ ä¸€åˆ‡é¡ºåˆ©çš„è¯ï¼Œé€šè¿‡<code>pip list | grep torch</code>åˆ™å¯ä»¥çœ‹åˆ°å¯¹åº”çš„å®‰è£…æ–‡ä»¶äº†ï¼Œä½†æ˜¯æœ¬äººè¿æ°”ä¸å’‹è¡Œï¼Œåœ¨ç¼–è¯‘ä¸­é‡åˆ°<code>nvcc</code>çš„é”™è¯¯ï¼Œä»€ä¹ˆæ‰¾ä¸åˆ°ç›®æ ‡æ–‡ä»¶ä¹‹ç±»çš„ï¼Œä½†æ˜¯ä¹Ÿæ²¡æœ‰å…¶ä»–é”™è¯¯ä¿¡æ¯ï¼Œè®©æˆ‘éå¸¸å¤´ç–¼</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œåœ¨è°·æ­Œä¸Šæœåˆ°åˆ«äººä¸ºnanoç¼–è¯‘å¥½äº†çš„torchvisionã€‚è™½ç„¶æ˜¯åœ¨nanoç¼–è¯‘çš„ï¼Œä½†æ˜¯éƒ½æ˜¯aarchæ¶æ„åº”è¯¥å¯ä»¥ç”¨å§ï¼Œå®é™…ä¸Šä¹Ÿç¡®å®å¯ä»¥ç”¨ï¼Œ<a href="https://qengineering.eu/install-pytorch-on-jetson-nano.html">å‚è€ƒé“¾æ¥</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install libjpeg-dev zlib1g-dev libpython3-dev
</span></span><span class="line"><span class="cl">sudo apt-get install libavcodec-dev libavformat-dev libswscale-dev
</span></span><span class="line"><span class="cl">pip install pillow gdown
</span></span><span class="line"><span class="cl">gdown https://drive.google.com/uc?id<span class="o">=</span>1BdvXkwUGGTTamM17Io4kkjIT6zgvf4BJ
</span></span><span class="line"><span class="cl">pip install torchvision-0.9.0a0+01dfa8e-cp36-cp36m-linux_aarch64.whl
</span></span><span class="line"><span class="cl">pip list <span class="p">|</span> grep torch
</span></span><span class="line"><span class="cl">torch               1.8.0
</span></span><span class="line"><span class="cl">torch2trt           0.4.0 <span class="c1"># è¿™ä¸ªåé¢ä¼šè¿›è¡Œå®‰è£…</span>
</span></span><span class="line"><span class="cl">torchvision         0.9.0a0+01dfa8e
</span></span></code></pre></div><p>okï¼Œè¿™å°±å®‰è£…å®Œäº‹äº†ï¼Œéå¸¸ç®€å•</p>
<p>æœ€åæ‰“å¼€ç»ˆç«¯æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torchvision</span>
</span></span><span class="line"><span class="cl"><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_avaliable</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="kc">True</span>
</span></span></code></pre></div><h2 id="å®‰è£…torch2trt">å®‰è£…torch2trt</h2>
<p>å®‰è£…torch2trtçš„è¿‡ç¨‹éå¸¸ç®€å•ï¼Œä½†ä¹Ÿæœ‰ä¸¤ä¸ªç‚¹éœ€è¦æ³¨æ„</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°åœ¨ä¸Šé¢å®‰è£…<code>jetpack</code>çš„æ—¶å€™å¯ä»¥å‘ç°å·²ç»å®‰è£…å¥½äº†<code>TensorRT</code>ï¼ˆç”šè‡³<code>docker</code>ï¼‰ï¼Œä½†æ˜¯å®‰è£…åŒ…å¹¶ä¸å­˜åœ¨äºè™šæ‹Ÿç¯å¢ƒä¸­ï¼Œè€Œæˆ‘ä»¬å¹¶ä¸æƒ³è¦åœ¨é‡æ–°å®‰è£…ä¸€éè¿™ç©æ„ï¼Œå› æ­¤éœ€è¦å¯¹å…¶è¿›è¡Œå¤ç”¨ï¼Œä¸ç„¶åç»­ç¼–è¯‘<code>torch2trt</code>æ—¶ä¼šç›´æ¥æŠ¥é”™ï¼ˆ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PYTHONPATH</span><span class="o">=</span><span class="nv">$PYTHONPATH</span>:/usr/lib/python3.6/dist-packages <span class="c1"># ç›®å½•æŒ‰ç…§å®é™…æƒ…å†µæ›´æ”¹</span>
</span></span></code></pre></div><p>è¿™æ—¶ä½ å†åˆ°è™šæ‹Ÿç¯å¢ƒçš„ç»ˆç«¯ä¸­æµ‹è¯•pythonæ˜¯å¦èƒ½æ­£å¸¸å¯¼å…¥tensorrt</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">tensorrt</span>
</span></span></code></pre></div><p>å¦‚æœä¸€åˆ‡æ­£å¸¸å°±å¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥çš„å®‰è£…äº†ï¼Œé¦–å…ˆéœ€è¦cloneæ‰€éœ€è¦çš„ä»“åº“</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git clone https://github.com/NVIDIA-AI-IOT/torch2trt
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> torch2trt
</span></span></code></pre></div><p>åœ¨è¿™é‡Œæˆ‘ä»¬ç›´æ¥é€‰æ‹©æœ€æ–°ç‰ˆæœ¬ï¼Œé¿å…å’Œtensorrtæ–°apiå†²çª</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git checkout v0.4.0
</span></span></code></pre></div><p>éšåå°±å¯ä»¥ç›´æ¥è¿›è¡Œå®‰è£…äº†ï¼Œå¦‚æœå®‰è£…è¿‡ç¨‹ä¸­ç¢°åˆ°ç¼ºå°‘åŒ…çš„æƒ…å†µç›´æ¥pipå®‰è£…å³å¯</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">python setup.py install
</span></span><span class="line"><span class="cl">pip list <span class="p">|</span> grep torch
</span></span><span class="line"><span class="cl">torch               1.8.0
</span></span><span class="line"><span class="cl">torch2trt           0.4.0 <span class="c1"># è¿™ä¸ªåé¢ä¼šè¿›è¡Œå®‰è£…</span>
</span></span><span class="line"><span class="cl">torchvision         0.9.0a0+01dfa8e
</span></span></code></pre></div><!-- raw HTML omitted -->
<h2 id="ç»“è¯­">ç»“è¯­</h2>
<p>æ€»çš„æ¥è¯´Tx2çš„é…ç½®æ²¡æœ‰æˆ‘æƒ³è±¡ä¸­çš„ç®€å•ä½†ä¹Ÿæ²¡æœ‰é‚£ä¹ˆå¤æ‚ï¼ŒNvidiaç¤¾åŒºä¸­æœ‰å¤§é‡çš„è§£å†³æ–¹æ¡ˆï¼ˆè™½ç„¶nanoå±…å¤šï¼‰ä»”ç»†è°·æ­Œä¹Ÿéƒ½å¯ä»¥å¯»æ‰¾åˆ°ç­”æ¡ˆã€‚æˆ‘åœ¨æµ‹è¯•äº†å‡ ä¸ªå¼€æºçš„é¡¹ç›®åå‘ç°TX2çš„æ€§èƒ½ä¹Ÿè¿˜ä¸é”™ï¼Œä¸è¿‡CPUéå¸¸åƒåœ¾ï¼Œåç»­ä¹Ÿä¼šå†™å†™å…³äºå¼€æºé¡¹ç›®å¦‚ä½•åœ¨TX2ä¸Šæµ‹è¯•çš„ä¾‹å­ï¼Œæ›´å¥½çš„ç†è§£å’Œç†Ÿæ‚‰è¿™å—å¼€å‘æ¿</p>
]]></content></item><item><title>è®°ä¸€æ¬¡Pythonå¼•å…¥ç¬¬ä¸‰æ–¹æºç åŒ…çš„è§£å†³æ–¹å¼</title><link>https://blog.thinkmoe.icu/posts/%E8%AE%B0%E4%B8%80%E6%AC%A1python%E5%BC%95%E5%85%A5%E7%AC%AC%E4%B8%89%E6%96%B9%E6%BA%90%E7%A0%81%E5%8C%85%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E5%BC%8F/</link><pubDate>Tue, 16 Aug 2022 17:13:03 +0800</pubDate><guid>https://blog.thinkmoe.icu/posts/%E8%AE%B0%E4%B8%80%E6%AC%A1python%E5%BC%95%E5%85%A5%E7%AC%AC%E4%B8%89%E6%96%B9%E6%BA%90%E7%A0%81%E5%8C%85%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E5%BC%8F/</guid><description>Pythonè™½ç„¶æŒºå¥½ç”¨çš„ï¼Œä½†ä¹ŸæŒºéš¾ç”¨çš„ ä¼—æ‰€å‘¨çŸ¥ï¼ŒPythonç”±äºå…¶â€œå…ˆè¿›â€çš„åŒ…ç®¡ç†åŠŸèƒ½ï¼Œè®©ä½ å‡ ä¹å¯ä»¥é€šè¿‡ä¸€æ¡å‘½ä»¤å®‰è£…æ‰€æœ‰æ‰“åŒ…å¥½çš„ç¬¬ä¸‰æ–¹åŒ…ã€‚ä½†</description><content type="html"><![CDATA[<blockquote>
<p>Pythonè™½ç„¶æŒºå¥½ç”¨çš„ï¼Œä½†ä¹ŸæŒºéš¾ç”¨çš„</p>
</blockquote>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒPythonç”±äºå…¶â€œå…ˆè¿›â€çš„åŒ…ç®¡ç†åŠŸèƒ½ï¼Œè®©ä½ å‡ ä¹å¯ä»¥é€šè¿‡ä¸€æ¡å‘½ä»¤å®‰è£…æ‰€æœ‰æ‰“åŒ…å¥½çš„ç¬¬ä¸‰æ–¹åŒ…ã€‚ä½†æ˜¯å½“æˆ‘ä»¬æƒ³ä»ç¬¬ä¸‰æ–¹çš„é¡¹ç›®é‡Œé¢å¼•å…¥å°‘è®¸å‡½æ•°æ—¶ï¼Œè¿™ç§æ–¹å¼å°±è¡Œä¸å¾—é€šäº†.</p>
<p>ä¾‹å¦‚æˆ‘æƒ³ä»ä¸€ä¸ªPytorché¡¹ç›®ä¸­å°†æ¨¡å‹å®šä¹‰çš„å‡½æ•°å¼•å…¥ï¼ˆè¯´çš„å°±æ˜¯ä½ Yoloï¼‰åˆ°æˆ‘è‡ªå·±çš„å‡½æ•°ä¸­ï¼Œé¡¹ç›®ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl">â”œâ”€â”€ main.py
</span></span><span class="line"><span class="cl">â”œâ”€â”€ src
</span></span><span class="line"><span class="cl">â”‚Â Â  â””â”€â”€ module
</span></span><span class="line"><span class="cl">â”‚Â Â      â”œâ”€â”€ a.py
</span></span><span class="line"><span class="cl">â”‚Â Â      â”œâ”€â”€ __init__.py
</span></span><span class="line"><span class="cl">â”‚Â Â      â””â”€â”€ __pycache__
</span></span><span class="line"><span class="cl">â”‚Â Â          â”œâ”€â”€ a.cpython-38.pyc
</span></span><span class="line"><span class="cl">â”‚Â Â          â””â”€â”€ __init__.cpython-38.pyc
</span></span><span class="line"><span class="cl">â””â”€â”€ thirdparty
</span></span><span class="line"><span class="cl">    â””â”€â”€ codes
</span></span><span class="line"><span class="cl">        â”œâ”€â”€ modules
</span></span><span class="line"><span class="cl">        â”‚Â Â  â”œâ”€â”€ b.py
</span></span><span class="line"><span class="cl">        â”‚Â Â  â”œâ”€â”€ __init__.py
</span></span><span class="line"><span class="cl">        â”‚Â Â  â”œâ”€â”€ __pycache__
</span></span><span class="line"><span class="cl">        â”‚Â Â  â”‚Â Â  â”œâ”€â”€ b.cpython-38.pyc
</span></span><span class="line"><span class="cl">        â”‚Â Â  â”‚Â Â  â”œâ”€â”€ c.cpython-38.pyc
</span></span><span class="line"><span class="cl">        â”‚Â Â  â”‚Â Â  â””â”€â”€ __init__.cpython-38.pyc
</span></span><span class="line"><span class="cl">        â”‚Â Â  â””â”€â”€ submodule
</span></span><span class="line"><span class="cl">        â”‚Â Â      â”œâ”€â”€ c.py
</span></span><span class="line"><span class="cl">        â”‚Â Â      â””â”€â”€ __pycache__
</span></span><span class="line"><span class="cl">        â”‚Â Â          â””â”€â”€ c.cpython-38.pyc
</span></span><span class="line"><span class="cl">        â”œâ”€â”€ __pycache__
</span></span><span class="line"><span class="cl">        â”‚Â Â  â””â”€â”€ b.cpython-38.pyc
</span></span><span class="line"><span class="cl">        â””â”€â”€ run
</span></span><span class="line"><span class="cl">            â””â”€â”€ run.py
</span></span></code></pre></div><p>å…¶ä¸­<code>a.py</code>å’Œ<code>b.py</code>çš„ä»£ç å¦‚ä¸‹</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># src/module/a.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">thirdparty.codes.modules</span> <span class="kn">import</span> <span class="n">b</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">print_a</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;this is a&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span><span class="o">.</span><span class="n">print_b</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">print_a</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># thirdparty/codes/modules/b.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">codes.modules.submodule</span> <span class="kn">import</span> <span class="n">c</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">print_b</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;this is b&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">c</span><span class="o">.</span><span class="n">print_c</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># thirdparty/codes/modules/submodule/c.py</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">print_c</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;this is c&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>æ­¤æ—¶ï¼Œå¦‚æœæˆ‘ä»¬åˆ†åˆ«åœ¨ä¸»ç›®å½•å’Œ<code>module</code>ç›®å½•æµ‹è¯•<code>a.py</code>æ–‡ä»¶æ—¶ä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span></span><span class="line"><span class="cl">  File <span class="s2">&#34;main.py&#34;</span>, line 1, in &lt;module&gt;
</span></span><span class="line"><span class="cl">    from src.module import a
</span></span><span class="line"><span class="cl">  File <span class="s2">&#34;/home/hakureisk/Workspace/tmp/src/module/a.py&#34;</span>, line 1, in &lt;module&gt;
</span></span><span class="line"><span class="cl">    from thirdparty.codes.modules import b
</span></span><span class="line"><span class="cl">  File <span class="s2">&#34;/home/hakureisk/Workspace/tmp/thirdparty/codes/modules/b.py&#34;</span>, line 1, in &lt;module&gt;
</span></span><span class="line"><span class="cl">    from codes.modules.submodule import c
</span></span><span class="line"><span class="cl">ModuleNotFoundError: No module named <span class="s1">&#39;codes&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span></span><span class="line"><span class="cl">  File <span class="s2">&#34;a.py&#34;</span>, line 1, in &lt;module&gt;
</span></span><span class="line"><span class="cl">    from thirdparty.codes.modules import b
</span></span><span class="line"><span class="cl">ModuleNotFoundError: No module named <span class="s1">&#39;thirdparty&#39;</span>
</span></span></code></pre></div><p>è¿™ç§é”™è¯¯åœ¨é‡åˆ°ä½¿ç”¨<code>git submodule</code>çš„æ–¹å¼å¼•å…¥ç¬¬ä¸‰æ–¹é¡¹ç›®æ—¶éå¸¸å¸¸è§ï¼Œè§£å†³æ–¹å¼å‘¢ä¹Ÿæœ‰å¾ˆå¤šç§</p>
<p>å¯¹äº<code>main.py</code>è¿™ç§å¤„äºæœ€å¤–å±‚çš„å…¥å£æ–‡ä»¶ï¼Œè§£å†³æ–¹å¼éå¸¸ç®€å•ï¼Œåªéœ€è¦å°†<code>thirdparty</code>ç›®å½•åŠ å…¥åˆ°å½“å‰æ‰§è¡Œçš„ç³»ç»Ÿè·¯å¾„ä¸­å³å¯</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;thirdparty&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;thirdparty/codes&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">src.module</span> <span class="kn">import</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span><span class="o">.</span><span class="n">print_a</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># output</span>
</span></span><span class="line"><span class="cl"><span class="n">this</span> <span class="ow">is</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="n">this</span> <span class="ow">is</span> <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="n">this</span> <span class="ow">is</span> <span class="n">c</span>
</span></span></code></pre></div><p>è€Œå¯¹äº<code>a.py</code>è¿™ç§å•ç‹¬æµ‹è¯•æ–‡ä»¶å‘¢å°±æ¯”è¾ƒéº»çƒ¦äº†ï¼Œä½ éœ€è¦å°†ç¬¬ä¸‰æ–¹åŒ…çš„ç»å¯¹è·¯å¾„æ·»åŠ åˆ°ç³»ç»Ÿè·¯å¾„ä¹‹ä¸­</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># src/module/a.py</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl">    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;/path/of/the/project/tmp&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;/path/of/the/project/tmp/thirdparty&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">thirdparty.codes.modules</span> <span class="kn">import</span> <span class="n">b</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">print_a</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;this is a&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span><span class="o">.</span><span class="n">print_b</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">print_a</span><span class="p">()</span>
</span></span></code></pre></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„demoéå¸¸ç®€å•ï¼Œå¹¶ä¸èƒ½è¦†ç›–åˆ°å…¨éƒ¨æƒ…å†µï¼Œä¾‹å¦‚å°†<code>b.py</code>æ–‡ä»¶ä¸­å¼•å…¥éƒ¨åˆ†æ”¹ä¸º<code>from modules.submodule import c</code>åˆ™ä¸Šè¿°æ–¹æ³•å°±å¤±æ•ˆäº†ï¼ˆ<code>main.py</code>é™¤å¤–ï¼‰</p>
<p>ä¸ºäº†è§£å†³è¿™ç§æƒ…å†µï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯å°†ç¬¬ä¸‰æ–¹åŒ…ä»¥<code>pth</code>æ–‡ä»¶çš„å½¢å¼å¯¼å…¥åˆ°ç³»ç»Ÿè·¯å¾„ä¹‹ä¸­ï¼Œä½¿å…¶å˜ä¸º<code>pip</code>å®‰è£…åŒ…çš„å¼•å…¥æ–¹å¼ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹</p>
<ol>
<li>æ‰¾åˆ°ç›®å‰ç¯å¢ƒä¸‹<code>site-packages</code>æ–‡ä»¶ç›®å½•</li>
</ol>
<p>æˆ‘ä»¬éœ€è¦å°†<code>pth</code>æ–‡ä»¶ä¿å­˜åœ¨å’Œç¬¬ä¸‰æ–¹åŒ…ä¸€æ ·çš„è·¯å¾„ä¹‹ä¸­ï¼Œé€šè¿‡ä¸‹é¢çš„è„šæœ¬å³å¯è·å–å½“å‰ç¯å¢ƒçš„ç¬¬ä¸‰æ–¹åŒ…è·¯å¾„</p>
<pre><code>python -m site
</code></pre>
<ol start="2">
<li>åˆ›å»º<code>pth</code>æ–‡ä»¶</li>
</ol>
<p>åœ¨å¯¹åº”çš„ç›®å½•ä¸­ï¼Œåˆ›å»ºå¯¹åº”çš„<code>pth</code>æ–‡ä»¶ï¼Œæ–‡ä»¶åè‡ªå®šä¹‰å–ä¸€ä¸ªæœ‰è¾¨è¯†åº¦ä½†å’Œå·²ç»å®‰è£…çš„åŒ…ä¸å†²çªçš„åå­—ï¼Œä¾‹å¦‚æˆ‘è¿™ä½¿ç”¨çš„<code>thirdparty.pth</code></p>
<pre><code>cd /path/to/site-packages
touch thirdparty.pth
</code></pre>
<p>åˆ›å»ºå®Œæˆåï¼Œå°†éœ€è¦å¼•å…¥çš„ç¬¬ä¸‰æ–¹åŒ…è·¯å¾„æ·»åŠ è‡³æ–‡ä»¶ä¹‹ä¸­</p>
<pre><code># /path/to/site-packages/thirdparty.pth
/path/to/third/party/module

# example
/home/xxx/tmp/
/home/xxx/tmp/thirdparty
</code></pre>
<p>æ³¨æ„ï¼Œéœ€è¦å°†å¯¹åº”çš„åŒ…æ˜ç¡®å†™å…¥æ–‡ä»¶ä¹‹ä¸­ï¼Œè¿™æ˜¯ä¸ºäº†æ–¹ä¾¿å¯»æ‰¾å…¶å­åŒ…çš„å­˜åœ¨</p>
<p>æœ€åè¿è¡Œè„šæœ¬å°±å¯ä»¥æˆåŠŸå¼•å…¥äº†: )</p>
]]></content></item><item><title>WSL2æ›´æ”¹æ¡¥æ¥ç½‘ç»œ</title><link>https://blog.thinkmoe.icu/posts/wsl2%E6%9B%B4%E6%94%B9%E6%A1%A5%E6%8E%A5%E7%BD%91%E7%BB%9C/</link><pubDate>Thu, 05 May 2022 13:34:24 +0800</pubDate><guid>https://blog.thinkmoe.icu/posts/wsl2%E6%9B%B4%E6%94%B9%E6%A1%A5%E6%8E%A5%E7%BD%91%E7%BB%9C/</guid><description>WSL2é»˜è®¤æƒ…å†µä¸‹ç½‘ç»œæ˜¯å¤„äºNATæ¨¡å¼ä¹‹ä¸‹ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹è”ç½‘æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯é‡åˆ°ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹æ—¶NATç½‘ç»œå°±éå¸¸çš„é¸¡è‚‹ã€‚ ä¾‹å¦‚ï¼ŒNATçš„WS</description><content type="html"><![CDATA[<p>WSL2é»˜è®¤æƒ…å†µä¸‹ç½‘ç»œæ˜¯å¤„äºNATæ¨¡å¼ä¹‹ä¸‹ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹è”ç½‘æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯é‡åˆ°ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹æ—¶NATç½‘ç»œå°±éå¸¸çš„é¸¡è‚‹ã€‚
ä¾‹å¦‚ï¼ŒNATçš„WSL2å¹¶ä¸èƒ½ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„ä»£ç†æœåŠ¡å™¨ï¼Œéœ€è¦æ‰‹åŠ¨è·å–æœ¬æœºIPå’Œå®¿ä¸»æœºåœ¨WSL2ä¸­çš„IPåœ°å€æ‰èƒ½è¿›è¡Œå±€åŸŸç½‘è¿æ¥ã€‚
åœ¨ä¾‹å¦‚æœ¬äººéœ€è¦åœ¨WSL2ä¸­è¿œç¨‹è¿æ¥å®éªŒå®¤è½¦è¾†ä¸Šçš„ROS2èŠ‚ç‚¹ï¼Œç”±äºNATçš„å­˜åœ¨å¯¼è‡´å°è½¦ä¸ŠROS2èŠ‚ç‚¹å‘å¸ƒçš„Topicå¹¶ä¸èƒ½åœ¨WSL2ä¸­æ¥æ”¶åˆ°ï¼Œå› æ­¤æˆ‘éœ€è¦å°†WSL2é»˜è®¤çš„NATç½‘ç»œ
æ›´æ”¹ä¸ºæ¡¥æ¥ç½‘ç»œï¼Œè¿™æ ·åœ¨ä¸å½±å“å®¿ä¸»æœºä¸Šç½‘çš„åŒæ—¶ä¹Ÿèƒ½åˆ†é…ç»™WSL2ä¸€ä¸ªå±€åŸŸç½‘åœ°å€</p>
<blockquote>
<p>æœ¬æ–¹æ³•éœ€è¦é€šè¿‡Hyper-Vè™šæ‹Ÿç½‘å¡è¿›è¡Œï¼Œå› æ­¤é¦–å…ˆéœ€è¦å®‰è£…å¹¶å¼€å¯Windowsçš„Hyper-VåŠŸèƒ½</p>
</blockquote>
<p>ä¿®æ”¹æ¡¥æ¥ç½‘ç»œæ­¥éª¤å¦‚ä¸‹(ä»¥ä¸‹æ­¥éª¤å‡åœ¨ç®¡ç†å‘˜æ¨¡å¼çš„Powershellä¸­è¿›è¡Œ)ï¼š</p>
<ol>
<li>ä»Powershellä¸­å¼€å¯wslï¼Œç”Ÿæˆç½‘å¡</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">wsl</span><span class="p">.</span><span class="py">exe</span>
</span></span></code></pre></div><p>å¦‚æœåªæ˜¯å¼€æœºè‡ªå¯çš„wslä¼šå‡ºç°æ‰¾ä¸åˆ°WSLç½‘å¡çš„é”™è¯¯
2. è·å–ç½‘å¡ä¿¡æ¯</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Get-NetAdapter</span>
</span></span></code></pre></div><p>è¿è¡Œä¹‹åå¯ä»¥æŸ¥çœ‹å½“å‰Windowsä¸­çš„ç½‘å¡è®¾å¤‡ï¼Œä¾‹å¦‚WLAN
3. æ¡¥æ¥ç½‘å¡
é€‰æ‹©WSL2éœ€è¦æ¡¥æ¥çš„ç½‘å¡è®¾å¤‡ï¼Œä»¥WLANä¸ºä¾‹</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Set-VMSwitch</span> <span class="n">WSL</span> <span class="n">-NetAdapterName</span> <span class="n">WLAN</span>
</span></span></code></pre></div><ol start="4">
<li>é…ç½®WSL2åœ°å€
è¿™æ—¶ï¼Œå·²ç»å°†WSL2çš„ç½‘å¡æ¡¥æ¥åˆ°ç‰©ç†ç½‘å¡ä¹‹ä¸Šï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®WSL2çš„é™æ€åœ°å€ï¼Œå‡è®¾è·¯ç”±å™¨çš„ç½‘å…³ä¸º<code>192.168.8.1</code>ï¼Œéœ€è¦é…ç½®é™æ€åœ°å€ä¸º<code>192.168.8.123</code>ï¼Œåˆ™å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œé…ç½®(åœ¨WSL2ä¸­è¿›è¡Œ)</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo ip addr flush dev eth0
</span></span><span class="line"><span class="cl">sudo ip addr add 192.168.8.123/24 dev eth0
</span></span><span class="line"><span class="cl">sudo ip route add 0.0.0.0/0 via 192.168.8.1 dev eth0
</span></span></code></pre></div><p>æ›´æ”¹è¿‡åè¿˜éœ€æ‰‹åŠ¨æ›´æ”¹DNSåœ°å€</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># /etc/resolv.conf</span>
</span></span><span class="line"><span class="cl">nameserver 192.168.8.1
</span></span></code></pre></div><p>ä¿å­˜å¹¶é€€å‡º</p>
<p>ä»¥ä¸Šå°±å®Œæˆäº†WSL2çš„æ¡¥æ¥ç½‘ç»œé…ç½®ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯æ¬¡éƒ½éœ€è¦æ‰‹åŠ¨æ›´æ–°DNSæ–‡ä»¶ï¼Œå¦‚æœè¿æ¥åˆ°åˆ«çš„è·¯ç”±å™¨ä¹‹ä¸‹è¿˜éœ€è¦æ‰‹åŠ¨æ›´æ–°é™æ€åœ°å€å’Œç½‘å…³åœ°å€</p>
]]></content></item><item><title>Ubuntu20.04 Install Opencv3.1.0 With Python3</title><link>https://blog.thinkmoe.icu/posts/ubuntu20.04-install-opencv3.1.0-with-python3/</link><pubDate>Mon, 28 Mar 2022 16:40:37 +0800</pubDate><guid>https://blog.thinkmoe.icu/posts/ubuntu20.04-install-opencv3.1.0-with-python3/</guid><description>å®‰è£…ä¾èµ– Ubuntu20.04éœ€è¦å®‰è£…ä»¥ä¸‹ä¾èµ– sudo apt install -y --no-install-recommends \ build-essential \ git \ wget \ unzip \ yasm \ pkg-config \ libswscale-dev \ libtbb2 \ libtbb-dev \ libjpeg-dev \ libpng-dev \ libtiff-dev \ libopenjp2-7-dev \ libavformat-dev \ libpq-dev \ libgtk2.0-dev libgtk-3-dev \ libgphoto2-dev \ libtiff5-dev libjpeg8-dev libpng-dev cmake make \</description><content type="html"><![CDATA[<h1 id="å®‰è£…ä¾èµ–">å®‰è£…ä¾èµ–</h1>
<p>Ubuntu20.04éœ€è¦å®‰è£…ä»¥ä¸‹ä¾èµ–</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo apt install -y --no-install-recommends <span class="se">\ </span>
</span></span><span class="line"><span class="cl">    build-essential <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    git <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    unzip <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    yasm <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    pkg-config <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    libswscale-dev <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    libtbb2 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    libtbb-dev <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    libjpeg-dev <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    libpng-dev <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    libtiff-dev <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    libopenjp2-7-dev <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    libavformat-dev <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    libpq-dev <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    libgtk2.0-dev libgtk-3-dev <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    libgphoto2-dev <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    libtiff5-dev libjpeg8-dev libpng-dev cmake make <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    libavformat-dev libavcodec-dev libswscale-dev libdc1394-22-dev libavresample-dev <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    libxine2-dev libv4l-dev <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    libatlas-base-dev <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    libfaac-dev libmp3lame-dev libtheora-dev <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    libvorbis-dev libxvidcore-dev <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    libeigen3-dev <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    libgstreamer1.0-0 gstreamer1.0-plugins-base <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    gstreamer1.0-plugins-good <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    gstreamer1.0-plugins-bad <span class="se">\ </span>
</span></span><span class="line"><span class="cl">    gstreamer1.0-plugins-ugly <span class="se">\ </span>
</span></span><span class="line"><span class="cl">    gstreamer1.0-libav <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    gstreamer1.0-tools <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    python3.8-dev python3-pip <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>
</span></span><span class="line"><span class="cl">pip3 install numpy
</span></span></code></pre></div><h1 id="ä¸‹è½½opencv310å’Œcontrib">ä¸‹è½½opencv3.1.0å’Œcontrib</h1>
<p>å‡è®¾ä¸‹è½½ç›®å½•ä¸º<code>OP_DIR=$HOME/opencv_project</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> <span class="nv">$OP_DIR</span>
</span></span><span class="line"><span class="cl">git clone https://github.com/opencv/opencv.git
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> opencv <span class="o">&amp;&amp;</span> git checkout 3.1.0 <span class="o">&amp;&amp;</span> <span class="nb">cd</span> ..
</span></span><span class="line"><span class="cl">git clone https://github.com/opencv/opencv_contrib.git
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> opencv_contrib <span class="o">&amp;&amp;</span> git checkout 3.1.0 <span class="o">&amp;&amp;</span> <span class="nb">cd</span> ..
</span></span></code></pre></div><h1 id="ä¿®å¤é“¾æ¥">ä¿®å¤é“¾æ¥</h1>
<p>å¦‚æœç›´æ¥cmakeæ£€æŸ¥ï¼Œåœ¨Ubuntu20.04ä¼šå‡ºç°ä¾èµ–é”™è¯¯</p>
<h2 id="1-linuxvideodevh-not-found">1. linux/videodev.h not found</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo ln -sf /usr/include/libv4l1-videodev.h /usr/include/linux/videodev.h
</span></span></code></pre></div><h2 id="2-ffmpegavformath-not-found">2. ffmpeg/avformat.h not found</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo mkdir -p /usr/include/ffmpeg 
</span></span><span class="line"><span class="cl">sudo ln -sf /usr/include/x86_64-linux-gnu/libavcodec/*.h /usr/include/ffmpeg 
</span></span><span class="line"><span class="cl">sudo ln -sf /usr/include/x86_64-linux-gnu/libavformat/*.h /usr/include/ffmpeg 
</span></span><span class="line"><span class="cl">sudo ln -sf /usr/include/x86_64-linux-gnu/libswscale/*.h /usr/include/ffmpeg 
</span></span></code></pre></div><h2 id="3-sysvideoioh-not-found">3. sys/videoio.h not found</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo mkdir -p /usr/include/sys <span class="o">&amp;&amp;</span> sudo touch /usr/include/sys/videoio.h
</span></span></code></pre></div><h1 id="cmakeæ£€æŸ¥å¹¶ç¼–è¯‘å®‰è£…">Cmakeæ£€æŸ¥å¹¶ç¼–è¯‘å®‰è£…</h1>
<pre tabindex="0"><code>cd $OP_DIR
mkdir build &amp;&amp; cd build
cmake \
-D BUILD_TIFF=ON \
-D BUILD_opencv_java=OFF \
-D WITH_CUDA=OFF \
-D WITH_OPENGL=ON \
-D WITH_OPENCL=ON \
-D WITH_IPP=ON \
-D WITH_TBB=ON \
-D WITH_EIGEN=ON \
-D WITH_V4L=ON \
-D WITH_LIBV4L=OFF \
-D BUILD_TESTS=OFF \
-D BUILD_PERF_TESTS=OFF \
-D CMAKE_BUILD_TYPE=RELEASE \
-D OPENCV_EXTRA_MODULES_PATH=$OP_DIR/opencv_contrib/modules \
-D ENABLE_PRECOMPILED_HEADERS=OFF \ # stdlib.io not found
-D PYTHON_EXECUTABLE=$(which python3) \
-D CMAKE_INSTALL_PREFIX=$(python3 -c &#34;import sys; print(sys.prefix)&#34;) \
-D PYTHON_INCLUDE_DIR=$(python3 -c &#34;from distutils.sysconfig import get_python_inc; print(get_python_inc())&#34;) \
-D PYTHON_PACKAGES_PATH=$(python3 -c &#34;from distutils.sysconfig import get_python_lib; print(get_python_lib())&#34;) \
$OP_DIR/opencv \
make -j${nproc}
sudo make install
</code></pre>]]></content></item><item><title>ROS2è™šæ‹Ÿç¯å¢ƒé…ç½®æŒ‡å—</title><link>https://blog.thinkmoe.icu/posts/ros2%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/</link><pubDate>Tue, 22 Feb 2022 14:35:57 +0800</pubDate><guid>https://blog.thinkmoe.icu/posts/ros2%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/</guid><description>åœ¨ä½¿ç”¨CARLAçš„ROS2åŒ…çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å¯¼å…¥torchå¯¹å›¾åƒè¿›è¡Œå¤„ç†ï¼ŒæŒ‰ç…§æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ¿€æ´»condaç¯å¢ƒä¹‹ååº”è¯¥å°±èƒ½å¤Ÿç›´æ¥ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰</description><content type="html"><![CDATA[<p>åœ¨ä½¿ç”¨CARLAçš„ROS2åŒ…çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å¯¼å…¥torchå¯¹å›¾åƒè¿›è¡Œå¤„ç†ï¼ŒæŒ‰ç…§æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ¿€æ´»condaç¯å¢ƒä¹‹ååº”è¯¥å°±èƒ½å¤Ÿç›´æ¥ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…çš„ç¬¬ä¸‰æ–¹åŒ…ï¼Œä½†æ˜¯åœ¨ROS2å¯åŠ¨çš„è¿‡ç¨‹ä¸­å´æç¤º<code>torch not found</code>çš„é”™è¯¯</p>
<p>å¼€å§‹æ€€ç–‘æ˜¯condaç¯å¢ƒå¯¼è‡´çš„ï¼Œäºæ˜¯æ›´æ¢ä¸ºå®˜æ–¹çš„venvï¼Œä½†æ˜¯åœ¨å®‰è£…å®Œä¾èµ–åç¼–è¯‘å¯åŠ¨æ˜¾ç¤ºè¿˜æ˜¯åŒæ ·çš„é”™è¯¯ã€‚</p>
<p>åœ¨Githubæœç´¢åå‘ç°ï¼ŒåŸæ¥é€šè¿‡colconç¼–è¯‘çš„ROS2èŠ‚ç‚¹åœ¨å¯åŠ¨çš„æ—¶å€™é»˜è®¤ä½¿ç”¨ç³»ç»Ÿç¯å¢ƒçš„Pythonç¯å¢ƒè¿è¡Œï¼Œå¹¶ä¸ä¼šåŠ è½½ç¼–è¯‘æ—¶ä½¿ç”¨çš„è™šæ‹Ÿç¯å¢ƒï¼Œå› æ­¤åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…çš„ç¬¬ä¸‰æ–¹ä¾èµ–ä¹Ÿä¸ä¼šæ­£å¸¸ä½¿ç”¨äº†ã€‚æ ¹æ®<a href="https://github.com/colcon/colcon-core/pull/183">rotu</a>çš„è¯´æ³•ï¼Œç”±äºROS2èŠ‚ç‚¹çš„è¿è¡Œæ–‡ä»¶æ˜¯ç”±colconç¼–è¯‘ç”Ÿæˆï¼Œè€Œåœ¨colconç¼–è¯‘è¿‡ç¨‹ä¸­è§£é‡Šå™¨çš„é€‰æ‹©æ˜¯å†™æ­»ä¸ºç³»ç»Ÿç¯å¢ƒçš„Pythonçš„ï¼Œé‚£æ˜¯ä¸æ˜¯ROS2å°±ç”¨ä¸äº†è™šæ‹Ÿç¯å¢ƒè¿è¡Œå‘¢ï¼Ÿ</p>
<p>å½“ç„¶ä¸æ˜¯ï¼Œæ ¹æ®ä¸Šä¸ªé“¾æ¥çš„è¯´æ³•ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ROS2çš„é…ç½®æ–‡ä»¶æ¥é—´æ¥çš„è®©ç³»ç»Ÿä½¿ç”¨è™šæ‹Ÿç¯å¢ƒä¸­çš„Pythonè§£é‡Šå™¨ï¼ŒæŒ‰ç…§<a href="https://github.com/ros2/ros2/issues/1094#issuecomment-927179578">theunkn0wn1</a>çš„æè¿°ï¼Œæ€»å…±åˆ†ä¸º4æ­¥</p>
<ol>
<li>ä¿®æ”¹setup.cfgæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®</li>
</ol>
<pre tabindex="0"><code># src/{node}/setup.cfg
[build_scripts]
executable = /usr/bin/env python3
</code></pre><ol start="2">
<li>åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ï¼Œéœ€è¦å°†ç³»ç»Ÿç¯å¢ƒä¸­çš„ROS2åŒ…é“¾æ¥åˆ°è™šæ‹Ÿç¯å¢ƒä¸­</li>
</ol>
<pre tabindex="0"><code>python3 -m venv venv --system-site-packages --symlinks
</code></pre><p>è¿™æ—¶åœ¨ç›®å½•ä¸­ä¼šç”Ÿæˆvenvæ–‡ä»¶</p>
<ol start="3">
<li>æ¿€æ´»ros2ç¯å¢ƒé…ç½®å’Œè™šæ‹Ÿç¯å¢ƒé…ç½®</li>
</ol>
<pre tabindex="0"><code>source /opt/ros/foxy/setup.zsh
source ./venv/bin/activate
</code></pre><ol start="4">
<li>colcon buildå¹¶è¿è¡Œ</li>
</ol>
<pre tabindex="0"><code>colcon build
ros2 run package_name node_name
</code></pre><p>è¿™æ—¶å°±å¯ä»¥ä½¿ç”¨åˆ°è™šæ‹Ÿç¯å¢ƒä¸­çš„ç¬¬ä¸‰æ–¹åŒ…äº†</p>
]]></content></item><item><title>ä½¿ç”¨Pytorché¢„è®­ç»ƒç½‘ç»œè·å–å›¾ç‰‡ç‰¹å¾</title><link>https://blog.thinkmoe.icu/posts/%E4%BD%BF%E7%94%A8pytorch%E9%A2%84%E8%AE%AD%E7%BB%83%E7%BD%91%E7%BB%9C%E8%8E%B7%E5%8F%96%E5%9B%BE%E7%89%87%E7%89%B9%E5%BE%81/</link><pubDate>Fri, 17 Dec 2021 17:52:42 +0800</pubDate><guid>https://blog.thinkmoe.icu/posts/%E4%BD%BF%E7%94%A8pytorch%E9%A2%84%E8%AE%AD%E7%BB%83%E7%BD%91%E7%BB%9C%E8%8E%B7%E5%8F%96%E5%9B%BE%E7%89%87%E7%89%B9%E5%BE%81/</guid><description>ç”±äºCarlaè®­ç»ƒè¿‡ç¨‹ä¸­éœ€è¦ä½¿ç”¨åˆ°å›¾åƒæ•°æ®ï¼Œè€Œé€šå¸¸æ·±åº¦å¼ºåŒ–å­¦ä¹ (DRL)ç®—æ³•ä¸­ï¼Œè¾“å…¥çš„æ•°æ®éƒ½ä¸ºä¸€ä¸ª å‘é‡(Vector)ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨å›¾åƒè¿™ç§</description><content type="html"><![CDATA[<p>ç”±äºCarlaè®­ç»ƒè¿‡ç¨‹ä¸­éœ€è¦ä½¿ç”¨åˆ°å›¾åƒæ•°æ®ï¼Œè€Œé€šå¸¸æ·±åº¦å¼ºåŒ–å­¦ä¹ (DRL)ç®—æ³•ä¸­ï¼Œè¾“å…¥çš„æ•°æ®éƒ½ä¸ºä¸€ä¸ª
å‘é‡(Vector)ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨å›¾åƒè¿™ç§äºŒç»´æ•°æ®ï¼Œé€šå¸¸çš„åšæ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªCNNç½‘ç»œï¼Œæå–å›¾åƒçš„ç‰¹å¾ï¼Œ
å°†äºŒç»´æ•°æ®è½¬åŒ–ä¸ºä¸€ç»´å‘é‡æ•°æ®ï¼Œè¿™æ ·å°±èƒ½å¤Ÿç›´æ¥ä½¿ç”¨ç°æœ‰çš„DRLç®—æ³•</p>
<p>ä¾‹å¦‚åœ¨<a href="https://github.com/DLR-RM/stable-baselines3">stable_baseline3</a>ä¸­ï¼Œæ”¯æŒMLPã€CNNå’Œ
å¤šç§ä¸åŒç±»å‹è§‚æµ‹å¯¹è±¡æ··åˆè¾“å…¥ã€‚å¯¹äºå›¾åƒæ•°æ®ï¼Œéƒ½ä½¿ç”¨äº†ä¸€ä¸ªåŸºäºCNNæ·±åº¦å·ç§¯ç½‘ç»œæ¥æå–ç‰¹å¾ã€‚</p>
<p>åœ¨pytorchä¸­å·²ç»æœ‰äº†å¾ˆå¤šä¼˜ç§€çš„CNNç‰¹å¾æå–ç½‘ç»œï¼Œåœ¨è¿™é‡Œæˆ‘å°†ä¼šä½¿ç”¨åˆ°<code>MobileNetV3</code>è¿™ä¸ªç½‘ç»œç”¨
äºæå–Carlaçš„æ‘„åƒå¤´å›¾ç‰‡ç‰¹å¾ã€‚</p>
<h1 id="è¯»å–æ¨¡å‹">è¯»å–æ¨¡å‹</h1>
<p>é¦–å…ˆéœ€è¦å®‰è£…<code>torchvision</code>è¿™ä¸ªåŒ…ï¼Œé‡Œé¢åŒ…å«äº†ç°æœ‰éå¸¸æµè¡Œçš„å›¾åƒå¤„ç†ç½‘ç»œ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pip</span> <span class="n">install</span> <span class="n">torchvision</span>
</span></span></code></pre></div><p>ç„¶åæ‰“å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œå¯¼å…¥<code>torchvision.models</code>æ¨¡å‹åŒ…</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">torchvision</span> <span class="kn">import</span> <span class="n">models</span>
</span></span></code></pre></div><h1 id="å¯¼å…¥mobilenetv3å¹¶åˆå§‹åŒ–">å¯¼å…¥MobileNetV3å¹¶åˆå§‹åŒ–</h1>
<p>Pytorchä¸ºæ¯ä¸ªç½‘ç»œéƒ½æä¾›äº†ä¸€ä¸ªé¢„è®­ç»ƒå¥½çš„ç»“æ„ï¼Œå¯ä»¥è‡ªåŠ¨ä¸‹è½½å¯¼å…¥</p>
<pre tabindex="0"><code>mobilenet = models.mobilenet.mobilenet_v3_small(pretrained=True)
mobilenet.eval()
</code></pre><p>ä¸‹é¢å°±æ˜¯MobileNetV3çš„ç½‘ç»œç»“æ„ï¼Œä»æœ€ç»ˆè¾“å‡ºå±‚å¯ä»¥å¾—çŸ¥ï¼ŒMobileNetV3ä¼šæå–1000ä¸ªç‰¹å¾å€¼</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">MobileNetV3<span class="o">(</span>
</span></span><span class="line"><span class="cl">  <span class="o">(</span>features<span class="o">)</span>: Sequential<span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="o">(</span>0<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>3, 16, <span class="nv">kernel_size</span><span class="o">=(</span>3, 3<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>2, 2<span class="o">)</span>, <span class="nv">padding</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>16, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">(</span>2<span class="o">)</span>: Hardswish<span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">(</span>1<span class="o">)</span>: InvertedResidual<span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="o">(</span>block<span class="o">)</span>: Sequential<span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>0<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>16, 16, <span class="nv">kernel_size</span><span class="o">=(</span>3, 3<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>2, 2<span class="o">)</span>, <span class="nv">padding</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">groups</span><span class="o">=</span>16, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>16, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>2<span class="o">)</span>: ReLU<span class="o">(</span><span class="nv">inplace</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>1<span class="o">)</span>: SqueezeExcitation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>avgpool<span class="o">)</span>: AdaptiveAvgPool2d<span class="o">(</span><span class="nv">output_size</span><span class="o">=</span>1<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>fc1<span class="o">)</span>: Conv2d<span class="o">(</span>16, 8, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">))</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>fc2<span class="o">)</span>: Conv2d<span class="o">(</span>8, 16, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">))</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>activation<span class="o">)</span>: ReLU<span class="o">()</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>scale_activation<span class="o">)</span>: Hardsigmoid<span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>2<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>16, 16, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>16, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">(</span>2<span class="o">)</span>: InvertedResidual<span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="o">(</span>block<span class="o">)</span>: Sequential<span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>0<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>16, 72, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>72, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>2<span class="o">)</span>: ReLU<span class="o">(</span><span class="nv">inplace</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>1<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>72, 72, <span class="nv">kernel_size</span><span class="o">=(</span>3, 3<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>2, 2<span class="o">)</span>, <span class="nv">padding</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">groups</span><span class="o">=</span>72, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>72, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>2<span class="o">)</span>: ReLU<span class="o">(</span><span class="nv">inplace</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>2<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>72, 24, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>24, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">(</span>3<span class="o">)</span>: InvertedResidual<span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="o">(</span>block<span class="o">)</span>: Sequential<span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>0<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>24, 88, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>88, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>2<span class="o">)</span>: ReLU<span class="o">(</span><span class="nv">inplace</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>1<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>88, 88, <span class="nv">kernel_size</span><span class="o">=(</span>3, 3<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">padding</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">groups</span><span class="o">=</span>88, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>88, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>2<span class="o">)</span>: ReLU<span class="o">(</span><span class="nv">inplace</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>2<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>88, 24, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>24, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">(</span>4<span class="o">)</span>: InvertedResidual<span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="o">(</span>block<span class="o">)</span>: Sequential<span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>0<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>24, 96, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>96, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>2<span class="o">)</span>: Hardswish<span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>1<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>96, 96, <span class="nv">kernel_size</span><span class="o">=(</span>5, 5<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>2, 2<span class="o">)</span>, <span class="nv">padding</span><span class="o">=(</span>2, 2<span class="o">)</span>, <span class="nv">groups</span><span class="o">=</span>96, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>96, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>2<span class="o">)</span>: Hardswish<span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>2<span class="o">)</span>: SqueezeExcitation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>avgpool<span class="o">)</span>: AdaptiveAvgPool2d<span class="o">(</span><span class="nv">output_size</span><span class="o">=</span>1<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>fc1<span class="o">)</span>: Conv2d<span class="o">(</span>96, 24, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">))</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>fc2<span class="o">)</span>: Conv2d<span class="o">(</span>24, 96, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">))</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>activation<span class="o">)</span>: ReLU<span class="o">()</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>scale_activation<span class="o">)</span>: Hardsigmoid<span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>3<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>96, 40, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>40, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">(</span>5<span class="o">)</span>: InvertedResidual<span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="o">(</span>block<span class="o">)</span>: Sequential<span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>0<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>40, 240, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>240, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>2<span class="o">)</span>: Hardswish<span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>1<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>240, 240, <span class="nv">kernel_size</span><span class="o">=(</span>5, 5<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">padding</span><span class="o">=(</span>2, 2<span class="o">)</span>, <span class="nv">groups</span><span class="o">=</span>240, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>240, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>2<span class="o">)</span>: Hardswish<span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>2<span class="o">)</span>: SqueezeExcitation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>avgpool<span class="o">)</span>: AdaptiveAvgPool2d<span class="o">(</span><span class="nv">output_size</span><span class="o">=</span>1<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>fc1<span class="o">)</span>: Conv2d<span class="o">(</span>240, 64, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">))</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>fc2<span class="o">)</span>: Conv2d<span class="o">(</span>64, 240, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">))</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>activation<span class="o">)</span>: ReLU<span class="o">()</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>scale_activation<span class="o">)</span>: Hardsigmoid<span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>3<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>240, 40, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>40, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">(</span>6<span class="o">)</span>: InvertedResidual<span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="o">(</span>block<span class="o">)</span>: Sequential<span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>0<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>40, 240, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>240, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>2<span class="o">)</span>: Hardswish<span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>1<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>240, 240, <span class="nv">kernel_size</span><span class="o">=(</span>5, 5<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">padding</span><span class="o">=(</span>2, 2<span class="o">)</span>, <span class="nv">groups</span><span class="o">=</span>240, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>240, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>2<span class="o">)</span>: Hardswish<span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>2<span class="o">)</span>: SqueezeExcitation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>avgpool<span class="o">)</span>: AdaptiveAvgPool2d<span class="o">(</span><span class="nv">output_size</span><span class="o">=</span>1<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>fc1<span class="o">)</span>: Conv2d<span class="o">(</span>240, 64, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">))</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>fc2<span class="o">)</span>: Conv2d<span class="o">(</span>64, 240, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">))</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>activation<span class="o">)</span>: ReLU<span class="o">()</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>scale_activation<span class="o">)</span>: Hardsigmoid<span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>3<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>240, 40, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>40, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">(</span>7<span class="o">)</span>: InvertedResidual<span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="o">(</span>block<span class="o">)</span>: Sequential<span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>0<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>40, 120, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>120, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>2<span class="o">)</span>: Hardswish<span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>1<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>120, 120, <span class="nv">kernel_size</span><span class="o">=(</span>5, 5<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">padding</span><span class="o">=(</span>2, 2<span class="o">)</span>, <span class="nv">groups</span><span class="o">=</span>120, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>120, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>2<span class="o">)</span>: Hardswish<span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>2<span class="o">)</span>: SqueezeExcitation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>avgpool<span class="o">)</span>: AdaptiveAvgPool2d<span class="o">(</span><span class="nv">output_size</span><span class="o">=</span>1<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>fc1<span class="o">)</span>: Conv2d<span class="o">(</span>120, 32, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">))</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>fc2<span class="o">)</span>: Conv2d<span class="o">(</span>32, 120, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">))</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>activation<span class="o">)</span>: ReLU<span class="o">()</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>scale_activation<span class="o">)</span>: Hardsigmoid<span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>3<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>120, 48, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>48, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">(</span>8<span class="o">)</span>: InvertedResidual<span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="o">(</span>block<span class="o">)</span>: Sequential<span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>0<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>48, 144, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>144, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>2<span class="o">)</span>: Hardswish<span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>1<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>144, 144, <span class="nv">kernel_size</span><span class="o">=(</span>5, 5<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">padding</span><span class="o">=(</span>2, 2<span class="o">)</span>, <span class="nv">groups</span><span class="o">=</span>144, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>144, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>2<span class="o">)</span>: Hardswish<span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>2<span class="o">)</span>: SqueezeExcitation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>avgpool<span class="o">)</span>: AdaptiveAvgPool2d<span class="o">(</span><span class="nv">output_size</span><span class="o">=</span>1<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>fc1<span class="o">)</span>: Conv2d<span class="o">(</span>144, 40, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">))</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>fc2<span class="o">)</span>: Conv2d<span class="o">(</span>40, 144, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">))</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>activation<span class="o">)</span>: ReLU<span class="o">()</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>scale_activation<span class="o">)</span>: Hardsigmoid<span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>3<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>144, 48, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>48, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">(</span>9<span class="o">)</span>: InvertedResidual<span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="o">(</span>block<span class="o">)</span>: Sequential<span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>0<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>48, 288, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>288, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>2<span class="o">)</span>: Hardswish<span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>1<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>288, 288, <span class="nv">kernel_size</span><span class="o">=(</span>5, 5<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>2, 2<span class="o">)</span>, <span class="nv">padding</span><span class="o">=(</span>2, 2<span class="o">)</span>, <span class="nv">groups</span><span class="o">=</span>288, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>288, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>2<span class="o">)</span>: Hardswish<span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>2<span class="o">)</span>: SqueezeExcitation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>avgpool<span class="o">)</span>: AdaptiveAvgPool2d<span class="o">(</span><span class="nv">output_size</span><span class="o">=</span>1<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>fc1<span class="o">)</span>: Conv2d<span class="o">(</span>288, 72, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">))</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>fc2<span class="o">)</span>: Conv2d<span class="o">(</span>72, 288, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">))</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>activation<span class="o">)</span>: ReLU<span class="o">()</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>scale_activation<span class="o">)</span>: Hardsigmoid<span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>3<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>288, 96, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>96, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">(</span>10<span class="o">)</span>: InvertedResidual<span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="o">(</span>block<span class="o">)</span>: Sequential<span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>0<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>96, 576, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>576, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>2<span class="o">)</span>: Hardswish<span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>1<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>576, 576, <span class="nv">kernel_size</span><span class="o">=(</span>5, 5<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">padding</span><span class="o">=(</span>2, 2<span class="o">)</span>, <span class="nv">groups</span><span class="o">=</span>576, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>576, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>2<span class="o">)</span>: Hardswish<span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>2<span class="o">)</span>: SqueezeExcitation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>avgpool<span class="o">)</span>: AdaptiveAvgPool2d<span class="o">(</span><span class="nv">output_size</span><span class="o">=</span>1<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>fc1<span class="o">)</span>: Conv2d<span class="o">(</span>576, 144, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">))</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>fc2<span class="o">)</span>: Conv2d<span class="o">(</span>144, 576, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">))</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>activation<span class="o">)</span>: ReLU<span class="o">()</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>scale_activation<span class="o">)</span>: Hardsigmoid<span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>3<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>576, 96, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>96, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">(</span>11<span class="o">)</span>: InvertedResidual<span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="o">(</span>block<span class="o">)</span>: Sequential<span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>0<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>96, 576, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>576, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>2<span class="o">)</span>: Hardswish<span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>1<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>576, 576, <span class="nv">kernel_size</span><span class="o">=(</span>5, 5<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">padding</span><span class="o">=(</span>2, 2<span class="o">)</span>, <span class="nv">groups</span><span class="o">=</span>576, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>576, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>2<span class="o">)</span>: Hardswish<span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>2<span class="o">)</span>: SqueezeExcitation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>avgpool<span class="o">)</span>: AdaptiveAvgPool2d<span class="o">(</span><span class="nv">output_size</span><span class="o">=</span>1<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>fc1<span class="o">)</span>: Conv2d<span class="o">(</span>576, 144, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">))</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>fc2<span class="o">)</span>: Conv2d<span class="o">(</span>144, 576, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">))</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>activation<span class="o">)</span>: ReLU<span class="o">()</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>scale_activation<span class="o">)</span>: Hardsigmoid<span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span>3<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>576, 96, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>96, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">(</span>12<span class="o">)</span>: ConvNormActivation<span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="o">(</span>0<span class="o">)</span>: Conv2d<span class="o">(</span>96, 576, <span class="nv">kernel_size</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">stride</span><span class="o">=(</span>1, 1<span class="o">)</span>, <span class="nv">bias</span><span class="o">=</span>False<span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">(</span>1<span class="o">)</span>: BatchNorm2d<span class="o">(</span>576, <span class="nv">eps</span><span class="o">=</span>0.001, <span class="nv">momentum</span><span class="o">=</span>0.01, <span class="nv">affine</span><span class="o">=</span>True, <span class="nv">track_running_stats</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">(</span>2<span class="o">)</span>: Hardswish<span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">(</span>avgpool<span class="o">)</span>: AdaptiveAvgPool2d<span class="o">(</span><span class="nv">output_size</span><span class="o">=</span>1<span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">(</span>classifier<span class="o">)</span>: Sequential<span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="o">(</span>0<span class="o">)</span>: Linear<span class="o">(</span><span class="nv">in_features</span><span class="o">=</span>576, <span class="nv">out_features</span><span class="o">=</span>1024, <span class="nv">bias</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">(</span>1<span class="o">)</span>: Hardswish<span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">(</span>2<span class="o">)</span>: Dropout<span class="o">(</span><span class="nv">p</span><span class="o">=</span>0.2, <span class="nv">inplace</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">(</span>3<span class="o">)</span>: Linear<span class="o">(</span><span class="nv">in_features</span><span class="o">=</span>1024, <span class="nv">out_features</span><span class="o">=</span>1000, <span class="nv">bias</span><span class="o">=</span>True<span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span></code></pre></div><h1 id="æµ‹è¯•æ¨¡å‹">æµ‹è¯•æ¨¡å‹</h1>
<p>pytorchå®˜æ–¹è®­ç»ƒçš„æ¨¡å‹å¯¹è¾“å…¥æœ‰ä¸¥æ ¼é™åˆ¶ï¼Œå¿…é¡»æ˜¯Tensorç±»å‹çš„æ•°ç»„ï¼ŒåŒ…å«å¤šå¹…å›¾åƒã€‚ä¸ºäº†æµ‹è¯•ä¸€å¼ å›¾åƒï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨PILè¯»å–å›¾ç‰‡ä¹‹å
ä½¿ç”¨å®˜æ–¹çš„transformå·¥å…·è½¬ä¸ºå¯è¾“å…¥çš„Tensorç±»å‹æ•°æ®åï¼Œæ’å…¥åˆ°ç©ºæ•°ç»„ä¸­å¾—åˆ°ç‰¹å¾å€¼</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¯»å–å›¾åƒ</span>
</span></span><span class="line"><span class="cl"><span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;image/path&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å®šä¹‰transform</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">torchvision</span> <span class="kn">import</span> <span class="n">transforms</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">  <span class="n">transforms</span><span class="o">.</span><span class="n">Resize</span><span class="p">(</span><span class="mi">128</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">  <span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">mean</span><span class="o">=</span><span class="p">[</span><span class="mf">0.485</span><span class="p">,</span> <span class="mf">0.456</span><span class="p">,</span> <span class="mf">0.405</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">=</span><span class="p">[</span><span class="mf">0.229</span><span class="p">,</span> <span class="mf">0.224</span><span class="p">,</span> <span class="mf">0.225</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è·å–Tensor</span>
</span></span><span class="line"><span class="cl"><span class="n">img_tensor</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è½¬ä¸ºbatch</span>
</span></span><span class="line"><span class="cl"><span class="n">batch_t</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="n">img_tensor</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æµ‹è¯•</span>
</span></span><span class="line"><span class="cl"><span class="n">features</span> <span class="o">=</span> <span class="n">mobilenet</span><span class="p">(</span><span class="n">batch_t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="c1"># torch.Size([1000])</span>
</span></span></code></pre></div><p>è¿™æ ·ï¼Œå°±æœ‰äº†å¤§å°ä¸º1000çš„ç‰¹å¾å‘é‡ï¼Œå¯ä»¥ä½œä¸ºç¯å¢ƒçš„çŠ¶æ€è¿›è¡ŒDRLè®­ç»ƒäº†</p>
]]></content></item><item><title>Dockerå¤šçº§æ„å»ºæŒ‡å—</title><link>https://blog.thinkmoe.icu/posts/docker%E5%A4%9A%E7%BA%A7%E6%9E%84%E5%BB%BA%E6%8C%87%E5%8D%97/</link><pubDate>Wed, 25 Aug 2021 09:01:12 +0800</pubDate><guid>https://blog.thinkmoe.icu/posts/docker%E5%A4%9A%E7%BA%A7%E6%9E%84%E5%BB%BA%E6%8C%87%E5%8D%97/</guid><description>å¤šçº§æ„å»ºè®©ä½ çš„å®¹å™¨æ›´å°å·§~ åœ¨æ„å»ºDockeré•œåƒçš„æ—¶å€™ç»å¸¸å‘ç°æ„å»ºå‡ºæ¥çš„å®¹å™¨å¤§å°éå¸¸çš„å¤§ï¼Œè€Œæˆ‘æœ¬åœ°ç¼–è¯‘å‡ºæ¥çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¹Ÿä¸è¿‡26MBå·¦å³è€ŒD</description><content type="html"><![CDATA[<blockquote>
<p>å¤šçº§æ„å»ºè®©ä½ çš„å®¹å™¨æ›´å°å·§~</p>
</blockquote>
<p>åœ¨æ„å»ºDockeré•œåƒçš„æ—¶å€™ç»å¸¸å‘ç°æ„å»ºå‡ºæ¥çš„å®¹å™¨å¤§å°éå¸¸çš„å¤§ï¼Œè€Œæˆ‘æœ¬åœ°ç¼–è¯‘å‡ºæ¥çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¹Ÿä¸è¿‡26MBå·¦å³è€ŒDockerå®¹å™¨å±…ç„¶æœ‰120MBï¼
é—®é¢˜å‡ºç°åœ¨å“ªé‡Œäº†å‘¢ï¼Ÿæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥ä»æœ€èµ·å§‹çš„åœ°æ–¹å¼€å§‹çœ‹èµ·</p>
<h2 id="æ„å»ºæ–¹å¼">æ„å»ºæ–¹å¼</h2>
<p>Dockerå®¹å™¨çš„æ„å»ºæ–¹æ³•æˆ‘ä¸ªäººå¸¸ç”¨ä»¥ä¸‹å‡ ç§</p>
<ol>
<li>æœ¬åœ°æ‰“åŒ…äºŒè¿›åˆ¶åç›´æ¥æ”¾å…¥Dockerä¸­è¿è¡Œ</li>
<li>å®¹å™¨å†…æ‰“åŒ…ç›´æ¥è¿è¡Œ</li>
</ol>
<p>ç¬¬ä¸€ç§çš„æ–¹å¼å°±æ˜¯åœ¨æœ¬åœ°ç¼–è¯‘å¥½è¦æ‰§è¡Œçš„æ–‡ä»¶ä¹‹åæ”¾å…¥å®¹å™¨ä¹‹ä¸­è¿è¡Œï¼Œè¿™ç§æ–¹å¼æ— ç–‘æ˜¯æœ€ç®€å•çš„æ–¹æ³•ä¹Ÿæ˜¯æœ€å®¹æ˜“ç†è§£çš„æ–¹æ³•ã€‚
ä½†è¿™ç§æ–¹æ³•ä»”ç»†ä¸€æƒ³å°±ä¼šå‘ç°æœ‰å¾ˆå¤šé—®é¢˜ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦åœ¨Windowsæœºå™¨ç¼–è¯‘Linuxç‰ˆæœ¬çš„å®¹å™¨å†…è¿è¡Œè¦æ€ä¹ˆåŠå‘¢ï¼Ÿ
é™¤æ­¤ä¹‹å¤–ï¼Œå‡è®¾æˆ‘ä»¬æ¢äº†ä¸€å°æœºå™¨ä¹Ÿéœ€è¦ç¼–è¯‘ä¸€ä»½Dockeré•œåƒæ—¶ï¼Œæœ¬åœ°æ²¡æœ‰å¯¹åº”çš„ç¼–è¯‘å·¥å…·è¦å¦‚ä½•è§£å†³å‘¢ï¼Ÿ
ä¸ºäº†åº”å¯¹ä¸Šè¿°é—®é¢˜ï¼Œä¹Ÿå°±æœ‰äº†ç¬¬äºŒç§æ–¹æ³•ã€‚</p>
<p>ç¬¬äºŒç§çš„æ–¹å¼å°±æ˜¯å°†ä»£ç æ”¾åœ¨å®¹å™¨å†…éƒ¨ç¼–è¯‘ï¼Œè¿™æ ·æ—¢è§£å†³äº†ç¼–è¯‘ç¯å¢ƒé—®é¢˜ä¹Ÿè§£å†³äº†ç¼–è¯‘å¹³å°çš„é—®é¢˜ã€‚
ä½†ç¬¬äºŒç§æ–¹æ³•å¸¦æ¥çš„é—®é¢˜å°±æ˜¯æˆ‘ä»Šå¤©è¦è¯´çš„ï¼Œé‚£å°±æ˜¯æ‰“åŒ…åçš„é•œåƒä½“ç§¯è¿‡å¤§ï¼Œå®Œå…¨ä¸å¦‚ç¬¬ä¸€ç§æ‰“åŒ…å‡ºæ¥çš„é•œåƒã€‚
è¿™æ˜¯å› ä¸ºï¼Œç¬¬ä¸€ç§åªæ˜¯å°†äºŒè¿›åˆ¶æ–‡ä»¶æ”¾å…¥å®¹å™¨å†…ç›´æ¥è¿è¡Œï¼Œè€Œç¬¬äºŒç§è¿˜æ·»åŠ äº†é¡¹ç›®çš„æºä»£ç æ–‡ä»¶ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€å †ç”¨äº
ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶çš„å·¥å…·åœ¨é•œåƒä¹‹ä¸­ï¼Œå› æ­¤æ‰“åŒ…å‡ºæ¥çš„é•œåƒä½“ç§¯ä¼šéå¸¸å·¨å¤§ã€‚
é‚£æœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•æ—¢èƒ½éšæ„æ„å»ºåˆä¸äº§ç”Ÿå¤§ä½“ç§¯çš„é•œåƒå‘¢ï¼Ÿé‚£å°±è¦è°ˆè°ˆDockerçš„å¤šçº§æ„å»ºäº†ã€‚</p>
<h2 id="å¤šçº§æ„å»º">å¤šçº§æ„å»º</h2>
<p>Dockerçš„å¤šçº§æ„å»ºä¹Ÿå°±æ˜¯å¸¸è¯´çš„<code>multi-stage build</code>ï¼Œä½ å¯ä»¥é€šè¿‡æŒ‡å®šå¤šä¸ªstageåˆ†åˆ«å®Œæˆä¸åŒçš„ä»»åŠ¡æœ€ååˆåœ¨ä¸€èµ·å®Œæˆæœ€ç»ˆçš„æ„å»ºã€‚</p>
<p>ä¾‹å¦‚æœ‰ä¸€ä¸ªGoçš„é¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨stage1é˜¶æ®µè¿›è¡Œç¼–è¯‘æ“ä½œï¼Œè€Œåœ¨stage2é˜¶æ®µè¿›è¡Œè¿è¡Œæ“ä½œï¼Œè¿™æ ·å°±ç›¸å½“äºæ„å»º1å’Œ2ç›¸ç»“åˆï¼Œå®Œæˆæœ€åçš„æ„å»ºã€‚</p>
<p>å¤šçº§æ„å»ºå…¶å®éå¸¸ç®€å•ï¼Œå…¶ç²¾é«“å°±åœ¨äºä¸€ä¸ªå‘½ä»¤é‚£å°±æ˜¯<code>COPY</code>ï¼Œè¿™ä¸ªå‘½ä»¤ä¸ä»…ä»…å¯ä»¥å°†æœ¬åœ°æ–‡ä»¶æ‹·è´è‡³Dockerçš„buildè¿›ç¨‹ä¸Šä¸‹æ–‡ä¸­ï¼Œè¿˜å¯ä»¥åœ¨å¤šä¸ªstageä¸­
è¿›è¡Œæ–‡ä»¶çš„å¤åˆ¶ï¼Œè€Œ<code>ADD</code>å‘½ä»¤åˆ™åªèƒ½ç”¨äºå‰è€…ï¼Œå› æ­¤æˆ‘é€šå¸¸åœ¨ç¬¬ä¸€çº§æ„å»ºæ—¶ä½¿ç”¨<code>ADD</code>å‘½ä»¤å°†æ‰€æœ‰çš„æºä»£ç å¤åˆ¶åˆ°Dockerä¸Šä¸‹æ–‡ä¸­åï¼Œä½¿ç”¨<code>COPY</code>åº”å¯¹å…¶ä»–å±‚çº§çš„æ„å»ºã€‚<code>COPY</code>çš„å‚æ•°éå¸¸ç®€å•</p>
<pre><code>COPY --from=stage source dest
</code></pre>
<p>å…¶ä¸­<code>from</code>å°±æ˜¯ç”¨äºè¡¨æ˜ä»å“ªä¸ªstageä¸­å¤åˆ¶æ–‡ä»¶ï¼Œä¸æ·»åŠ è¯¥å‚æ•°åˆ™é»˜è®¤ä»å®¿ä¸»æœºä¸­å¤åˆ¶æ–‡ä»¶ã€‚stageå¯ä»¥ç”¨æ•°å­—è¡¨ç¤ºä»ç¬¬å‡ çº§å¤åˆ¶(ä»0å¼€å§‹)ï¼Œä¹Ÿå¯ä»¥ç”¨å­—ç¬¦ä¸²æ¥æŒ‡å®šå±‚çº§å¤åˆ¶ä½†éœ€è¦å¯¹å±‚çº§è¿›è¡Œå‘½å</p>
<pre><code># builder stage
FROM x as builder

# final stage
FROM x as final
COPY --from=builder /abc /abc
COPY --from=0 /abc/abc
</code></pre>
<h2 id="å®æˆ˜">å®æˆ˜</h2>
<p>ä»¥æˆ‘çš„<a href="https://github.com/miRemid/yuki">Yuki</a>ä¸ºä¾‹ï¼Œè¯¥é¡¹ç›®ç”±<code>React</code>å’Œ<code>Go</code>ç»„æˆï¼Œå…¶ä¸­<code>Go</code>å°†ä¼šæä¾›æœåŠ¡å™¨æä¾›å‰ç«¯æ¥å£ã€‚</p>
<p>é¦–å…ˆåˆ†æé˜¶å±‚ï¼Œæˆ‘ä»¬éœ€è¦ç¼–è¯‘ä¸¤ä¸ªé¡¹ç›®ï¼Œå…¶ä¸­æ˜¯<code>React</code>å¦ä¸€ä¸ªæ˜¯<code>Go</code>ï¼Œå¹¶ä¸”<code>Go</code>çš„ç¼–è¯‘éœ€è¦ä¾èµ–äº<code>React</code>ã€‚å› æ­¤å¾ˆå®¹æ˜“å¾—å‡ºï¼Œä»¥ä¸‹é¡ºåº</p>
<ol>
<li>ç¼–è¯‘React</li>
<li>ç¼–è¯‘Go</li>
<li>è¿è¡Œ</li>
</ol>
<p>ä¸ºäº†è®©ç¼–è¯‘å‡ºæ¥çš„å®¹å™¨å°½å¯èƒ½çš„å°ï¼Œæˆ‘ä»¬åœ¨é€‰å–æ„å»ºå®¹å™¨æ—¶ä¹Ÿå°½é‡é€‰æ‹©å°çš„å®¹å™¨æ¥è¿›è¡Œç¼–è¯‘ä¾‹å¦‚æˆ‘æœ€å–œæ¬¢çš„<code>alpine</code>ã€‚å› æ­¤åœ¨<a href="https://hub.docker.com">Docker Hub</a>ä¸­å¯»æ‰¾å…³äº<code>nodejs</code>å’Œ<code>golang</code>çš„<code>alpine</code>ç‰ˆæœ¬ï¼Œç”±äºåŸç‰ˆ<code>golang</code>çš„<code>alpine</code>ç‰ˆæœ¬ä¸é™„å¸¦<code>gcc</code>å› æ­¤æˆ‘é€‰æ‹©äº†ç¬¬ä¸‰æ–¹çš„å®¹å™¨<code>tetafro/golang-gcc</code>ã€‚è€Œæä¾›è¿è¡Œç¯å¢ƒçš„å®¹å™¨æˆ‘ä¹Ÿé€‰æ‹©äº†<code>alpine:3.14</code></p>
<ul>
<li>NodeJS: node:14.17.5-alpine(117MB)</li>
<li>Golang: tetafro/golang-gcc:1.16-alpine(425MB)</li>
<li>Runtime: alpine:3.14(5.6MB)</li>
</ul>
<p>åœ¨é€‰æ‹©å®Œæ„å»ºå®¹å™¨åå°±å¯ä»¥æ­£å¼æ„å»ºè‡ªå·±çš„ç¨‹åºäº†ï¼Œé¦–å…ˆæ˜¯Reactçš„æ‰“åŒ…ï¼Œæ³¨æ„çš„æ˜¯å¦‚æœå°†<code>node_modules</code>æ–‡ä»¶ä¸€å¹¶Addçš„è¯å°†ä¸ä¼šå†æ‹‰å–ä¸€éä¸ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ï¼Œå› æ­¤éœ€è¦æè¯·ç¼–å†™ä¸€ä¸ªç±»ä¼¼äº<code>.gitignore</code>æ–‡ä»¶çš„<code>.dockerignore</code>æ–‡ä»¶ï¼Œä¾‹å¦‚æˆ‘ä½¿ç”¨çš„</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">cat ./dockerignore
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">release
</span></span><span class="line"><span class="cl">data
</span></span><span class="line"><span class="cl">web/node_modules
</span></span><span class="line"><span class="cl">web/dist
</span></span><span class="line"><span class="cl">.git
</span></span><span class="line"><span class="cl">.cache
</span></span></code></pre></div><p>è¿™æ ·å°±å¯ä»¥å®‰å¿ƒå†™<code>Dockerfile</code>äº†</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="c"># build react</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># ä½¿ç”¨ä¸‹è½½çš„nodeå®¹å™¨ï¼Œå¹¶å°†è¯¥é˜¶æ®µå‘½åä¸ºnode</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> node:14.17.5-alpine as node</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># å°†æ‰€æœ‰æºä»£ç æ”¾å…¥å®¹å™¨çš„/yukiæ–‡ä»¶å¤¹ä¸­</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ADD</span> . /yuki<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># åˆ‡æ¢å½“å‰å·¥ä½œè·¯å¾„åˆ°/yuki/webä¸­ï¼Œè¯¥ç›®å½•æ˜¯Reactå·¥ç¨‹æ ¹ç›®å½•</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /yuki/web</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># æ‹‰å–ä¾èµ–å¹¶æ‰“åŒ…ï¼Œ/yuki/web/dist</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yarn <span class="o">&amp;&amp;</span> yarn build<span class="err">
</span></span></span></code></pre></div><p>åœ¨æ„å»ºå®Œå‰ç«¯åå°±å¯ä»¥æ¥ç¼–è¯‘åç«¯é¡¹ç›®äº†ï¼Œè¿™æ—¶å°±è¦ä½¿ç”¨å¤šçº§æ„å»ºä¸­çš„<code>COPY</code>å‘½ä»¤äº†</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="c"># build golang</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># ä½¿ç”¨ä¸‹è½½çš„goå®¹å™¨ï¼Œå¹¶å°†è¯¥é˜¶æ®µå‘½åä¸ºgolang</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> tetafro/golang-gcc:1.16-alpine as golang</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># ä»nodeå±‚ä¸­å¤åˆ¶æºä»£ç åˆ°æœ¬å±‚çš„/yukiä¸­ï¼Œæ­¤æ—¶æ–‡ä»¶å¤¹ä¸­å·²ç»åŒ…å«äº†nodeå±‚æ‰“åŒ…å¥½çš„å‰ç«¯é¡¹ç›®</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> --from<span class="o">=</span>node /yuki /yuki<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># åˆ‡æ¢å·¥ä½œè·¯å¾„</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /yuki</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># é™æ€ç¼–è¯‘</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nv">CGO_ENABLE</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span>linux <span class="nv">GOARCH</span><span class="o">=</span>amd64 go build -mod<span class="o">=</span>vendor -a -ldflags <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	<span class="s1">&#39; -extldflags &#34;-static&#34;&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-o yuki_linux_amd64<span class="err">
</span></span></span></code></pre></div><p>æ„å»ºå®ŒäºŒè¿›åˆ¶æ–‡ä»¶åï¼Œå°±éœ€è¦å°†äºŒè¿›åˆ¶æ–‡ä»¶å’Œä¸€äº›å¿…è¦çš„é™æ€æ–‡ä»¶æ”¾å…¥åˆ°æœ€ç»ˆçš„è¿è¡Œå®¹å™¨ä¸­è¿è¡Œäº†</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="k">FROM</span><span class="s"> alpine:3.14</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># ä»golangå±‚å¤åˆ¶æ‰€éœ€è¦çš„æ–‡ä»¶</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> --from<span class="o">=</span>golang /yuki/yuki_linux_amd64 /yuki_linux_amd64<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> --from<span class="o">=</span>golang /yuki/docs /docs<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># åˆ‡æ¢å·¥ä½œè·¯å¾„</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># è¿è¡Œ</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span> <span class="s2">&#34;sh&#34;</span><span class="p">,</span> <span class="s2">&#34;-c&#34;</span><span class="p">,</span> <span class="s2">&#34;/yuki_linux_amd64&#34;</span> <span class="p">]</span><span class="err">
</span></span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æœ€ååªå¤åˆ¶äº†å¿…è¦çš„äºŒè¿›åˆ¶æ–‡ä»¶å’Œæ‰€éœ€è¦çš„é™æ€æ–‡ä»¶åˆ°æœ€åçš„å®¹å™¨ä¹‹ä¸­ï¼Œå¹¶æ²¡æœ‰å…¶ä»–ä»»ä½•ä¸œè¥¿ï¼Œå› æ­¤æœ€ç»ˆçš„å®¹å™¨å¤§å°ç†è®ºä¸Šæ˜¯é»˜è®¤å¤§å°åŠ ä¸ŠäºŒè¿›åˆ¶æ–‡ä»¶å¤§å°ï¼Œäº‹å®æ˜¯è¿™æ ·å—ã€‚äº‹å®ä¸Šä¹Ÿç¡®å®å¦‚æ­¤ï¼ŒæŸ¥çœ‹æœ¬åœ°é™æ€ç¼–è¯‘æ–‡ä»¶å¤§å°å’Œæ‰“åŒ…åçš„é•œåƒå¤§å°å‘ç°ä¸¤è€…ç›¸å·®å‡ ä¹ç­‰äºé•œåƒçš„å¤§å°</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">zsh&gt; <span class="nb">cd</span> release <span class="o">&amp;&amp;</span> ll
</span></span><span class="line"><span class="cl">-rwxrwxr-x <span class="m">1</span> kamir kamir  26M Aug <span class="m">25</span> 09:39 yuki_linux_amd64
</span></span><span class="line"><span class="cl">zsh&gt; docker images <span class="p">|</span> grep yuki
</span></span><span class="line"><span class="cl">yuki                  latest                  eb2e260d4701   <span class="m">5</span> hours ago    32.8MB
</span></span><span class="line"><span class="cl">zsh&gt; docker images <span class="p">|</span> grep alpine
</span></span><span class="line"><span class="cl">alpine                3.14                    021b3423115f   <span class="m">2</span> weeks ago    5.6MB
</span></span></code></pre></div><p>è¿™æ ·ä¸€ä¸ªå®Œç¾çš„å°å®¹å™¨å°±è¯ç”Ÿäº†~</p>
]]></content></item><item><title>Ubuntu Server 20.04 è®¾ç½®IPå’Œç½‘å…³åœ°å€</title><link>https://blog.thinkmoe.icu/posts/ubuntu-server-20.04-%E8%AE%BE%E7%BD%AEip%E5%9C%B0%E5%9D%80%E5%92%8C%E7%BD%91%E5%85%B3%E5%9C%B0%E5%9D%80/</link><pubDate>Thu, 19 Aug 2021 15:36:40 +0800</pubDate><guid>https://blog.thinkmoe.icu/posts/ubuntu-server-20.04-%E8%AE%BE%E7%BD%AEip%E5%9C%B0%E5%9D%80%E5%92%8C%E7%BD%91%E5%85%B3%E5%9C%B0%E5%9D%80/</guid><description>Ubuntuä»20.04ç‰ˆæœ¬å¼€å§‹ä½¿ç”¨netplanå¯¹ç½‘ç»œè¿›è¡Œç®¡ç†ï¼Œç™¾åº¦ä¸Šä½¿ç”¨çš„/etc/network/interfacesæ–‡ä»¶å·²ä¸å†é€‚ç”¨ï¼Œ</description><content type="html"><![CDATA[<p>Ubuntuä»20.04ç‰ˆæœ¬å¼€å§‹ä½¿ç”¨<code>netplan</code>å¯¹ç½‘ç»œè¿›è¡Œç®¡ç†ï¼Œç™¾åº¦ä¸Šä½¿ç”¨çš„<code>/etc/network/interfaces</code>æ–‡ä»¶å·²ä¸å†é€‚ç”¨ï¼Œéœ€è¦ä¿®æ”¹<code>netplan</code>é…ç½®æ–‡ä»¶è¿›è¡Œæ›´æ–°</p>
<h2 id="ä¿®æ”¹é…ç½®æ–‡ä»¶">ä¿®æ”¹é…ç½®æ–‡ä»¶</h2>
<p><code>netplan</code>çš„é…ç½®æ–‡ä»¶å­˜æ”¾åœ¨<code>/etc/netplan</code>ä¸­ï¼Œå…¶ä¸­æœ‰è¯¸å¦‚<code>00-installer-config.yaml</code>çš„é…ç½®æ–‡ä»¶ï¼Œæ‰“å¼€å¯ä»¥å‘ç°</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># This is the network config written by &#39;subiquity&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">network</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ethernets</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># ç½‘å¡åç§°ï¼Œæˆ‘è¿™æ˜¯è™šæ‹Ÿæœºens33</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ens33</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># æ˜¯å¦å¼€å¯dhcpæœåŠ¡ï¼Œè®¾ç½®ä¸ºtrueååç»­çš„ipå’Œç½‘å…³å¯ä»¥ä¸ç”¨è®¾ç½®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">dhcp4</span><span class="p">:</span><span class="w"> </span><span class="kc">no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># IPåœ°å€ï¼Œä¸€èˆ¬è®¾ç½®ä¸€ä¸ªå°±è¡Œ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># åé¢çš„24æ˜¯å­ç½‘æ©ç æ•°ç›®ï¼Œä»£è¡¨255.255.255.0(11111111.11111111.11111111.00000000)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">addresses</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">192.168.1.106</span><span class="l">/24]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">optional</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># ç½‘å…³åœ°å€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">gateway4</span><span class="p">:</span><span class="w"> </span><span class="m">192.168.1.253</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># dnsåœ°å€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">nameservers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">addresses</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">233.5.5.5</span><span class="p">,</span><span class="w"> </span><span class="m">192.168.1.253</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span></code></pre></div><p>å½“ç„¶ï¼Œè¿™åªæ˜¯æœ€ä¸ºåŸºç¡€çš„ç½‘ç»œé…ç½®ï¼Œå¯¹äºå¤šå¼ ç½‘å¡è¿˜å¯ä»¥è¿›è¡Œå…¶ä»–çš„é…ç½®ï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒ<a href="%22https://netplan.io/examples/%22">Netplanå®˜æ–¹æ–‡æ¡£</a></p>
<p>åœ¨ä¿®æ”¹å®Œæ–‡ä»¶ä¹‹åï¼Œç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤åº”ç”¨é…ç½®ï¼ŒPingå¤–ç½‘æµ‹è¯•è¿é€šæ€§</p>
<pre><code>sudo netplay apply
ping 8.8.8.8</code></pre>
]]></content></item><item><title>Websocketå…³é—­é”™è¯¯ä»£ç å«ä¹‰</title><link>https://blog.thinkmoe.icu/posts/websocket%E5%85%B3%E9%97%AD%E9%94%99%E8%AF%AF%E4%BB%A3%E7%A0%81%E5%90%AB%E4%B9%89/</link><pubDate>Sat, 07 Aug 2021 15:00:19 +0800</pubDate><guid>https://blog.thinkmoe.icu/posts/websocket%E5%85%B3%E9%97%AD%E9%94%99%E8%AF%AF%E4%BB%A3%E7%A0%81%E5%90%AB%E4%B9%89/</guid><description>å‰æƒ… åœ¨å¤„ç†Bç«™ç›´æ’­çš„Websocketæºæ—¶ï¼Œç»å¸¸å‘ç”Ÿè¿æ¥å…³é—­çš„é”™è¯¯ï¼Œæœ€å¸¸è§çš„å°±æ˜¯close 1006 (abnormal closure): unexpected EOFé”™è¯¯ï¼Œä½ è¯´httpçš„çŠ¶æ€ç è¿˜çŸ¥é“ï¼Œè¿™</description><content type="html"><![CDATA[<h2 id="å‰æƒ…">å‰æƒ…</h2>
<p>åœ¨å¤„ç†Bç«™ç›´æ’­çš„Websocketæºæ—¶ï¼Œç»å¸¸å‘ç”Ÿè¿æ¥å…³é—­çš„é”™è¯¯ï¼Œæœ€å¸¸è§çš„å°±æ˜¯<code>close 1006 (abnormal closure): unexpected EOF</code>é”™è¯¯ï¼Œä½ è¯´httpçš„çŠ¶æ€ç è¿˜çŸ¥é“ï¼Œè¿™websocetçš„çŠ¶æ€ç è¿˜çœŸä¸çŸ¥é“ï¼Œäºæ˜¯å»æŸ¥äº†æŸ¥è®°å½•ä¸€ä¸‹</p>
<h2 id="rfc-6455">RFC 6455</h2>
<p>æ ¹æ®<a href="https://tools.ietf.org/pdf/rfc6455.pdf">RFC 6455</a>å®šä¹‰çš„å†…å®¹ï¼ŒWebsocketåœ¨å¤„ç†å…³é—­æ—¶è®¾ç½®äº†ä¸€ç³»åˆ—çš„ä»£ç æç¤ºã€‚å½“å¯¹ä¸€ä¸ªå·²ç»å»ºç«‹çš„è¿æ¥è¿›è¡Œå…³é—­æ—¶ï¼Œåœ¨ç»ˆç«¯å¤„å¯èƒ½æä¾›ä¸€ä¸ªå…³é—­çš„è§£é‡Šè¯´æ˜ï¼Œå®¢æˆ·ç«¯å¯ä»¥æ ¹æ®è¿™ä¸ªä»£ç æ¥æ¨æµ‹ç»ˆç«¯å…³é—­è¿æ¥çš„åŸå› ä»è€Œæ›´æ–°å®¢æˆ·ç«¯è¿æ¥çš„ä»£ç ã€‚å½“ç„¶ï¼Œç»ˆç«¯åœ¨å…³é—­æ—¶ä¹Ÿå¯ä»¥å¿½è§†ä»£ç ç›´æ¥è¿›è¡Œå…³é—­</p>
<ul>
<li>1000 Normal Closure</li>
</ul>
<p>1000è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªæ­£å¸¸çš„å…³é—­ï¼Œè¡¨æ˜è¦ä¼ è¾“çš„æ•°æ®å·²ç»å…¨éƒ¨å®Œæˆå¯ä»¥é€€å‡º</p>
<ul>
<li>1001 Going Away</li>
</ul>
<p>1001è¯´æ˜ç»ˆç«¯å¯èƒ½å·²ç»æ‰¾ä¸åˆ°è¯¥è¿æ¥ï¼Œä¾‹å¦‚æœåŠ¡å¯èƒ½å®•æœºæˆ–æµè§ˆå™¨é‡å®šå‘è‡³å…¶ä»–é¡µé¢</p>
<ul>
<li>1002 Protocal error</li>
</ul>
<p>1002è¯´æ˜è¿æ¥è¢«ç»ˆç«¯ç”±äºæ¶ˆæ¯åè®®é”™è¯¯è€Œè¿›è¡Œå¼ºåˆ¶æ€§é€€å‡º</p>
<ul>
<li>1003 Unsupported Data</li>
</ul>
<p>1003è¯´æ˜ç»ˆç«¯æ¥å—åˆ°ä¸€ä¸ªæ— æ³•å¤„ç†çš„æ•°æ®è€Œè¿›è¡Œå¼ºåˆ¶æ€§é€€å‡º(ä¾‹å¦‚ï¼ŒæœåŠ¡å™¨å¯èƒ½åªèƒ½å¤Ÿå¤„ç†æ–‡æœ¬æ•°æ®ä½†æ¥å—åˆ°äº†äºŒè¿›åˆ¶æ•°æ®)</p>
<ul>
<li>1004 &mdash;Reserved&mdash;</li>
</ul>
<p>1004å­—æ®µä¿ç•™ï¼Œæœªæ¥å¯èƒ½ç”¨å¾—åˆ°</p>
<ul>
<li>1005 No Status Rcvd</li>
</ul>
<p>1005æ˜¯ä¸€ä¸ªä¿ç•™æ•°æ®ï¼Œç»å¯¹ä¸å…è®¸ç»ˆç«¯å°†å…¶è®¾ç½®ä¸ºå…³é—­æ—¶çš„çŠ¶æ€ç ã€‚It is designated for use in applications expecting a status code to indicate the no stats code was actually present.</p>
<ul>
<li>1006 Abnormal Closure</li>
</ul>
<p>1006æ˜¯ä¸€ä¸ªä¿ç•™æ•°æ®ï¼Œç»å¯¹ä¸å…è®¸ç»ˆç«¯å°†å…¶è®¾ç½®ä¸ºå…³é—­æ—¶çš„çŠ¶æ€ç ã€‚å®ƒæ˜¯ç”¨æ¥æŒ‡å®šéœ€è¦çŠ¶æ€ç æ ‡å¿—è¿æ¥å¼‚å¸¸å…³é—­çš„ç¨‹åºï¼Œä¾‹å¦‚æ²¡æœ‰å‘é€æˆ–æ¥å—æ§åˆ¶æ•°æ®</p>
<ul>
<li>1007 Invalid frame payload data</li>
</ul>
<p>1007è¯´æ˜ç»ˆç«¯æ”¶åˆ°äº†ä¸€ä¸ªä¸ç¬¦åˆè§„å®šçš„æ ¼å¼æ•°æ®è€Œå…³é—­è¿æ¥(ä¾‹å¦‚ï¼Œnon-UTF-8æ ¼å¼çš„æ•°æ®åŒ…æ‹¬äº†ä¸€æ®µtextæ¶ˆæ¯)</p>
<ul>
<li>1008 Policy Violation</li>
</ul>
<p>1008è¯´æ˜ç»ˆç«¯æ”¶åˆ°äº†ä¸€ä¸ªè¿åæœåŠ¡è§„åˆ™çš„æ¶ˆæ¯è€Œå…³é—­è¿æ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤šåŠŸèƒ½çŠ¶æ€ç ï¼Œå®ƒå¯ä»¥ç”¨äºæ²¡æœ‰å…¶ä»–åˆé€‚çš„çŠ¶æ€ç æ—¶å‘é€å‡ºå»ä¾‹å¦‚(1003æˆ–1009)æˆ–è€…åœ¨æœ‰å¿…è¦éšè—è‡ªå·±çš„è§„åˆ™ä¿¡æ¯æ—¶å‘é€å‡ºå»</p>
<ul>
<li>1009 Message Too Big</li>
</ul>
<p>1009è¯´æ˜ç»ˆç«¯æ”¶åˆ°äº†ä¸€ä¸ªè¿‡å¤§çš„æ•°æ®è€Œå…³é—­è¿æ¥</p>
<ul>
<li>
<p>1010 Mandatory Ext</p>
</li>
<li>
<p>1011 Internal Server Error</p>
</li>
</ul>
<p>1011è¯´æ˜æœåŠ¡ç«¯åœ¨å¤„ç†è¯·æ±‚æ—¶é‡åˆ°äº†ä¸€ä¸ªæ„å¤–æƒ…å†µ</p>
<ul>
<li>1015 TLS handshake</li>
</ul>
<p>1005æ˜¯ä¸€ä¸ªä¿ç•™æ•°æ®ï¼Œç»å¯¹ä¸å…è®¸ç»ˆç«¯å°†å…¶è®¾ç½®ä¸ºå…³é—­æ—¶çš„çŠ¶æ€ç ã€‚å®ƒç”¨äºå¤„ç†åœ¨TLSæ¡æ‰‹æ—¶å‘ç”Ÿçš„é”™è¯¯ã€‚</p>
<h2 id="é”™è¯¯å¤„ç†">é”™è¯¯å¤„ç†</h2>
<p>äº†è§£1006é”™è¯¯ä¹‹åçŒœæµ‹æ˜¯å®¢æˆ·ç«¯åœ¨é€€å‡ºæ—¶æ²¡æœ‰å‘é€é€€å‡ºä¿¡æ¯å¯¼è‡´å¼‚å¸¸å…³é—­ï¼Œå›¾çœäº‹ç›´æ¥å¤„ç†errå¿½ç•¥å®Œäº‹</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">_</span><span class="p">,</span> <span class="nx">body</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cli</span><span class="p">.</span><span class="nx">conn</span><span class="p">.</span><span class="nf">ReadMessage</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">websocket</span><span class="p">.</span><span class="nf">IsUnexpectedCloseError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">websocket</span><span class="p">.</span><span class="nx">CloseGoingAway</span><span class="p">,</span> <span class="nx">websocket</span><span class="p">.</span><span class="nx">CloseAbnormalClosure</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">DPrintf</span><span class="p">(</span><span class="s">&#34;Unexpected Close Error&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">closeConn</span> <span class="o">&lt;-</span> <span class="kd">struct</span><span class="p">{}{}</span>
</span></span><span class="line"><span class="cl">    <span class="k">continue</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div>]]></content></item><item><title>Leetcode æ¯æ—¥ä¸€é¢˜</title><link>https://blog.thinkmoe.icu/posts/leetcode-%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/</link><pubDate>Fri, 23 Jul 2021 11:50:27 +0800</pubDate><guid>https://blog.thinkmoe.icu/posts/leetcode-%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/</guid><description>2021/7/23 1893 Check if All the Integers in a Range Are Covered (EASY) You are given a 2D integer array ranges and two integers left and right. Each ranges[i] = [starti, endi] represents an inclusive interval between starti and endi. Return true if each integer in the inclusive range [left, right] is covered by at least one interval in ranges. Return false otherwise. An integer x is covered by an</description><content type="html"><![CDATA[<h2 id="2021723-1893-check-if-all-the-integers-in-a-range-are-covered-easy">2021/7/23 1893 Check if All the Integers in a Range Are Covered (EASY)</h2>
<p>You are given a 2D integer array <code>ranges</code> and two integers <code>left</code> and <code>right</code>. Each <code>ranges[i] = [starti, endi]</code> represents an inclusive interval between <code>starti</code> and <code>endi</code>.</p>
<p>Return <code>true</code> if each integer in the inclusive range <code>[left, right]</code> is covered by <strong>at least one</strong> interval in <code>ranges</code>. Return <code>false</code> otherwise.</p>
<p>An integer <code>x</code> is covered by an interval <code>ranges[i] = [starti, endi] if starti &lt;= x &lt;= endi.</code></p>
<h4 id="æš´åŠ›">æš´åŠ›</h4>
<p>ç®€å•é¢˜ç›´æ¥æš´åŠ›ç ´è§£å³å¯ï¼Œæ— éœ€å¤šè¨€</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">isCovered</span><span class="p">(</span><span class="nx">ranges</span> <span class="p">[][]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">right</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">boolMap</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">bool</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">num</span> <span class="o">:=</span> <span class="nx">left</span><span class="p">;</span> <span class="nx">num</span> <span class="o">&lt;=</span> <span class="nx">right</span><span class="p">;</span> <span class="nx">num</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">flag</span> <span class="p">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">r</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">ranges</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="nx">num</span> <span class="o">&gt;=</span> <span class="nx">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">num</span> <span class="o">&lt;=</span> <span class="nx">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">flag</span> <span class="p">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">boolMap</span><span class="p">[</span><span class="nx">num</span><span class="p">]</span> <span class="p">=</span> <span class="nx">flag</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">boolMap</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">!</span><span class="nx">v</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æ‰§è¡Œç”¨æ—¶ï¼š4 ms, åœ¨æ‰€æœ‰ Go æäº¤ä¸­å‡»è´¥äº†21.05%çš„ç”¨æˆ·</p>
<p>å†…å­˜æ¶ˆè€—ï¼š2.6 MB, åœ¨æ‰€æœ‰ Go æäº¤ä¸­å‡»è´¥äº†14.91%çš„ç”¨æˆ·</p>
<h4 id="å·®åˆ†æ•°ç»„">å·®åˆ†æ•°ç»„</h4>
<p>å¦ä¸€ç§ç®€å•çš„æ–¹æ³•å°±æ˜¯å·®åˆ†æ•°ç»„ï¼Œå…ˆç»Ÿè®¡æ¯ç»„Rangeçš„æ°›å›´ï¼Œç„¶åå†çœ‹æä¾›çš„æ•°å­—æ˜¯å¦å¤„äºèŒƒå›´ä¹‹å†…å³å¯</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">isCovered</span><span class="p">(</span><span class="nx">ranges</span> <span class="p">[][]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">right</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">diff</span> <span class="o">:=</span> <span class="p">[</span><span class="mi">52</span><span class="p">]</span><span class="kt">int</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 1. check ranges
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">ranges</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">diff</span><span class="p">[</span><span class="nx">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">        <span class="nx">diff</span><span class="p">[</span><span class="nx">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">--</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 2. check num in left right range
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">cnt</span> <span class="o">:=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">right</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">cnt</span> <span class="o">+=</span> <span class="nx">diff</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="nx">left</span> <span class="o">&amp;&amp;</span> <span class="nx">cnt</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Go æäº¤ä¸­å‡»è´¥äº†100%çš„ç”¨æˆ·</p>
<p>å†…å­˜æ¶ˆè€—ï¼š2.5 MB, åœ¨æ‰€æœ‰ Go æäº¤ä¸­å‡»è´¥äº†80.70%çš„ç”¨æˆ·</p>
<h2 id="2021726-1713-minimum-operations-to-make-a-subsequence-hard">2021/7/26 1713 Minimum Operations to Make a Subsequence (HARD)</h2>
<p>You are given an array target that consists of distinct integers and another integer array arr that can have duplicates.</p>
<p>In one operation, you can insert any integer at any position in arr. For example, if arr = [1,4,1,2], you can add 3 in the middle and make it [1,4,3,1,2]. Note that you can insert the integer at the very beginning or end of the array.</p>
<p>Return the minimum number of operations needed to make target a subsequence of arr.</p>
<p>A subsequence of an array is a new array generated from the original array by deleting some elements (possibly none) without changing the remaining elements&rsquo; relative order. For example, [2,7,4] is a subsequence of [4,2,3,7,2,1,4] (the underlined elements), while [2,4,2] is not.</p>
<h4 id="è´ªå¿ƒ">è´ªå¿ƒ</h4>
<p>é¢˜ç›®è¦æ±‚å¯»æ‰¾åˆ°ä¸¤ä¸ªæ•°ç»„ä¸­çš„æœ€å°‘æ’å…¥å…ƒç´ ä¸ªæ•°ä½¿targetæˆä¸ºarrçš„å­é›†ï¼Œå¯ä»¥è½¬æ¢æ€è·¯ï¼Œå¯»æ‰¾åˆ°ä¸¤ä¸ªæ•°ç»„çš„æœ€é•¿å…¬å…±å­é›†ï¼Œæœ€åè¦æ’å…¥çš„ä¸ªæ•°å°±æ˜¯targetæ•°ç»„çš„é•¿åº¦å‡å»æœ€é•¿å…¬å…±å­é›†é•¿åº¦</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">minOperations</span><span class="p">(</span><span class="nx">target</span> <span class="p">[]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">arr</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">n</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">pos</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">int</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">val</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">target</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">pos</span><span class="p">[</span><span class="nx">val</span><span class="p">]</span> <span class="p">=</span> <span class="nx">i</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">d</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">val</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">arr</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">idx</span><span class="p">,</span> <span class="nx">has</span> <span class="o">:=</span> <span class="nx">pos</span><span class="p">[</span><span class="nx">val</span><span class="p">];</span> <span class="nx">has</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="nx">p</span> <span class="o">:=</span> <span class="nx">sort</span><span class="p">.</span><span class="nf">SearchInts</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">idx</span><span class="p">);</span> <span class="nx">p</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">d</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="p">=</span> <span class="nx">idx</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">d</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">idx</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">n</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æ‰§è¡Œç”¨æ—¶ï¼š168 ms, åœ¨æ‰€æœ‰ Go æäº¤ä¸­å‡»è´¥äº†63.89%çš„ç”¨æˆ·</p>
<p>å†…å­˜æ¶ˆè€—ï¼š12.3 MB, åœ¨æ‰€æœ‰ Go æäº¤ä¸­å‡»è´¥äº†91.67%çš„ç”¨æˆ·</p>
<h2 id="2021726-671-second-minimum-node-in-a-binary-tree-easy">2021/7.26 671 Second Minimum Node In a Binary Tree (EASY)</h2>
<p>Given a non-empty special binary tree consisting of nodes with the non-negative value, where each node in this tree has exactly two or zero sub-node. If the node has two sub-nodes, then this node&rsquo;s value is the smaller value among its two sub-nodes. More formally, the propertyÂ root.val = min(root.left.val, root.right.val)Â always holds.</p>
<p>Given such a binary tree, you need to output the second minimum value in the set made of all the nodes&rsquo; value in the whole tree.</p>
<p>If no such second minimum value exists, output -1 instead.</p>
<h4 id="dfsæš´åŠ›">DFSæš´åŠ›</h4>
<p>ç”±é¢˜æ„å¯çŸ¥ï¼Œæ ¹èŠ‚ç‚¹çš„å€¼æ˜¯æœ€å°çš„ï¼Œè¦æ‰¾åˆ°æ•´æ£µæ ‘ä¸­çš„ç¬¬äºŒå°çš„å€¼åªéœ€è¦å¯¹æ‰€æœ‰èŠ‚ç‚¹è¿›è¡Œéå†ï¼Œå¯»æ‰¾åˆ°å¤§äºæ ¹èŠ‚ç‚¹çš„æœ€å¤§å€¼å³å¯</p>
<p>åˆå§‹åŒ–ä¸€ä¸ª<code>ans</code>ç­‰äº-1ï¼Œä»£è¡¨æœªæ‰¾åˆ°ç¬¬äºŒå°çš„å€¼ï¼Œå¯¹æ ‘è¿›è¡Œéå†ï¼Œå½“å€¼å¤§äºrootçš„å€¼å¹¶å¤§äºansæ—¶ï¼Œæ›´æ–°ansçš„å€¼ã€‚æœ€åè¿”å›ansçš„å€¼ï¼Œå°±æ˜¯ç¬¬äºŒå°çš„å€¼</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">findSecondMinimumValue</span><span class="p">(</span><span class="nx">root</span> <span class="o">*</span><span class="nx">TreeNode</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ans</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="nx">rootVal</span> <span class="o">:=</span> <span class="nx">root</span><span class="p">.</span><span class="nx">Val</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">dfs</span> <span class="kd">func</span><span class="p">(</span><span class="o">*</span><span class="nx">TreeNode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">dfs</span> <span class="p">=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">node</span> <span class="o">*</span><span class="nx">TreeNode</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nx">node</span> <span class="o">==</span> <span class="kc">nil</span> <span class="o">||</span> <span class="nx">ans</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">Val</span> <span class="o">&gt;=</span> <span class="nx">ans</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nx">node</span><span class="p">.</span><span class="nx">Val</span> <span class="p">&gt;</span> <span class="nx">rootVal</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">ans</span> <span class="p">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">Val</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nf">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">Left</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nf">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">Right</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nf">dfs</span><span class="p">(</span><span class="nx">root</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">ans</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="2021728-863">2021/7.28 863</h2>
<p>Given the root of a binary tree, the value of a target node target, and an integer k, return an array of the values of all nodes that have a distance k from the target node.</p>
<p>You can return the answer in any order.</p>
<h4 id="å“ˆç³»dfs">å“ˆç³»+DFS</h4>
<p>é¦–å…ˆå¯»æ‰¾åˆ°æ‰€æœ‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼Œç„¶åä»TargetèŠ‚ç‚¹å‡ºå‘ï¼Œå¯»æ‰¾è·ç¦»Kçš„èŠ‚ç‚¹å³å¯</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">distanceK</span><span class="p">(</span><span class="nx">root</span> <span class="o">*</span><span class="nx">TreeNode</span><span class="p">,</span> <span class="nx">target</span> <span class="o">*</span><span class="nx">TreeNode</span><span class="p">,</span> <span class="nx">k</span> <span class="kt">int</span><span class="p">)</span> <span class="p">[]</span><span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 1. get all father node
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kd">var</span> <span class="nx">fathers</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="o">*</span><span class="nx">TreeNode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">getFather</span> <span class="kd">func</span><span class="p">(</span><span class="nx">root</span> <span class="o">*</span><span class="nx">TreeNode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">getFather</span> <span class="p">=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">root</span> <span class="o">*</span><span class="nx">TreeNode</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">root</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">root</span><span class="p">.</span><span class="nx">Left</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">fathers</span><span class="p">[</span><span class="nx">root</span><span class="p">.</span><span class="nx">Left</span><span class="p">.</span><span class="nx">Val</span><span class="p">]</span> <span class="p">=</span> <span class="nx">root</span>
</span></span><span class="line"><span class="cl">			<span class="nf">getFather</span><span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">Left</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">root</span><span class="p">.</span><span class="nx">Right</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">fathers</span><span class="p">[</span><span class="nx">root</span><span class="p">.</span><span class="nx">Right</span><span class="p">.</span><span class="nx">Val</span><span class="p">]</span> <span class="p">=</span> <span class="nx">root</span>
</span></span><span class="line"><span class="cl">			<span class="nf">getFather</span><span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">Right</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nf">getFather</span><span class="p">(</span><span class="nx">root</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">res</span> <span class="p">=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// 2. find the target node
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kd">var</span> <span class="nx">getNode</span> <span class="kd">func</span><span class="p">(</span><span class="o">*</span><span class="nx">TreeNode</span><span class="p">,</span> <span class="o">*</span><span class="nx">TreeNode</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">getNode</span> <span class="p">=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">from</span> <span class="o">*</span><span class="nx">TreeNode</span><span class="p">,</span> <span class="nx">dis</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">node</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">dis</span> <span class="o">==</span> <span class="nx">k</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">res</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">Val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">node</span><span class="p">.</span><span class="nx">Left</span> <span class="o">!=</span> <span class="nx">from</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nf">getNode</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">Left</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">dis</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">node</span><span class="p">.</span><span class="nx">Right</span> <span class="o">!=</span> <span class="nx">from</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nf">getNode</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">Right</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">dis</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">fathers</span><span class="p">[</span><span class="nx">node</span><span class="p">.</span><span class="nx">Val</span><span class="p">]</span> <span class="o">!=</span> <span class="nx">from</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nf">getNode</span><span class="p">(</span><span class="nx">fathers</span><span class="p">[</span><span class="nx">node</span><span class="p">.</span><span class="nx">Val</span><span class="p">],</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">dis</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nf">getNode</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">res</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æ‰§è¡Œç”¨æ—¶ï¼š0 ms, åœ¨æ‰€æœ‰ Go æäº¤ä¸­å‡»è´¥äº†100%çš„ç”¨æˆ·</p>
<p>å†…å­˜æ¶ˆè€—ï¼š3.2 MB, åœ¨æ‰€æœ‰ Go æäº¤ä¸­å‡»è´¥äº†52.08%çš„ç”¨æˆ·</p>
<h2 id="2021730-171-excel-sheet-column-number-easy">2021/7.30 171 Excel Sheet Column Number (EASY)</h2>
<p>Given a string columnTitle that represents the column title as appear in an Excel sheet, return its corresponding column number.</p>
<pre><code>A -&gt; 1
B -&gt; 2
...
Z -&gt; 26
AA -&gt; 27
...
</code></pre>
<h4 id="éå†">éå†</h4>
<p>è¿›åˆ¶è½¬æ¢é¢˜ï¼Œéå¸¸ç®€å•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">titleToNumber</span><span class="p">(</span><span class="nx">columnTitle</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">num</span> <span class="kt">int</span> <span class="p">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">mul</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">columnTitle</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span><span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">k</span> <span class="o">:=</span> <span class="nx">columnTitle</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">-</span> <span class="sc">&#39;A&#39;</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="nx">num</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">*</span> <span class="nx">mul</span>
</span></span><span class="line"><span class="cl">        <span class="nx">mul</span> <span class="o">*=</span> <span class="mi">26</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">num</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="987-2021731-vertical-order-traversall-of-a-binary-tree">987 2021/7/31 Vertical Order Traversall of a Binary Tree</h2>
<p>Give the root of a binary tree, calculate the vertical order traversal of the binary tree.</p>
<p>For each node at position (row, col), its left and right children will be at positions (row + 1, col - 1) and (row + 1, col + 1) respectively. The rootof the tree is at (0, 0)</p>
<p>The vertical order traversal of a binary tree is a list of top-to-bottom orderings for each column index starting from the leftmost column and ending on the rightmost column. There may be multiple nodes in the same row and same column. In such a case, sort these nodes by their valeus.</p>
<p>Return the vertical order traversal of the binary tree.</p>
<h4 id="dfsæš´åŠ›sorthash">DFSæš´åŠ›+Sort+Hash</h4>
<p>Mapç›´æ¥å­˜åŒcolçš„èŠ‚ç‚¹ï¼Œç„¶åä»å°åˆ°å¤§éå†å¹¶æ’åºè¾“å‡ºå³å¯</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">verticalTraversal</span><span class="p">(</span><span class="nx">root</span> <span class="o">*</span><span class="nx">TreeNode</span><span class="p">)</span> <span class="p">(</span><span class="nx">res</span> <span class="p">[][]</span><span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 1. hash map, find the same coloumn nodes
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">var</span> <span class="nx">hashMap</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">][]</span><span class="kt">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">right</span> <span class="p">=</span> <span class="mi">999</span><span class="p">,</span> <span class="o">-</span><span class="mi">999</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">dfs</span> <span class="kd">func</span><span class="p">(</span><span class="nx">root</span> <span class="o">*</span><span class="nx">TreeNode</span><span class="p">,</span> <span class="nx">row</span><span class="p">,</span> <span class="nx">col</span> <span class="kt">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">dfs</span> <span class="p">=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">root</span> <span class="o">*</span><span class="nx">TreeNode</span><span class="p">,</span> <span class="nx">row</span><span class="p">,</span> <span class="nx">col</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nx">root</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nx">col</span> <span class="p">&lt;</span> <span class="nx">left</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">left</span> <span class="p">=</span> <span class="nx">col</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nx">col</span> <span class="p">&gt;</span> <span class="nx">right</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">right</span> <span class="p">=</span> <span class="nx">col</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">hashMap</span><span class="p">[</span><span class="nx">col</span><span class="p">];</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">hashMap</span><span class="p">[</span><span class="nx">col</span><span class="p">]</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">hashMap</span><span class="p">[</span><span class="nx">col</span><span class="p">],</span> <span class="nx">root</span><span class="p">.</span><span class="nx">Val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">hashMap</span><span class="p">[</span><span class="nx">col</span><span class="p">]</span> <span class="p">=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nx">hashMap</span><span class="p">[</span><span class="nx">col</span><span class="p">]</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">hashMap</span><span class="p">[</span><span class="nx">col</span><span class="p">],</span> <span class="nx">root</span><span class="p">.</span><span class="nx">Val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nf">dfs</span><span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">Left</span><span class="p">,</span> <span class="nx">row</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">col</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nf">dfs</span><span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">Right</span><span class="p">,</span> <span class="nx">row</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">col</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nf">dfs</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="nx">left</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">right</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nx">arr</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">hashMap</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">sort</span><span class="p">.</span><span class="nf">Ints</span><span class="p">(</span><span class="nx">arr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nx">res</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">arr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Leetcode-cnæµ‹è¯•é›†æœ‰é—®é¢˜</p>
<pre><code>Input:
[3, 1, 4, 0, 2, 2]
Output:
[[0], [1], [2, 2, 3], [4]]
Expect:
[[0], [1], [3, 2, 2], [4]] # é¢˜æ„ä»å°åˆ°å¤§ï¼Œä½†é¢„æœŸä¸ºä»å¤§åˆ°å°
</code></pre>
<h2 id="516-longest-palindromic-subsequence-medium">516 Longest Palindromic Subsequence [Medium]</h2>
<p>Given a string <code>s</code>, find the longest palindromic subsequence&rsquo;s length in s.</p>
<p>A subsequence is a sequence that can be derived from another sequence by deleting some or no elements without changing the order of the remaining elements.</p>
<h4 id="heading"></h4>
]]></content></item><item><title>Windows11æ˜¯å¦‚ä½•è¿è¡Œå®‰å“åº”ç”¨çš„</title><link>https://blog.thinkmoe.icu/posts/windows11%E6%98%AF%E5%A6%82%E4%BD%95%E8%BF%90%E8%A1%8C%E5%AE%89%E5%8D%93%E5%BA%94%E7%94%A8%E7%9A%84/</link><pubDate>Thu, 01 Jul 2021 15:25:32 +0800</pubDate><guid>https://blog.thinkmoe.icu/posts/windows11%E6%98%AF%E5%A6%82%E4%BD%95%E8%BF%90%E8%A1%8C%E5%AE%89%E5%8D%93%E5%BA%94%E7%94%A8%E7%9A%84/</guid><description>æœ¬æ–‡ç¿»è¯‘è‡ªarstechnica å¾®è½¯åœ¨å‘å¸ƒWindows11æ—¶å…¬å¸ƒäº†ä¸€ä¸ªä»¤äººæƒŠå–œçš„ä¸œè¥¿ï¼ŒWindows11å°†æ”¯æŒWinåº”ç”¨å’Œå®‰å“åº”ç”¨åŒæ—¶è¿è¡Œ</description><content type="html"><![CDATA[<blockquote>
<p>æœ¬æ–‡ç¿»è¯‘è‡ª<a href="https://arstechnica.com/gadgets/2021/06/microsofts-windows-subsystem-for-android-sounds-a-lot-like-chrome-os/">arstechnica</a></p>
</blockquote>
<p>å¾®è½¯åœ¨å‘å¸ƒWindows11æ—¶å…¬å¸ƒäº†ä¸€ä¸ªä»¤äººæƒŠå–œçš„ä¸œè¥¿ï¼ŒWindows11å°†æ”¯æŒWinåº”ç”¨å’Œå®‰å“åº”ç”¨åŒæ—¶è¿è¡Œã€‚ä½†æ˜¯ï¼Œå¹¶æ²¡æœ‰åœ¨å…³é”®çš„åœ°æ–¹ç•™ä¸‹å¤ªå¤šçš„ä¿¡æ¯ã€‚è¿™äº›åº”ç”¨æ˜¯å¦æ˜¯é€šè¿‡æ¨¡æ‹Ÿå™¨è¿è¡Œçš„å‘¢ï¼Ÿç°å­˜ä¸Windowsçš„Linuxå­ç³»ç»Ÿå°†ä¼šè¢«æ”¾å¼ƒå—ï¼Ÿæˆ‘ä»¬å°†åœ¨è¿™ç¯‡æ–‡ç« å¾—åˆ°ç­”æ¡ˆï¼ŒåŒæ—¶æ„Ÿè°¢ä»¥ä¸‹<a href="https://www.youtube.com/watch?v=egZ82QGshX8">å¼€å‘è€…</a>æ¢è®¨è¿™äº›ç»†èŠ‚ã€‚</p>
<p>å¾®è½¯å®˜æ–¹å°†è¿™ä¸ªåŠŸèƒ½ç§°ä¹‹ä¸ºâ€œä¸ºå®‰å“è€Œç”Ÿçš„Windowså­ç³»ç»Ÿâ€ï¼Œè¿™ä¹Ÿå‘ä½ è¯´æ˜äº†è®¸å¤šå…³äºå®ƒå¦‚ä½•å·¥ä½œçš„ä¿¡æ¯ã€‚Windowsç›®å‰æ‹¥æœ‰ä¸€ä¸ªLinuxå­ç³»ç»Ÿï¼ˆWSLï¼‰ï¼Œå®ƒä½¿ç”¨Windowsä¸‹çš„Hyper-Vè™šæ‹Ÿæœºçš„åŠŸèƒ½è®©Windowsèƒ½åœ¨ä¸€ä¸ªç‹¬ç«‹çš„ç¯å¢ƒä¸‹ä½¿ç”¨ä¸€ä¸ªçœŸæ­£æ„ä¹‰ä¸Šçš„Linuxç³»ç»Ÿæ¥è¿è¡ŒLinuxåº”ç”¨ã€‚ï¼ˆHyper-Vè®©æ¬¡ç³»ç»Ÿèƒ½å¤Ÿè®¿é—®å®¿ä¸»æœºçš„ç¡¬ä»¶è€Œä¸æ˜¯é€šè¿‡åœ¨åŸç”Ÿèµ„æºä¸Šå¥—ç”¨ä¸€ä¸ªé¡¶å±‚çš„ç®¡ç†æ“ä½œç³»ç»Ÿä»è€Œåªèƒ½ä½¿ç”¨å°‘æ•°å®¿ä¸»æœºèµ„æºï¼‰ã€‚ä¸€ä¸ªç°å®ä¸­çš„å®‰å“æ‰‹æœºè¿è¡Œçš„æ˜¯Linuxå†…æ ¸ï¼Œè€Œå¾®è½¯æ­£åœ¨ä¸ºWindowsçš„å®‰å“å­ç³»ç»Ÿå»ºç«‹ä¸€ä¸ªåŸºäºWSLçš„å®‰å“æ¡†æ¶ã€‚è¿™çœ‹ä¸Šå»éå¸¸ç±»ä¼¼äºåœ¨Hyper-Vè™šæ‹Ÿæœºä¸­è¿è¡Œx86æ¶æ„çš„å®‰å“ç³»ç»Ÿã€‚</p>
<p>åœ¨Windowsä¸‹è¿è¡Œå®‰å“åº”ç”¨å°±å¦‚åŒåœ¨åŸç”Ÿæœºå™¨ä¸Šè¿è¡ŒWindwosåŸç”Ÿåº”ç”¨ä¸€æ ·ï¼Œé¡¶å±‚æœ‰çª—å£æ ï¼Œä»»åŠ¡å›¾æ ‡ï¼Œå¹¶ä¸”å¯ä»¥â€œé’‰â€åœ¨å¼€å§‹èœå•ä¸­ã€‚åœ¨å‘å¸ƒä¼šä¸­ï¼Œå¾®è½¯è¯´ï¼šâ€œåœ¨å±å¹•èƒŒåï¼Œæˆ‘ä»¬è¿˜åˆ›å»ºæ ä¸€ä¸ªä»£ç†åº”ç”¨ç”¨äºå¤„ç†å®‰å“è¿è¡Œå’ŒWindowså¼•ç”¨ä¹‹é—´çš„äº¤äº’â€ã€‚è¿™å¤§æ¦‚å¯ä»¥æ¨æµ‹ï¼Œç³»ç»Ÿå°†ä¼šæä¾›ç±»ä¼¼äºå¯åŠ¨å¿«æ·é”®ã€å›¾æ ‡å’Œå¸è½½å…¥å£ï¼Œå¹¶ä¸”å…¶çª—å£åŒ–çš„æ¨¡å¼è®©åº”ç”¨çœ‹èµ·æ¥åƒåŸç”Ÿåº”ç”¨ä¸€æ ·ã€‚</p>
<p>å¾®è½¯æ­£åœ¨å°è¯•é€šè¿‡ç±»ä¼¼äºå°å‹æ¨¡æ‹Ÿå™¨æˆ–ä¸åŸºäºæ¨¡æ‹Ÿå™¨çš„å½¢å¼æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œè€Œè¿™ä¸€åˆ‡å–å†³äºä½ çš„ç”µè„‘å’Œåº”ç”¨å…¼å®¹æ€§ã€‚Windowsç³»ç»Ÿå’Œå®‰å“ç³»ç»Ÿéƒ½èƒ½åœ¨x86æ¶æ„å’Œarmæ¶æ„ä¸‹è¿è¡Œï¼Œä½†å®‰å“æ›´å€¾å‘äºArmè€ŒWindowså€¾å‘äºx86.å¦‚æœä½ æ­£åœ¨ä½¿ç”¨Armæ¶æ„çš„Windowså¹¶æƒ³åœ¨Windowsä¸Šè¿è¡Œå®‰å“åº”ç”¨ï¼Œä¸€åˆ‡éƒ½å¯èƒ½éå¸¸é¡ºåˆ©ã€‚ä½†å¦‚æœä½ ä½¿ç”¨çš„æ˜¯x86çš„Windowsï¼Œå¾®è½¯åœ¨åƒæ–¹æ³•è®©ä½ èƒ½å¤Ÿä½¿ç”¨åˆ°x86ç±»å‹çš„å®‰å“åº”ç”¨ã€‚Armçš„åº”ç”¨åªéœ€è¦æ”¯æŒä¸€ä»¶ä¸œè¥¿ï¼Œé‚£å°±æ˜¯&quot;Intel Bridge Technology&quot;ï¼Œè¯¥æŠ€æœ¯çš„ç›®çš„å°±æ˜¯èƒ½è®©armæ¶æ„çš„ä»£ç è½¬åŒ–ä¸ºx86æ¶æ„èƒ½å¤Ÿè¿è¡Œçš„ä»£ç ã€‚å¾®è½¯æ­£åœ¨å¯»æ±‚åœ¨AMDå¤„ç†å™¨ä¸Šèƒ½å¤Ÿå®ç°ç›¸åŒåŠŸèƒ½çš„æ–¹æ³•ã€‚</p>
<p>å¾®è½¯çš„æ–¹æ³•ç±»ä¼¼äºå…¶ä»–ä¸€äº›æ“ä½œç³»ç»Ÿå¦‚ä½•å¯åŠ¨å’Œè¿è¡ŒAndroidåº”ç”¨ç¨‹åºã€‚ChromeOSçš„å®‰å“æ”¯æŒå¯èƒ½æ˜¯æœ€é€‚åˆçš„ä¾‹å­äº†ã€‚ChromeOSè¿è¡Œåœ¨Linuxå†…æ ¸ä¹‹ä¸­ï¼Œå¹¶ä¸”å®ƒå­˜å‚¨äº†ä¸€ä¸ªå®¹å™¨åŒ–çš„å®‰å“æ¡†æ¶æ¥è¿è¡Œåº”ç”¨ã€‚å¦‚æœä½ æœ‰ä¸€ä¸ªx86æ¶æ„çš„ChromeBookï¼ŒChromeOSä¼šä½¿ç”¨å®‰å“çš„Arm-to-x86ç¼–è¯‘ç‰ˆæœ¬ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯Linuxæ¡Œé¢ç³»ç»Ÿï¼Œæœ‰ä¸€ä¸ªåä¸ºAnboxçš„åº”ç”¨å°†ä¼šå¸®ä½ å®Œæˆä¸Šè¿°ä¸€æ ·çš„äº‹æƒ…ï¼Œåœ¨Linuxç³»ç»Ÿä¹‹ä¸ŠåŠ è½½ä¸€ä¸ªå®‰å“æ¡†æ¶ã€‚ä½ ç”šè‡³èƒ½åœ¨WSLä¸­è¿è¡ŒAnboxã€‚</p>
<p>è®¸å¤šäººä¸Šä¸€æ¬¡ä½“éªŒx86çš„å®‰å“è¿˜æ˜¯åœ¨2012å¹´æ—¶ï¼Œintelæ¨è¡Œçš„Atom-poweredçš„x86æ¶æ„æ‰‹æœºã€‚X86å·²ç»èµ°äº†ä¸€æ®µå¾ˆä¹…çš„å†å²äº†ï¼Œç›´åˆ°2016å¹´å®‰å“ChromeOSå¼€å§‹ï¼Œæ‰è®©å…¶ç¼“äº†ä¸€å£æ°”ã€‚ç”šè‡³åœ¨2016å¹´å¯åŠ¨ä¹‹å‰ï¼Œè°·æ­Œè¿˜åœ¨å‡å°‘æ¨é€x86æ¶æ„çš„appæ”¯æŒï¼Œå¹¶ä¸”è°·æ­Œå¼€å‘è€…å·¥å…·ä¹Ÿå°†armå’Œx86åˆ†ç¦»ã€‚å›åˆ°2016å¹´ï¼Œè°·æ­Œå¸Œæœ›25%çš„å•†åŸåº”ç”¨ä¸å†éœ€è¦å»æ”¯æŒx86æ¶æ„è€Œæ˜¯è½¬å‘armåº”ç”¨ã€‚ç°å¦‚ä»Šï¼Œä¼—å¤šçš„x86ç”¨æˆ·éœ€è¦æ„Ÿè°¢chromeosæ¥è®©å…¶èƒ½å¤Ÿè¿è¡Œå®‰å“åº”ç”¨ã€‚</p>
<h3 id="äºšé©¬é€ŠåŒºåˆ«äºè°·æ­Œå•†åº—çš„å¸‚åœºç³»ç»Ÿ">äºšé©¬é€Šï¼ŒåŒºåˆ«äºè°·æ­Œå•†åº—çš„å¸‚åœºç³»ç»Ÿ</h3>
<p>å¾®è½¯å¹¶ä¸ä¼šåœ¨Windowsä¸Šä½¿ç”¨è°·æ­Œå¸‚åœºï¼ŒåŒæ—¶ï¼Œå¾®è½¯ä¹Ÿå¹¶ä¸ä¼šå°è¯•è‡ªå·±æ¥å»ºç«‹ç»æµå¸‚åœºè€Œæ˜¯é€šè¿‡åˆä½œä¼™ä¼´äºšé©¬é€Šï¼Œç”¨åœ¨FireOsè®¾å¤‡ä¸Šçš„äºšé©¬é€Šå¸‚åœºæ¥è¿›è¡Œå®‰å“åº”ç”¨ä¸‹è½½ã€‚äºšé©¬é€Šå·²ç»æ¨å‡ºæ¥ä¸€ä¸ªé¢„è§ˆç‰ˆæœ¬ï¼Œä½†å¹¶æ²¡æœ‰æä¾›ä¸€ä¸ªå‡†ç¡®çš„ç¨³å®šæ€§ç‰ˆæœ¬å¼€æ”¾æ—¥æœŸã€‚</p>
<p>æˆ‘ä»¬å¹¶æ²¡æœ‰çœ‹åˆ°ä¸€ä¸ªå®‰å“åº”ç”¨æ˜¯å¦‚ä½•åœ¨Windowsä¸Šå¯åŠ¨å’Œå…³é—­çš„ï¼Œæ‰€ä»¥å¹¶ä¸æ¸…æ¥šå®ƒä»¬æ˜¯å¦‚ä½•åœ¨Windowsä¸Šå·¥ä½œåœ°ã€‚å¾®è½¯æ”¾å‡ºäº†å¾ˆå¤šæˆªå›¾ï¼Œå±•ç¤ºæ¥å¾®è½¯å•†åº—åœ¨æ¨é€äºšé©¬é€ŠAppå•†åº—çš„å®‰å“åº”ç”¨ã€‚ä»è¿™äº›æ”¾å‡ºçš„æ¶ˆæ¯æ¥çœ‹ï¼Œäºšé©¬é€ŠAppå·²ç»å†…ç½®äºWindowsä¹‹ä¸­ï¼Œä½†å¹¶æ²¡æœ‰çœ‹åˆ°å¾®è½¯å•†åº—èƒ½å¤Ÿç›´æ¥å®‰è£…å®‰è£…åº”ç”¨ã€‚å…³é”®ç‚¹å°±æ˜¯å®‰è£…æŒ‰é’®ï¼Œå¯¹äºWindowsåº”ç”¨ï¼Œå®‰è£…æŒ‰é’®æ˜¾ç¤ºçš„æ˜¯&quot;Get&quot;æ¥è¡¨æ˜å®‰è£…ä¸€ä¸ªåº”ç”¨ã€‚å¯¹äºå®‰å“åº”ç”¨æ¥è¯´ï¼Œåˆ™æ˜¾ç¤ºçš„æ˜¯&quot;ä»äºšé©¬é€Šå•†åº—ä¸­è·å¾—&quot;ï¼Œå¹¶ä¸”ä½¿ç”¨æ¥ä¸€ä¸ªå°ç›’å­å’Œç®­å¤´å›¾æ ‡æ¥è¡¨ç¤ºï¼Œè¿™ä»£è¡¨ä½ å°†ä¼šé€šè¿‡å¦ä¸€ä¸ªé¢å¤–çš„åº”ç”¨æ¥è·å–è¯¥å®‰å“åº”ç”¨ã€‚</p>
<p>åå°”è¡—æä¾›äº†ä¸€ä¸ªé¢å¤–çš„ç»†èŠ‚æ¥å±•ç¤ºå…¶æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚è¿™å¬èµ·æ¥å°±åƒæ˜¯äºšé©¬é€Šåœ¨ç»™Windowsæä¾›äº†ä¸€ä¸ªäºšé©¬é€Šå•†åŸå®¢æˆ·ç«¯ã€‚ä½ åªéœ€è¦ç™»å½•ä½ çš„äºšé©¬é€Šå¸å·ï¼Œå°±å¯ä»¥ä¸‹è½½åº”ç”¨äº†ã€‚å¾®è½¯ä¸Šé¢åªæä¾›äº†æœç´¢çš„åŠŸèƒ½ã€‚ç¡®åˆ‡æ¥è¯´ï¼Œè¿™è¡¨æ˜ä½ å°†ä¼šåœ¨Windowsä¸ŠåŒæ—¶è¿è¡Œä¸¤ä¸ªåº”ç”¨å•†åº—ï¼Œä½¿ç”¨ä¸¤ä»½ç©ºé—´æ¥æ£€æŸ¥æ›´æ–°ã€‚è¿™çœ‹ä¸Šå»å¹¶ä¸ç¨³å®šã€‚</p>
<p>å¾®è½¯å·¥ç¨‹å¸ˆ<a href="https://twitter.com/migueldeicaza/status/1408222245265330178">Miguel de Icaza</a>ç¡®è®¤ï¼ŒWindows11å°†ä¼šé€šè¿‡sideloadingæŠ€æœ¯æ¥æ”¯æŒé‚£äº›æˆ‘ä»¬ä¸éœ€è¦çš„äºšé©¬é€ŠåŠŸèƒ½ã€‚æ‚¨åº”è¯¥ç«‹å³ä¸ºF-Droidç­‰å¼€æºå•†åº—æä¾›é€‰é¡¹ï¼Œä»¥åŠåœ¨APKMIRRORåº”ç”¨ä¸ŠåŠ è½½çš„èƒ½åŠ›ã€‚ åœ¨æœ‰äººè·å¾—æ•´ä¸ªGoogle Playå•†åº—å·¥ä½œä¹‹å‰ï¼Œè¿™å¯èƒ½åªæ˜¯æ—¶é—´é—®é¢˜ã€‚</p>
<p>ç”±äºå¤šå¹´çš„é»˜è®¤å’Œæ¨åŠ¨åŠ ä¸Šé¢å¤–çš„æ¶æ„æ”¯æŒï¼ŒX86åº”ç”¨ç¨‹åºæ™®éå­˜åœ¨äºGoogleå•†åº—ä¸­ã€‚ä½†æ˜¯äºšé©¬é€ŠAppå•†åº—X86æ™®éå­˜åœ¨å—ï¼Ÿä½ å¯ä»¥åœ¨ä»»ä½•å®‰å“è®¾å¤‡ä¸Šä¾§è½½äºšé©¬é€Šåº”ç”¨å•†åº—ï¼Œä½†ä¸“é—¨ä½¿ç”¨Amazonçš„Echo Fileè®¾å¤‡çš„éƒ½æ˜¯ARMã€‚è®¸å¤šåº”ç”¨ç¨‹åºéƒ½å·²ç»å¼€å‘å®Œæˆå¹¶åœ¨æ‰€æœ‰æ¶æ„ä¸Šè¿è¡Œï¼Œæ‰€ä»¥&hellip;&hellip;ä¹Ÿè®¸ã€‚</p>
<p>å¦‚æœå¾®è½¯æ’¤å›äº†Surface Duoå¹¶ä¸Googleä¸€èµ·ä½¿ç”¨çš„Windows 11ä¸­çš„å®é™…Playå•†åº—ä¼šå¾ˆå¥½ã€‚åœ¨Playå•†åº—å¤–ä½¿ç”¨Androidçš„é—®é¢˜æ˜¯æ‚¨ä¸¢å¤±å¯¹Google PlayæœåŠ¡APIçš„è®¿é—®å’Œæ¨é€é€šçŸ¥ã€‚äºšé©¬é€Šä¸€ç›´åœ¨ä¸ºFireæ“ä½œç³»ç»Ÿæ„å»ºè‡ªå·±çš„æ›¿ä»£APIå’Œäº‘æœåŠ¡ï¼Œå¦‚æœä½ ä¸èƒ½æ‹¥æœ‰Google Playï¼Œè¿™æ˜¯ä¸‹ä¸€ä¸ªæœ€å¥½çš„äº‹æƒ…ã€‚</p>
<p>è¿™å°±æ˜¯æˆ‘ä»¬ç°åœ¨åœ¨Windows 11 Androidå…¼å®¹æ€§ä¸Šæ‰€æ‹¥æœ‰çš„ä¸€åˆ‡ã€‚ä½†æ”¾å¿ƒï¼Œæˆ‘ä»¬ä¼šåœ¨ä¸€äº›å®é™…ä»£ç å‡ºæ¥æ—¶æ›´æ·±å…¥çš„æ¢ç©¶ã€‚</p>
]]></content></item><item><title>Reacté’©å­å¯¹æ¯”Reduxï¼Œè°èƒ½åœ¨çŠ¶æ€ç®¡ç†æ›´èƒœä¸€ç­¹?</title><link>https://blog.thinkmoe.icu/posts/react%E9%92%A9%E5%AD%90%E5%AF%B9%E6%AF%94redux%E8%B0%81%E8%83%BD%E5%9C%A8%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E6%9B%B4%E8%83%9C%E4%B8%80%E7%AD%B9/</link><pubDate>Mon, 21 Jun 2021 14:47:25 +0800</pubDate><guid>https://blog.thinkmoe.icu/posts/react%E9%92%A9%E5%AD%90%E5%AF%B9%E6%AF%94redux%E8%B0%81%E8%83%BD%E5%9C%A8%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E6%9B%B4%E8%83%9C%E4%B8%80%E7%AD%B9/</guid><description>æœ¬æ–‡ç¿»è¯‘è‡ªNicola Grujicic ReactçŠ¶æ€ç®¡ç†ï¼šHookå’ŒReduxï¼Œä¸¤è€…æœ‰ä½•ä¸åŒï¼Ÿ ä¸–ç•Œä¸Šå¾ˆå¤šåŒ…æ‹¬æˆ‘åœ¨å†…çš„å¼€å‘è€…éƒ½æœ‰ä¸€ä¸ªç–‘æƒ‘ï¼Œåœ¨å¬åˆ°äººä»¬ä½¿ç”¨Ho</description><content type="html"><![CDATA[<blockquote>
<p>æœ¬æ–‡ç¿»è¯‘è‡ª<a href="https://www.framelessgrid.com/react-hooks-vs-redux-for-state-management-in-2021/">Nicola Grujicic</a></p>
</blockquote>
<h2 id="reactçŠ¶æ€ç®¡ç†hookå’Œreduxä¸¤è€…æœ‰ä½•ä¸åŒ">ReactçŠ¶æ€ç®¡ç†ï¼šHookå’ŒReduxï¼Œä¸¤è€…æœ‰ä½•ä¸åŒï¼Ÿ</h2>
<p>ä¸–ç•Œä¸Šå¾ˆå¤šåŒ…æ‹¬æˆ‘åœ¨å†…çš„å¼€å‘è€…éƒ½æœ‰ä¸€ä¸ªç–‘æƒ‘ï¼Œåœ¨å¬åˆ°äººä»¬ä½¿ç”¨Hookä»£æ›¿Reduxæ—¶ï¼Œä¸ºä»€ä¹ˆè¦å°†ä¸€ä¸ªå¤šçº§åˆ«å·¥ä½œéå¸¸å®Œç¾çš„ç»„ä»¶ç”¨ä¸€ä¸ªæ–°çš„è¿˜æœªå®Œæˆçš„ä¸œè¥¿æ›¿ä»£</p>
<blockquote>
<p>è®¸å¤šäººåœ¨ç–‘æƒ‘useContextå’ŒuseReduceræ˜¯å¦èƒ½ä»£æ›¿Redux</p>
</blockquote>
<p>ä»Šå¤©ï¼Œæˆ‘å°†ä¼šå°è¯•å»å›ç­”è¿™ä¸ªé—®é¢˜ã€‚æˆ‘å°†ä¼šè§£é‡ŠReactçš„é’©å­(useContext,useReducer)å’ŒReduxçš„ä¸åŒä¹‹å¤„ä»¥åŠä½¿ç”¨åœºæ™¯</p>
<blockquote>
<p>ä¸¤è€…æœ€å¤§çš„æŸ¥è¡¨åœ¨äºå¦‚ä½•ç®¡ç†åº”ç”¨çš„å…¨å±€çŠ¶æ€</p>
</blockquote>
<p>Reduxæ˜¯å½“å¼€å‘è€…éœ€è¦åˆ›å»ºä¸€ä¸ªå¤§å‹çš„å¤æ‚çš„åº”ç”¨æ—¶ç®¡ç†å…¨å±€çŠ¶æ€çš„æœ€ä½³å®è·µï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç›¸å½“äºå­˜å‚¨ä¸­å¿ƒçš„ç»„ä»¶ç”¨äºä¿ç®¡éœ€è¦åœ¨æ•´ä¸ªåº”ç”¨ä¸­ä½¿ç”¨çš„çŠ¶æ€ä¿¡æ¯ã€‚å¹¶é€šè¿‡ä¸€ç³»åˆ—è§„åˆ™ä¿è¯çŠ¶æ€åªæœ‰åœ¨æŒ‡å‘æ€§çš„æ•°æ®æµä¸­è¢«æ›´æ–°</p>
<p><img src="https://images.ctfassets.net/yytn7c23rcp1/5IgvC7d2l2CXbkxHm2Syol/b1494f62db8cdc974f85086a8c12a9a1/redux_diagram.png" alt="Redux"></p>
<p>Reacké’©å­åˆ™æ˜¯ç”¨å¦ä¸€ç§å…¨æ–°çš„æ–¹å¼åœ¨ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸä¸­æ¥ç®¡ç†çŠ¶æ€ä¿¡æ¯å¹¶ä¸”å¹¶ä¸ä¾èµ–äºç»„ä»¶ã€‚å®ƒåœ¨16.8ç‰ˆæœ¬ä¸­é¦–æ¬¡æå‡ºï¼Œæ—¨åœ¨é€šè¿‡ç»„ä»¶åˆ†äº«é€»è¾‘æ¥é™ä½ç»„ä»¶ä¹‹é—´çš„å¤æ‚æ€§</p>
<p>ä¸¤è€…æœ€å¤§çš„ä¸åŒå°±æ˜¯ï¼ŒReduxåˆ›å»ºäº†ä¸€ä¸ªåŒ…è£¹åœ¨æ•´ä¸ªåº”ç”¨ä¹‹å¤–çš„å…¨å±€çŠ¶æ€å®¹å™¨ï¼Œè¿™ä¸ªå®¹å™¨è¢«ç§°ä¹‹ä¸º<code>store</code>å¹¶ä¸”é€šè¿‡<code>useReducer</code>åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ç»„ä»¶ç”¨äºå’Œåº”ç”¨ç»„ä»¶è¿›è¡Œåˆä½œ</p>
<p>å¦å¤–ä¸€ç‚¹æ˜¯ï¼ŒReacté’©å­ä½¿ç”¨useContextå’ŒuseReducerè”åˆå»å’Œç»„ä»¶çŠ¶æ€ç®¡ç†è¿›è¡Œåˆä½œï¼Œè¿™å·²ç»æ˜¯å¦ä¸€ä¸ªå±‚é¢çš„åˆä½œå…³ç³»ã€‚å®ƒè®©é€šè¿‡useReduceråˆ›å»ºçš„çŠ¶æ€å®¹å™¨å’Œå®ƒçš„<code>dispatch</code>å‡½æ•°èƒ½å¤Ÿä¼ é€’ç»™ä»æœ€é¡¶ç«¯ç»„ä»¶ä»¥ä¸‹çš„ä»»æ„ä¸€ä¸ªç»„ä»¶ä¹‹ä¸­ã€‚ä½ å¯ä»¥åœ¨æœ€é¡¶ç«¯ç»„ä»¶ä¸­å®šä¹‰å®ƒä»¬ä½¿å…¶å˜ä¸ºå…¨å±€çŠ¶æ€</p>
<p>å¦‚æœæˆ‘ä»¬å°†æˆ‘ä»¬åˆ›å»ºçš„æ‰€æœ‰stateæ”¾ç½®åœ¨æœ€å¤–å±‚çš„ç»„ä»¶ï¼Œè¿™ä½“éªŒæ„Ÿè§‰å°±å’Œä½¿ç”¨Reduxæ²¡æœ‰ä»€ä¹ˆåŒºåˆ«</p>
<blockquote>
<p>æ‰€ä»¥æ˜¯Context(ä¸Šä¸‹æ–‡)å¯èƒ½ä»£æ›¿Redux(ä½†ä¹Ÿä¸ä¸€å®š)</p>
</blockquote>
<p>å¯¹äºReduxï¼Œä½¿ç”¨é’©å­çš„å¥½å¤„æœ‰</p>
<p>å¹¶ä¸éœ€è¦æŒç»­å…³æ³¨Reduxç¬¬ä¸‰æ–¹ä¾èµ–çš„æ›´æ–°ï¼Œé¿å…æ›´æ–°æ‰€å¯¼è‡´çš„Bugå’Œé—®é¢˜ï¼Œå¯ä»¥è®©ä½ çš„åº”ç”¨å¤§å°å˜å¾—æ›´å°ä¹Ÿå› æ­¤ä¼šæœ‰æ›´å¿«çš„é€Ÿåº¦æ¥å¤„ç†çŠ¶æ€å˜åŒ–ã€‚å¯ä»¥è®©ä»£ç æ›´ä¸ºæ¸…æ™°ä¾¿äºç†è§£ï¼Œå¹¶ä¸”é€šè¿‡é’©å­æ¥åˆ›å»ºç»„ä»¶å¯ä»¥ç”¨æ›´å°‘çš„ä»£ç è·å–æ›´å¿«çš„å“åº”é€Ÿåº¦</p>
<p>å°½ç®¡çœ‹ä¸Šå»ä½¿ç”¨useReducerå’ŒReduxæ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œä½†å®ƒå¹¶ä¸æ˜¯Reduxã€‚useReducerå‡½æ•°å’Œå…¶reducerç´§å¯†è”ç³»åœ¨ä¸€èµ·ï¼Œä½¿å¾—èƒ½å¤Ÿä½¿ç”¨å®ƒçš„dispatchå‡½æ•°ã€‚ä½†æˆ‘ä»¬ä»…ä»…å‘reducerä¼ é€’dispatchçš„actionå¯¹è±¡è€Œå·²</p>
<p><strong>ä½ å¯ä»¥è®¤ä¸ºReduxæ˜¯ä¸€ä¸ªå…¨å±€çŠ¶æ€æ€»çº¿ï¼Œå®ƒå°†æ‰¿è½½ä»»æ„ä¸€ä¸ªäº‹ä»¶(action)å¹¶ä¸”åŸºäºactionæä¾›çš„æ•°æ®å’ŒçŠ¶æ€è¿›è¡Œå¤„ç†</strong></p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>Reduxå’Œå…¶ä»–ReactçŠ¶æ€ç®¡ç†è§£å†³æ–¹æ¡ˆä¹‹æ‰€ä»¥è¢«æå‡ºæ˜¯å› ä¸ºåœ¨Reactç»„ä»¶ä¸­ç®¡ç†ä¸€ä¸ªå…¨å±€çŠ¶æ€æ˜¯ä¸€ä¸ªéå¸¸æ„šè ¢çš„æƒ³æ³•ã€‚å¦‚æœè¿™ä¹ˆåšä¼šå¯¼è‡´ä¸€ç³»åˆ—é—®é¢˜ï¼Œå¦‚å¤šæºæ•°æ®å’Œä½¿ç”¨è™šæ‹Ÿæ¨¡å‹ä»£æ›¿åŸå§‹æ¨¡å‹å±•ç¤ºç­‰ç­‰</p>
<p>å¦‚æœé’©å­èƒ½å¤Ÿè®©çŠ¶æ€ç®¡ç†æ›´æ¸…æ™°ï¼Œæˆ‘è®¤ä¸ºåœ¨å°å‹åº”ç”¨ä¸­å¯ä»¥å°è¯•ä¸ä½¿ç”¨Reduxã€‚ä½†å¯¹äºå¤§å‹çš„å¤æ‚çš„åº”ç”¨ç¨‹åºï¼Œå…¨å±€çŠ¶æ€ç®¡ç†ä»ç„¶ä¸èƒ½è¢«å¿½ç•¥</p>
]]></content></item><item><title>åˆ©ç”¨fusumaä¸ºLinuxæ·»åŠ è§¦æ§æ¿æ‰‹åŠ¿</title><link>https://blog.thinkmoe.icu/posts/%E5%88%A9%E7%94%A8fusuma%E4%B8%BAlinux%E6%B7%BB%E5%8A%A0%E8%A7%A6%E6%8E%A7%E6%9D%BF%E6%89%8B%E5%8A%BF/</link><pubDate>Sat, 19 Jun 2021 21:07:52 +0800</pubDate><guid>https://blog.thinkmoe.icu/posts/%E5%88%A9%E7%94%A8fusuma%E4%B8%BAlinux%E6%B7%BB%E5%8A%A0%E8%A7%A6%E6%8E%A7%E6%9D%BF%E6%89%8B%E5%8A%BF/</guid><description>ä¹‹å‰ä¸€ç›´åœ¨æ–°ç¬”è®°æœ¬ä¸Šç”¨è™šæ‹Ÿæœºå¼€Linuxç¼–å†™æ¯•è®¾ï¼Œç°åœ¨æ¯•ä¸šç­”è¾©å·²ç»å®Œæˆï¼Œæ‰€ä»¥å°±ç›´æ¥å°†Win10æ›´æ¢åˆ°Linuxç³»ç»Ÿã€‚ä½†æ˜¯ä¼—æ‰€å‘¨çŸ¥ï¼ŒLinux</description><content type="html"><![CDATA[<p>ä¹‹å‰ä¸€ç›´åœ¨æ–°ç¬”è®°æœ¬ä¸Šç”¨è™šæ‹Ÿæœºå¼€Linuxç¼–å†™æ¯•è®¾ï¼Œç°åœ¨æ¯•ä¸šç­”è¾©å·²ç»å®Œæˆï¼Œæ‰€ä»¥å°±ç›´æ¥å°†Win10æ›´æ¢åˆ°Linuxç³»ç»Ÿã€‚ä½†æ˜¯ä¼—æ‰€å‘¨çŸ¥ï¼ŒLinuxå¹¶æ²¡æœ‰è‡ªå¸¦è§¦æ§æ¿æ‰‹åŠ¿é©±åŠ¨ï¼Œä½†æˆ‘æ—©å·²ä¹ æƒ¯äºwinä¸Šçš„ä¸€äº›æ‰‹åŠ¿ï¼Œæ‰€ä»¥æˆ‘å¼€å§‹å¯»æ‰¾ä¸€ä¸ªåˆé€‚çš„è§¦æ§æ¿æ‰‹åŠ¿é©±åŠ¨ã€‚</p>
<p>åœ¨æœ€åˆï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªåä¸º<code>libinput-gesture</code>çš„åº“ï¼Œå…¶Githubä¸Šæœ‰3kèµï¼Œäºæ˜¯æˆ‘ç«‹é©¬å°±å°è¯•äº†è¿™ä¸ªåº“ã€‚å®‰è£…è¿‡ç¨‹ä¸€åˆ‡ç•…é€šï¼Œä½†æœ€åè¿è¡Œçš„é˜¶æ®µå´å‡ºäº†é—®é¢˜ã€‚åœ¨å¯åŠ¨è¯¥åº“æ—¶æç¤ºæˆ‘å¯åŠ¨å¤±è´¥ï¼Œä½†å¹¶æ²¡æœ‰ç»™å…¶ä»–é”™è¯¯ä¿¡æ¯ã€‚æˆ‘æ£€æŸ¥äº†<code>xinput</code>å’Œ<code>libinput</code>å¯¹è§¦æ§æ¿çš„é©±åŠ¨ï¼Œå¹¶æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚è°·æ­Œäº†ä¸€ä¸‹å‘ç°è¿™ç©æ„å¯¹archç”¨æˆ·éå¸¸è‰¯å¥½ï¼Œä½†å¯¹æˆ‘è¿™ä½¿ç”¨çš„ubuntuæ¥è¯´ä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚äºæ˜¯æˆ‘æŠŠç›®å…‰è½¬å‘å¦ä¸€ä¸ªåº“ï¼Œ<code>fusuma</code>ã€‚</p>
<p><code>fusuma</code>è¿™ä¸ªåŒ…éå¸¸å®Œç¾çš„è§£å†³äº†Ubuntuè§¦æ§æ¿æ‰‹åŠ¿çš„é—®é¢˜ï¼Œå¹¶ä¸”å®‰è£…è¿‡ç¨‹æå…¶ç®€å•ï¼Œé…ç½®ä¹Ÿååˆ†ç®€æ´æ˜äº†ã€‚</p>
<h2 id="å®‰è£…">å®‰è£…</h2>
<h4 id="é…ç½®ç”¨æˆ·æƒé™">é…ç½®ç”¨æˆ·æƒé™</h4>
<p>é¦–å…ˆéœ€è¦é…ç½®ä¸€ä¸‹ç”¨æˆ·çŠ¶æ€ç»„ï¼Œå°†ç”¨æˆ·æ·»åŠ åˆ°<code>input</code>ç»„ä¸­</p>
<pre><code>sudo gpasswd -a $USER input
newgrp input // ç«‹åˆ»åˆ·æ–°
</code></pre>
<h4 id="å¯¹äºdebianç³»ç”¨æˆ·ubuntudebianmintpopos">å¯¹äºDebianç³»ç”¨æˆ·(Ubuntu,Debian,Mint,Pop!OS)</h4>
<ol>
<li>å®‰è£…libinput</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sudo apt install libinput-tools
</span></span></code></pre></div><ol start="2">
<li>å®‰è£…Ruby</li>
</ol>
<p>ç”±äºfusumaéœ€è¦åœ¨rubyä¸Šè¿è¡Œï¼Œå› æ­¤éœ€è¦å®‰è£…rubyã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sudo apt install ruby
</span></span></code></pre></div><ol start="3">
<li>å®‰è£…Fusuma</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sudo gem install fusuma
</span></span></code></pre></div><ol start="4">
<li>å®‰è£…xdotool(å¯é€‰ï¼Œä½†æ˜¯å¯¹åç»­éå¸¸æœ‰ç”¨å»ºè®®å®‰è£…)</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sudo apt install xdotool
</span></span></code></pre></div><h4 id="å¯¹äºarchç”¨æˆ·">å¯¹äºArchç”¨æˆ·</h4>
<pre><code>sudo pacman -S libinput ruby xdotool
sudo gem install fusuma
</code></pre>
<h4 id="å¯åŠ¨">å¯åŠ¨</h4>
<pre><code>fusuma
</code></pre>
<h2 id="é…ç½®">é…ç½®</h2>
<p>Fusumaçš„é…ç½®éå¸¸ç®€å•ï¼Œé¦–å…ˆéœ€è¦åœ¨ç”¨æˆ·ç›®å½•ä¸‹åˆ›å»ºé…ç½®æ–‡ä»¶<code>~/.config/fusuma/config.yml</code></p>
<pre><code>mkdir -p $HOME/.config/fusuma
touch $HOME/.config/fusuma/config.yml
</code></pre>
<p>è¿™é‡Œç®€å•è´´å‡ºæˆ‘ä½¿ç”¨çš„é…ç½®ï¼Œå¯ä»¥åœ¨é…ç½®ä¸­å‘ç°ï¼Œå…¶å®æ‰‹åŠ¿æ˜¯é€šè¿‡<code>xdotool</code>å·¥å…·é—´æ¥è°ƒç”¨ç³»ç»Ÿçš„å¿«æ·é”®æ¥å®ç°æ‰‹åŠ¿æ§åˆ¶çš„</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">swipe</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">3</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">left</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;xdotool key alt+Right&#34;</span><span class="w"> </span><span class="c"># History forward</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">right</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;xdotool key alt+Left&#34;</span><span class="w"> </span><span class="c"># History back</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c">#up:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c">#command: &#34;xdotool key super&#34; # Activity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c">#down:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c">#command: &#34;xdotool key super&#34; # Activity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">4</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">left</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;xdotool key alt+u&#34;</span><span class="w"> </span><span class="c"># Switch to next workspace</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">right</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;xdotool key alt+d&#34;</span><span class="w"> </span><span class="c"># Switch to previous workspace</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">up</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;xdotool key alt+u&#34;</span><span class="w"> </span><span class="c"># Switch to next workspace</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">down</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;xdotool key alt+d&#34;</span><span class="w"> </span><span class="c"># Switch to previous workspace</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">pinch</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">in</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;xdotool keydown ctrl click 4 keyup ctrl&#34;</span><span class="w"> </span><span class="c"># Zoom in</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">out</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;xdotool keydown ctrl click 5 keyup ctrl&#34;</span><span class="w"> </span><span class="c"># Zoom out</span><span class="w">
</span></span></span></code></pre></div><p>åœ¨æ·»åŠ å®Œé…ç½®æ–‡ä»¶åï¼Œé‡æ–°å¯åŠ¨fusumaå³å¯ä½¿ç”¨æ‰‹åŠ¿åŠ¨ä½œäº†</p>
<blockquote>
<p>é…ç½®æ–‡ä»¶ä¸­çš„alt+uå’Œalt+dä¸ºæœ¬äººè‡ªå®šä¹‰å¿«æ·é”®ï¼Œè¯·æ›´æ¢ä¸ºè‡ªå·±ç³»ç»Ÿå¿«æ·é”®</p>
</blockquote>
<h2 id="å¼€æœºè‡ªå¯åŠ¨">å¼€æœºè‡ªå¯åŠ¨</h2>
<p>Fusumaçš„å¼€æœºè‡ªå¯åŠ¨ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæœ‰ä¸¤ç§æ–¹å¼</p>
<h4 id="é€šè¿‡æ¡Œé¢ç®¡ç†å™¨è‡ªå¯">é€šè¿‡æ¡Œé¢ç®¡ç†å™¨è‡ªå¯</h4>
<p>å¤§éƒ¨åˆ†ç”¨æˆ·ä½¿ç”¨çš„æ¡Œé¢éƒ½å¸¦æœ‰Autostartçš„åŠŸèƒ½ï¼Œå¦‚å®˜æ–¹æä¾›çš„æ•™ç¨‹æ‰€è¯´(Gnomeç”¨æˆ·)ï¼š</p>
<ol>
<li>ä½¿ç”¨<code>which fusuma</code>æŸ¥çœ‹fusumaä½ç½®</li>
<li>æ‰“å¼€<code>gnome-session-properties</code></li>
<li>æ·»åŠ Fusumaç›¸å…³ä¿¡æ¯</li>
<li>åœ¨å‘½ä»¤æœ«å°¾æ·»åŠ <code>-d</code>é€‰é¡¹</li>
</ol>
<h4 id="é€šè¿‡systemdå¼€æœºå¯åŠ¨">é€šè¿‡systemdå¼€æœºå¯åŠ¨</h4>
<p>è¿™ç§æ–¹å¼é€‚ç”¨äºæ‰€æœ‰ç”¨æˆ·ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºè§¦æ§æ¿é©±åŠ¨æ˜¯ç”¨æˆ·å±‚ä½¿ç”¨çš„ï¼Œåœ¨serviceæ–‡ä»¶ä¸­å¦‚æœé‡‡å–ç³»ç»Ÿçº§åˆ«çš„å¯åŠ¨éœ€è¦é¢å¤–æ·»åŠ ç¯å¢ƒé…ç½®ä¿¡æ¯ï¼Œå¦‚æœæ˜¯ä»¥ç”¨æˆ·æœåŠ¡å¯åŠ¨åˆ™æ— éœ€æ·»åŠ </p>
<ol>
<li>ç³»ç»ŸæœåŠ¡</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># /etc/systemd/system/fusuma.service</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>Unit<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">Description</span><span class="o">=</span>Fusuma touchpad gestures
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>Service<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">EnvironmentFile</span><span class="o">=</span><span class="s2">&#34;DISPLAY=:0&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">ExecStart</span><span class="o">=</span>/usr/local/bin/fusuma
</span></span><span class="line"><span class="cl"><span class="nv">ExecReload</span><span class="o">=</span>/bin/kill -HUP <span class="nv">$MAINPID</span>
</span></span><span class="line"><span class="cl"><span class="nv">KillMode</span><span class="o">=</span>process
</span></span><span class="line"><span class="cl"><span class="nv">Restart</span><span class="o">=</span>on-failure
</span></span><span class="line"><span class="cl"><span class="nv">RestartSec</span><span class="o">=</span>42s
</span></span><span class="line"><span class="cl"><span class="nv">User</span><span class="o">=</span>youruser
</span></span><span class="line"><span class="cl"><span class="nv">Group</span><span class="o">=</span>yourusergroup
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>Install<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</span></span></code></pre></div><blockquote>
<p>å‚è€ƒ<a href="https://github.com/iberianpig/fusuma/issues/52">Github Fusuma Issue</a></p>
</blockquote>
<p>ç„¶åå¯åŠ¨æœåŠ¡ï¼Œå¹¶è®¾ç½®è‡ªå¯</p>
<pre><code>sudo systemctl enable fusuma
sudo systemctl start fusuma
# æŸ¥çœ‹å¯åŠ¨çŠ¶æ€
sudo systemctl status fusuma
</code></pre>
<ol start="2">
<li>ç”¨æˆ·æœåŠ¡</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># $HOME/.config/systemd/user/fusuma.service</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>Unit<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">Description</span><span class="o">=</span>Fusuma touchpad gestures
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>Service<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">ExecStart</span><span class="o">=</span>/usr/local/bin/fusuma -d
</span></span><span class="line"><span class="cl"><span class="nv">ExecReload</span><span class="o">=</span>/bin/kill -HUP <span class="nv">$MAINPID</span>
</span></span><span class="line"><span class="cl"><span class="nv">KillMode</span><span class="o">=</span>process
</span></span><span class="line"><span class="cl"><span class="nv">Restart</span><span class="o">=</span>on-failure
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>Install<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</span></span></code></pre></div><p>ç„¶åå¯åŠ¨æœåŠ¡ï¼Œå¹¶è®¾ç½®è‡ªå¯</p>
<pre><code>systemctl --user enable fusuma
systemctl --user start fusuma
# æŸ¥çœ‹å¯åŠ¨çŠ¶æ€
systemctl --user status fusuma
</code></pre>
<p>æœ€åå°±å¯ä»¥é€šè¿‡æ‰‹åŠ¿æ¥æ“æ§æ¡Œé¢äº†~</p>
]]></content></item><item><title>Innodbäº‹ç‰©éš”ç¦»çº§åˆ«åŠå…¶é” ç¾å›¢æŠ€æœ¯å­¦ä¹ </title><link>https://blog.thinkmoe.icu/posts/innodb%E4%BA%8B%E7%89%A9%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E5%8F%8A%E5%85%B6%E9%94%81-%E7%BE%8E%E5%9B%A2%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0/</link><pubDate>Sun, 13 Jun 2021 12:40:53 +0800</pubDate><guid>https://blog.thinkmoe.icu/posts/innodb%E4%BA%8B%E7%89%A9%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E5%8F%8A%E5%85%B6%E9%94%81-%E7%BE%8E%E5%9B%A2%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0/</guid><description>&lt;blockquote>
&lt;p>æœ¬æ–‡æ˜¯é˜…è¯»&lt;a href="https://tech.meituan.com/2014/08/20/innodb-lock.html">ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ&lt;/a>çš„è®°å½•å½¢æ–‡ç« ï¼Œæ›´è¯¦ç»†å†…å®¹è¯·è®¿é—®ç¾å›¢æŠ€æœ¯å›¢é˜Ÿå®˜æ–¹ç½‘ç«™&lt;/p>
&lt;/blockquote></description><content type="html"><![CDATA[<blockquote>
<p>æœ¬æ–‡æ˜¯é˜…è¯»<a href="https://tech.meituan.com/2014/08/20/innodb-lock.html">ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ</a>çš„è®°å½•å½¢æ–‡ç« ï¼Œæ›´è¯¦ç»†å†…å®¹è¯·è®¿é—®ç¾å›¢æŠ€æœ¯å›¢é˜Ÿå®˜æ–¹ç½‘ç«™</p>
</blockquote>
<h1 id="ä¸¤æ®µé”">ä¸¤æ®µé”</h1>
<p>æ•°æ®åº“éµå¾ªçš„æ˜¯ä¸¤æ®µé”åè®®ï¼Œå°†äº‹åŠ¡åˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼šåŠ é”å’Œè§£é”</p>
<ul>
<li>åŠ é”é˜¶æ®µï¼šåœ¨è¯¥é˜¶æ®µå¯¹ä»»ä½•æ•°æ®è¿›è¡Œè¯»æ“ä½œä¹‹å‰éƒ½è¦ç”³è¯·å¹¶è·å¾—Sé”ï¼Œåœ¨è¿›è¡Œå†™æ“ä½œä¹‹å‰è¦è·å–Xé”</li>
<li>è§£é”é˜¶æ®µï¼šå½“äº‹åŠ¡é‡Šæ”¾ä¸€ä¸ªå°é”åï¼Œè¿›å…¥è§£é”é˜¶æ®µï¼Œåœ¨è¯¥é˜¶æ®µåªèƒ½è¿›è¡Œè§£é”æ“ä½œä¸èƒ½è¿›è¡ŒåŠ é”é˜¶æ®µ</li>
</ul>
<p>ä¸¤æ®µé”å¯ä»¥ä¿è¯äº‹åŠ¡çš„å¹¶å‘è°ƒåº¦æ˜¯ä¸²è¡ŒåŒ–çš„</p>
<h1 id="å››ç§éš”ç¦»çº§åˆ«">å››ç§éš”ç¦»çº§åˆ«</h1>
<table>
<thead>
<tr>
<th>éš”ç¦»çº§åˆ«</th>
<th>è„è¯»</th>
<th>ä¸å¯é‡å¤è¯»</th>
<th>å¹»è¯»</th>
</tr>
</thead>
<tbody>
<tr>
<td>æœªæäº¤è¯»(RU)</td>
<td>å¯èƒ½</td>
<td>å¯èƒ½</td>
<td>å¯èƒ½</td>
</tr>
<tr>
<td>å·²æäº¤è¯»(RC)</td>
<td>ä¸å¯èƒ½</td>
<td>å¯èƒ½</td>
<td>å¯èƒ½</td>
</tr>
<tr>
<td>å¯é‡å¤è¯»(RR)</td>
<td>ä¸å¯èƒ½</td>
<td>ä¸å¯èƒ½</td>
<td>å¯èƒ½</td>
</tr>
<tr>
<td>å¯ä¸²è¡ŒåŒ–(SE)</td>
<td>ä¸å¯èƒ½</td>
<td>ä¸å¯èƒ½</td>
<td>ä¸å¯èƒ½</td>
</tr>
</tbody>
</table>
<ul>
<li>RUï¼šå…è®¸è„è¯»ï¼Œå¯èƒ½è¯»å–åˆ°å…¶ä»–ä¼šè¯ä¸­æœªæäº¤äº‹åŠ¡ä¿®æ”¹çš„æ•°æ®</li>
<li>RCï¼šåªèƒ½è¯»å–åˆ°å·²æäº¤çš„æ•°æ®ï¼ŒOracleé»˜è®¤çº§åˆ«</li>
<li>RRï¼šåœ¨åŒä¸€ä¸ªäº‹åŠ¡å†…çš„æŸ¥è¯¢éƒ½æ˜¯äº‹åŠ¡å¼€å§‹æ—¶åˆ»ä¸€è‡´æ€§çš„ï¼ŒInnoDBé»˜è®¤çº§åˆ«ï¼ŒçœŸæ­£æ¶ˆé™¤äº†ä¸å¯é‡å¤è¯»ï¼Œä½†å­˜åœ¨å¹»è¯»</li>
<li>SEï¼šå®Œå…¨ä¸²è¡Œæ‰§è¡Œï¼Œè¯»å†™ç›¸äº’é˜»å¡</li>
</ul>
<h1 id="mysqlé”çš„ç§ç±»">MySQLé”çš„ç§ç±»</h1>
<p>MySQLä¸­æœ‰å¾ˆå¤šç§é”ï¼Œè¡Œé”ã€è¡¨é”ç­‰ç­‰ã€‚è¡¨é”æ˜¯å¯¹ä¸€æ•´å¼ è¡¨åŠ é”ï¼Œä½†æ˜¯ä¼šé”ä½æ•´å¼ è¡¨å¯¼è‡´å¹¶å‘èƒ½åŠ›ä¸‹é™ï¼Œä¸€èˆ¬åœ¨DDLæ—¶ä½¿ç”¨</p>
<p>è¡Œé”åˆ™é”ä½æ•°æ®è¡Œï¼Œåªé”ä½æœ‰é™çš„æ•°æ®ï¼Œå¹¶å‘èƒ½åŠ›å¼º</p>
<h1 id="å·²æäº¤è¯»rc">å·²æäº¤è¯»(RC)</h1>
<p>åœ¨RCä¸­ï¼Œæ•°æ®çš„è¯»å–æ˜¯ä¸åŠ é”çš„ï¼Œä½†æ˜¯å†™å…¥ã€ä¿®æ”¹å’Œåˆ é™¤æ˜¯éœ€è¦åŠ é”çš„</p>
<table>
<thead>
<tr>
<th>äº‹åŠ¡A</th>
<th>äº‹åŠ¡B</th>
</tr>
</thead>
<tbody>
<tr>
<td>begin;</td>
<td>begin;</td>
</tr>
<tr>
<td>update class_teacher set class_name=&lsquo;Class1&rsquo; where teacher_id=1;</td>
<td>update class_teacher set class_name=â€˜åˆä¸‰ä¸‰ç­â€™ where teacher_id=1;</td>
</tr>
<tr>
<td>commit;</td>
<td></td>
</tr>
</tbody>
</table>
<p>ä¸ºäº†é˜²æ­¢å¹¶å‘è¿‡ç¨‹ä¸­ä¿®æ”¹å†²çªï¼Œäº‹åŠ¡Aä¸­ä¼šç»™teacher_id=1çš„æ•°æ®è¡ŒåŠ é”ï¼Œå¹¶ä¸€ç›´ä¸commitï¼Œè¿™æ ·äº‹åŠ¡Bå°±ä¸€ç›´æ‹¿ä¸åˆ°è¯¥è¡Œé”ï¼Œwaitç›´åˆ°è¶…æ—¶</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œteacher_idæ˜¯æœ‰ç´¢å¼•çš„ï¼Œå¦‚æœæŸ¥è¯¢çš„æ˜¯æ²¡æœ‰ç´¢å¼•çš„å­—æ®µå‘¢ï¼Œé‚£ä¹ˆMySQLä¼šç»™æ•´å¼ è¡¨çš„æ‰€æœ‰æ•°æ®è¡ŒåŠ è¡Œé”(è¡¨é”?)ã€‚è¿™æ˜¯å› ä¸ºåœ¨SQLè¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒMySQLå¹¶ä¸çŸ¥é“å“ªäº›æ•°æ®è¡Œæ˜¯éœ€è¦æŸ¥è¯¢çš„ï¼Œå¦‚æœä¸€ä¸ªæ¡ä»¶æ— æ³•é€šè¿‡ç´¢å¼•å¿«é€Ÿè¿‡æ»¤ï¼Œå°±ä¼šå°†æ‰€æœ‰è®°å½•åŠ é”åè¿”å›ï¼Œå†ç”±MySQL Serverå±‚è¿›è¡Œè¿‡æ»¤</p>
<p>ä½†MySQLåœ¨è¿™ç§æƒ…å†µåšäº†ä¸€äº›æ”¹è¿›ï¼Œåœ¨Serverè¿‡æ»¤æ—¶ä¼šå°†ä¸æ»¡è¶³æ¡ä»¶çš„æ•°æ®è°ƒç”¨unlock_rowçš„æ–¹æ³•é‡Šæ”¾è¯¥è®°å½•çš„é”ï¼Œè¿™å°±ä¿è¯äº†åªæœ‰æŒæœ‰æ»¡è¶³æ¡ä»¶çš„è¡Œä¼šä¸Šé”</p>
<p>è¿™ç§æƒ…å†µåŒæ ·é€‚ç”¨äºRRçº§åˆ«ï¼Œå› æ­¤åœ¨å¯¹ä¸€ä¸ªæ•°æ®é‡å¾ˆå¤§çš„è¡¨åšæ‰¹é‡ä¿®æ”¹æ—¶ï¼Œå¦‚æœæ— æ³•ä½¿ç”¨ç´¢å¼•ï¼ŒMySQLçš„è¿‡æ»¤é€Ÿåº¦å°†ä¼šç‰¹åˆ«æ…¢</p>
<h1 id="å¯é‡å¤è¯»rr">å¯é‡å¤è¯»(RR)</h1>
<p>RRæ˜¯InnoDBçš„é»˜è®¤éš”ç¦»çº§åˆ«</p>
<h1 id="è¯»read">è¯»(Read)</h1>
<p>å¯é‡è¯»æ˜¯æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡çš„å¤šä¸ªå®ä¾‹å¹¶å‘è¯»å–æ•°æ®æ—¶ä¿æŒä¸€è‡´æ€§</p>
<p>ä¾‹å¦‚åœ¨RCéš”ç¦»çº§åˆ«ä¸‹ï¼Œå¦‚æœäº‹åŠ¡Aå¯¹æ•°æ®è¡¨çš„æŸä¸€è¡Œè¿›è¡Œè¯»å–åï¼Œäº‹åŠ¡Bä¹Ÿå¯¹è¯¥è¡Œåšäº†ä¿®æ”¹å¹¶æäº¤è¯¥äº‹åŠ¡ã€‚æ­¤æ—¶äº‹åŠ¡Aåˆå¯¹è¯¥è¡Œè¿›è¡Œäº†è¯»å–ï¼Œæœ€ç»ˆè¿”å›çš„ç»“æœå’Œç¬¬ä¸€æ¬¡è¯»å–æ˜¯ä¸ä¸€è‡´çš„ï¼Œè¿™å°±æ˜¯ä¸å¯é‡å¤è¯»RC</p>
<p>ä½†åœ¨RRçº§åˆ«ä¸‹ï¼Œå³ä½¿åˆ«çš„äº‹åŠ¡å¯¹æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œåé¢è¯»å–çš„æ•°æ®å’Œå‰é¢æ˜¯ä¿æŒä¸€è‡´çš„ï¼Œè¿™å°±æ˜¯RRï¼Œè€Œå¦‚ä½•å®ç°çš„å‘¢ï¼Œé‚£å°±æ˜¯MVCCäº†</p>
<h2 id="ä¸å¯é‡å¤è¯»å’Œå¹»è¯»çš„åŒºåˆ«">ä¸å¯é‡å¤è¯»å’Œå¹»è¯»çš„åŒºåˆ«</h2>
<p>ä¸å¯é‡å¤è¯»é‡ç‚¹åœ¨äºupdateå’Œdeleteï¼Œè€Œå¹»è¯»é‡ç‚¹åœ¨äºinsert</p>
<p>å¦‚æœä½¿ç”¨é”æ¥å®ç°çš„è¯ï¼Œåœ¨å¯é‡å¤è¯»ä¸­sqlç¬¬ä¸€æ¬¡è¯»å–æ•°æ®åå°±å¯¹æ•°æ®åŠ é”ï¼Œå…¶ä»–äº‹åŠ¡æ— æ³•ä¿®æ”¹å°±å¯å®ç°å¯é‡å¤è¯»ä½†æ˜¯æ— æ³•é”ä½insertçš„æ•°æ®ï¼Œå› æ­¤äº‹åŠ¡Aå¦‚æœå…ˆè¯»å–æ•°æ®æˆ–ä¿®æ”¹æ•°æ®ï¼Œäº‹åŠ¡Bè¿˜æ˜¯å¯ä»¥insertæäº¤æ•°æ®ï¼Œè¿™æ—¶Aä¸­å°±ä¼šå‘ç°å‡­ç©ºå¤šå‡ºäº†ä¸€æ¡æ•°æ®ï¼Œè¿™å°±æ˜¯å¹»è¯»ï¼Œç®€å•çš„è¡Œé”æ˜¯ä¸èƒ½é¿å…å¹»è¯»çš„éœ€è¦æ›´é«˜çº§çš„ä¸²è¡Œéš”ç¦»çº§åˆ«ï¼Œè¯»å†™ç”¨å„è‡ªçš„é”å¹¶äº’æ–¥ï¼Œè¿™æ ·å°±èƒ½æœ‰æ•ˆé¿å…å¹»è¯»ã€ä¸å¯é‡å¤è¯»ã€è„è¯»ç­‰é—®é¢˜ä½†ä¼šå½±å“æ•°æ®åº“çš„å¹¶å‘æ€§èƒ½</p>
<h2 id="æ‚²è§‚é”å’Œä¹è§‚é”">æ‚²è§‚é”å’Œä¹è§‚é”</h2>
<ul>
<li>æ‚²è§‚é”<br>
æŒ‡æ•°æ®å¯¹ä¿®æ”¹æŒä¿æŒæ€åº¦ï¼Œåœ¨æ•´ä¸ªæ•°æ®å¤„ç†è¿‡ç¨‹ä¸­éƒ½æŠŠæ•°æ®é”ä½å…¶ä»–äº‹åŠ¡ä¸èƒ½å¹²æ‰°åªèƒ½ç­‰å¾…ã€‚æ‚²è§‚é”å¾€å¾€å‡­é æ•°æ®åº“æä¾›çš„é”æ¥å®ç°ï¼Œåœ¨æ‚²è§‚é”çš„æƒ…å†µä¸‹ï¼Œä¸ºäº†ä¿è¯äº‹åŠ¡çš„éš”ç¦»æ€§å°±éœ€è¦ä¸€è‡´æ€§é”å®šè¯»ã€‚è¯»å–æ—¶ä¹Ÿéœ€è¦åŠ é”ï¼Œä¿è¯å…¶ä»–äº‹åŠ¡ä¸èƒ½ä¿®æ”¹è¯¥æ•°æ®ï¼›ä¿®æ”¹æ—¶ä¹Ÿè¦åŠ é”ï¼Œä¿è¯å…¶ä»–äº‹åŠ¡åœ¨ä¿®æ”¹æ—¶ä¸èƒ½è¯»å–æ•°æ®</li>
<li>ä¹è§‚é”<br>
ä¹è§‚é”é‡‡ç”¨æ›´ä¸ºå®½æ¾çš„æƒ…å†µä¸‹ï¼Œå¤§éƒ¨åˆ†åŸºäºæ•°æ®ç‰ˆæœ¬è®°å½•æ¥å®ç°ã€‚ç‰ˆæœ¬è®°å½•å°±æ˜¯åœ¨æ•°æ®æ·»åŠ ä¸€ä¸ªç‰ˆæœ¬å­—æ®µï¼Œé€šå¸¸ä¸º<code>version</code>ã€‚åœ¨è¯»å–æ•°æ®æ—¶ï¼ŒåŒæ—¶å°†ç‰ˆæœ¬å·ä¸€å¹¶è¯»å‡ºï¼Œåœ¨æ›´æ–°è¯¥æ•°æ®æ—¶å¯¹å…¶ç‰ˆæœ¬å·åŠ 1ã€‚æ­¤æäº¤çš„æ•°æ®ç‰ˆæœ¬ä¼šå’Œæ•°æ®è¡¨å¯¹åº”è®°å½•çš„å½“å‰ç‰ˆæœ¬ä¿¡æ¯å¯¹æ¯”ï¼Œå¦‚æœæäº¤æ•°æ®ç‰ˆæœ¬å·å¤§äºæ•°æ®åº“è¡¨å½“å‰ç‰ˆæœ¬å·ï¼Œåˆ™äºˆä»¥æ›´æ–°ï¼Œå¦åˆ™è®¤ä¸ºæ˜¯è¿‡æœŸæ•°æ®</li>
</ul>
<h2 id="innodbä¸­çš„mvvc">InnoDBä¸­çš„MVVC</h2>
<p>åœ¨InnoDBä¸­ï¼Œæ¯è¡Œæ•°æ®éƒ½ä¼šæ–°å¢ä¸¤ä¸ªéšè—å­—æ®µç”¨äºè®°å½•ä½•æ—¶åˆ›å»ºå’Œè¿‡æœŸ(åˆ é™¤)</p>
<p>åœ¨å®é™…ä¸­ï¼Œå­˜å‚¨çš„å¹¶ä¸æ˜¯æ—¶é—´ï¼Œè€Œæ˜¯äº‹åŠ¡çš„ç‰ˆæœ¬å·ï¼Œæ¯å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œç‰ˆæœ¬å·å°±ä¼šé€’å¢ï¼Œåœ¨RRçº§åˆ«ä¸‹</p>
<ul>
<li>SELECTæ—¶ï¼Œè¯»å–åˆ›å»ºç‰ˆæœ¬å·&lt;=å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ï¼Œåˆ é™¤ç‰ˆæœ¬å·ä¸ºç©ºæˆ–&gt;å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·</li>
<li>INSERTæ—¶ï¼Œä¿å­˜å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ä¸ºè¡Œçš„åˆ›å»ºç‰ˆæœ¬å·</li>
<li>DELETEæ—¶ï¼Œä¿å­˜å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ä¸ºè¡Œçš„åˆ é™¤ç‰ˆæœ¬å·</li>
<li>UPDATEæ—¶ï¼Œæ’å…¥ä¸€æ¡æ–°çºªå½•ï¼Œä¿å­˜å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ä¸ºè¡Œåˆ›å»ºç‰ˆæœ¬å·ï¼ŒåŒæ—¶ä¿å­˜å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·åˆ°åŸæ¥åˆ é™¤çš„è¡Œ</li>
</ul>
<p>MVVCä¼šå ç”¨é¢å¤–çš„æ§ä»¶ï¼Œè¿›è¡Œæ›´å¤šçš„è¡Œæ£€æŸ¥å’Œç»´æŠ¤å·¥ä½œï¼Œä½†èƒ½å‡å°‘è¡Œçš„ä½¿ç”¨ï¼Œå¤§å¤šæ•°è¯»æ“ä½œéƒ½ä¸ç”¨åŠ é”</p>
<p>ä»ç†è®ºä¸Šè¯´RRä¹Ÿä¸èƒ½è§£å†³å¹»è¯»é—®é¢˜ï¼Œåªæœ‰ä¸²è¡ŒåŒ–èƒ½å¤Ÿè§£å†³å¹»è¯»ã€‚ä½†åœ¨MySQLä¸­ï¼ŒRRçº§åˆ«ä¸‹ä¸å­˜åœ¨å¹»è¯»æƒ…å†µ</p>
<h1 id="å†™å½“å‰è¯»">å†™(å½“å‰è¯»)</h1>
<p>åœ¨MySQLä¸­ï¼Œäº‹åŠ¡é‡‡ç”¨äº†Next-Keyé”æ¥è§£å†³å¹»è¯»é—®é¢˜</p>
<h2 id="next-key">Next-Key</h2>
<p>Next-Keyé”æ˜¯è¡Œé”å’ŒGAPçš„åˆå¹¶</p>
<h1 id="ä¸²è¡ŒåŒ–">ä¸²è¡ŒåŒ–</h1>
<p>åœ¨ä¸²è¡ŒåŒ–è¯»å†™äº’æ–¥å¹¶ä¸€å¹¶åŠ é”ï¼Œå¹¶ä½¿ç”¨æ‚²è§‚é”ä½œä¸ºæœºåˆ¶å› æ­¤å®ç°ç®€å•ä¸”æ›´ä¸ºå®‰å…¨ï¼Œä½†æ˜¯ä¸¥é‡å½±å“å¹¶å‘æ€§èƒ½é€ æˆä¸¥é‡çš„æ€§èƒ½é—®é¢˜</p>
<p>å¦‚æœä¸šåŠ¡å¹¶å‘ç‰¹åˆ«å°‘ä¸”è¦æ±‚æ•°æ®å¯é ï¼Œå¯ä»¥è€ƒè™‘è¯¥éš”ç¦»çº§åˆ«</p>]]></content></item><item><title>ç”¨å®˜æ–¹çš„æ–¹å¼å®‰è£…Archlinux</title><link>https://blog.thinkmoe.icu/posts/%E7%94%A8%E5%AE%98%E6%96%B9%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85archlinux/</link><pubDate>Sun, 23 May 2021 22:47:09 +0800</pubDate><guid>https://blog.thinkmoe.icu/posts/%E7%94%A8%E5%AE%98%E6%96%B9%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85archlinux/</guid><description>Archlinuxæ˜¯ä¸€ä¸ªéå¸¸å¹²å‡€çš„Linuxå‘è¡Œç‰ˆï¼Œå¹²å‡€åˆ°ä»¥è‡´äºå›¾å½¢åŒ–ç•Œé¢éƒ½æ²¡æœ‰ï¼Œæœ¬æ–‡å°†æŒ‰ç…§å®˜æ–¹wikiï¼Œé€æ­¥å®‰è£…Archlinux ç”±äºå›½å†…</description><content type="html"><![CDATA[<p>Archlinuxæ˜¯ä¸€ä¸ªéå¸¸å¹²å‡€çš„Linuxå‘è¡Œç‰ˆï¼Œå¹²å‡€åˆ°ä»¥è‡´äºå›¾å½¢åŒ–ç•Œé¢éƒ½æ²¡æœ‰ï¼Œæœ¬æ–‡å°†æŒ‰ç…§<a href="https://wiki.archlinux.org/title/Installation_guide">å®˜æ–¹wiki</a>ï¼Œé€æ­¥å®‰è£…Archlinux</p>
<p>ç”±äºå›½å†…ç½‘ç»œé—®é¢˜ï¼Œå¯ä»¥åˆ°ä¸€äº›é•œåƒç½‘ç«™ä¸­æ¥ä¸‹è½½isoé•œåƒï¼Œè¿™é‡Œé€‰æ‹©<a href="https://mirrors.tuna.tsinghua.edu.cn/archlinux/iso/2021.04.01/">æ¸…åé•œåƒ</a>ï¼Œä¸‹è½½æœ€æ–°çš„5.15ç‰ˆæœ¬</p>
<blockquote>
<p>å…³äºå¯åŠ¨ç›˜ï¼Œå¯ä»¥ä½¿ç”¨<a href="https://sourceforge.net/projects/usbwriter/">USBWriter</a>æˆ–è€…<a href="https://rufus.ie">Rufus</a>æ¥åˆ¶ä½œï¼Œè¿™é‡Œå°±ä¸å¤šåŠ èµ˜è¿°</p>
</blockquote>
<h2 id="å‡†å¤‡è¿‡ç¨‹">å‡†å¤‡è¿‡ç¨‹</h2>
<h3 id="æ£€æŸ¥å¼•å¯¼æ¨¡å¼">æ£€æŸ¥å¼•å¯¼æ¨¡å¼</h3>
<p>è¦å®‰è£…Archï¼Œé¦–å…ˆè¦ç¡®è®¤è‡ªå·±ç”µè„‘çš„å¼•å¯¼æ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æŒ‡ä»¤æ¥æ£€æŸ¥</p>
<pre><code>ls /sys/firmware/efi/efivars
</code></pre>
<p>å¦‚æœè¯¥æŒ‡ä»¤æ²¡æœ‰å‡ºé”™å¹¶åˆ—å‡ºäº†æ–‡ä»¶åˆ—è¡¨ï¼Œåˆ™ä½ çš„ç”µè„‘æ˜¯ä½¿ç”¨UEFIæ¨¡å¼å¼•å¯¼çš„ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ç³»ç»Ÿå°†ä¼šä½¿ç”¨BIOS(æˆ–CSM)æ¨¡å¼æ¥å¼•å¯¼å¯åŠ¨ã€‚å¦‚æœç”µè„‘å¹¶ä¸æ˜¯ä»¥ä½ æƒ³è¦çš„æ–¹å¼å¯åŠ¨ï¼Œåˆ™éœ€è¦åˆ°ä¸»æ¿BIOSä¸­æ‰‹åŠ¨è®¾ç½®å¼•å¯¼æ¨¡å¼</p>
<h3 id="è¿æ¥ç½‘ç»œ">è¿æ¥ç½‘ç»œ</h3>
<p>Archçš„å®‰è£…ä¸€å®šéœ€è¦è”ç½‘ï¼Œå› æ­¤åœ¨ç¡®è®¤å¼•å¯¼æ¨¡å¼ä¹‹åï¼Œå¿…é¡»è¦æ£€æŸ¥ç½‘ç»œè¿æ¥çŠ¶æ€ã€‚ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤æ¥æ£€æŸ¥è‡ªå·±çš„ç½‘ç»œçŠ¶æ€:</p>
<ul>
<li>ç¡®ä¿ç½‘å¡æ­£ç¡®æ’å…¥ï¼Œä¾‹å¦‚é€šè¿‡<code>ip link</code>æ¥æ£€æŸ¥</li>
<li>å¯¹äºæ— çº¿ç”¨æˆ·ï¼Œç¡®ä¿æ— çº¿ç½‘å¡å·¥ä½œæ­£å¸¸ï¼Œå¯ä»¥é€šè¿‡<code>rfkill list</code>æ¥æ£€æŸ¥</li>
<li>è¿æ¥åˆ°äº’è”ç½‘
<ul>
<li>æœ‰çº¿ç”¨æˆ·ï¼šæ’å…¥ç½‘çº¿</li>
<li>æ— çº¿ç”¨æˆ·ï¼šé€šè¿‡<code>iwctl</code>æ¥å…¥WIFI</li>
<li>ç§»åŠ¨çƒ­ç‚¹ï¼šé€šè¿‡<code>mmcli</code>è¿æ¥çƒ­ç‚¹</li>
</ul>
</li>
<li>é…ç½®ç½‘ç»œè¿æ¥
<ul>
<li>DHCPï¼šåŠ¨æ€IPã€DNSæœåŠ¡ï¼Œé€‚ç”¨äºæœ‰çº¿ç½‘ç»œã€æ— çº¿ç½‘ç»œâ€¦â€¦</li>
<li>é™æ€IPåœ°å€</li>
</ul>
</li>
<li>ç¡®è®¤ç½‘ç»œè¿æ¥<code>ping www.baidu.com</code></li>
</ul>
<h3 id="æ›´æ”¹æ—¶é—´é…ç½®">æ›´æ”¹æ—¶é—´é…ç½®</h3>
<p>é¦–å…ˆé€šè¿‡<code>date -R</code>æ¥æ£€æŸ¥æ—¶é—´æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœä¸æ­£ç¡®åˆ™å¯ä»¥é€šè¿‡<code>timedatectl</code>æ¥æ›´æ”¹æ—¶åŒº</p>
<ul>
<li>é¦–å…ˆé€šè¿‡<code>timedatectl list-timezones</code>æ¥è·å–æ—¶åŒºåˆ—è¡¨</li>
<li>é€‰æ‹©è‡ªå·±æ‰€åœ¨æ—¶åŒºï¼Œä»¥å›½å†…ä¸ºä¾‹ï¼Œé€šè¿‡<code>timedatectl set-timezone Asia/Shanghai</code>æ¥æ›´æ”¹æ—¶åŒº</li>
<li>åŒæ­¥æ—¶åŒº<code>timedatectl set-ntp true</code></li>
</ul>
<h3 id="åˆ†åŒº">åˆ†åŒº</h3>
<p>ç”µè„‘ä¸­çš„ç¡¬ç›˜å°†ä¼šä»¥è®¾å¤‡å—çš„å½¢å¼å‡ºç°åœ¨ç³»ç»Ÿä¹‹ä¸­ï¼Œä¾‹å¦‚<code>/dev/sda</code>,<code>/dev/nvmeOn1</code>ï¼Œå¯ä»¥é€šè¿‡<code>fdisk</code>æ¥æŸ¥çœ‹</p>
<pre><code>fdisk -l
</code></pre>
<p>ä»¥ä¸‹åˆ—è¡¨çš„åˆ†åŒºæ˜¯å¿…è¦çš„</p>
<ul>
<li>ç”¨äºå­˜æ”¾æ ¹ç›®å½•çš„<code>/</code>åˆ†åŒº</li>
<li>å¯¹<code>UEFI</code>æ¨¡å¼çš„ç”¨æˆ·æ¥è¯´è¿˜éœ€è¦ä¸€ä¸ª<code>EFI system partition</code></li>
</ul>
<p>å¯¹äº<code>BIOS</code>ç”¨æˆ·ï¼Œéœ€è¦å°†<code>root</code>åˆ†åŒºæŒ‚è½½åˆ°<code>/mnt</code>ä¸­ï¼Œè€Œ<code>UEFI</code>è¿˜éœ€è¦å°†<code>EFI system partition</code>æŒ‚è½½åˆ°<code>/mnt/boot</code>æˆ–<code>/mnt/efi</code>åˆ†åŒºä¹‹ä¸­</p>
<p>å‡è®¾å½“å‰ä¸º<code>BIOS</code>æ¨¡å¼ï¼Œä¸”ç¡¬ç›˜ä¸º<code>/dev/sda</code>å¤§å°ä¸º15Gï¼Œæˆ‘ä»¬å¯ä»¥ç”¨<code>fdisk</code>æ¥å¯¹ç¡¬ç›˜è¿›è¡Œåˆ†åŒº</p>
<pre><code>fdisk /dev/sda # è¿›å…¥åˆ†åŒºæ¨¡å¼
g # åˆ›å»ºåˆ†åŒºè¡¨
n # åˆ›å»ºswapåˆ†åŒº
# é€‰æ‹©ä»»æ„ä¸€ä¸ªç¼–å·ï¼ˆé€šå¸¸é»˜è®¤ï¼‰
# é€‰æ‹©èµ·å§‹åŒºåŸŸï¼ˆé€šå¸¸é»˜è®¤ï¼‰
+2G # 
n # åˆ›å»ºæ ¹ç›®å½•åˆ†åŒº
# é€‰æ‹©ä»»æ„ä¸€ä¸ªç¼–å·ï¼ˆé€šå¸¸é»˜è®¤ï¼‰
# é€‰æ‹©èµ·å§‹åŒºåŸŸï¼ˆé€šå¸¸é»˜è®¤ï¼‰
+13G
t # æ›´æ”¹åˆ†åŒºç±»å‹
1 # é€‰æ‹©swapåˆ†åŒº
L # æŸ¥çœ‹æ‰€æœ‰ç±»å‹
19 # é€‰æ‹©Linux swap

# å¦‚æœæ˜¯efiç”¨æˆ·ï¼Œè¿˜éœ€è¦æ›´æ”¹efiåˆ†åŒºç±»å‹
</code></pre>
<h3 id="æ ¼å¼åŒ–">æ ¼å¼åŒ–</h3>
<p>åˆ†åŒºå®Œåï¼Œéœ€è¦å°†æ‰€æœ‰åˆ†åŒºè¿›è¡Œæ ¼å¼åŒ–ã€‚é€šå¸¸æ¥è¯´ï¼Œåˆ†åŒºæ—¶efiåˆ†åŒºä¸ºç¬¬ä¸€ä¸ªåŒºï¼Œå…¶æ¬¡æ˜¯swapåŒºç„¶åæ˜¯æ ¹ç›®å½•åŒºï¼ŒæŒ‰ç…§è¿™ä¸ªé¡ºåºä»¥æ­¤æ ¼å¼åŒ–ã€‚åœ¨è¿™é‡Œï¼Œåªæœ‰ä¸¤ä¸ªåˆ†åŒºåˆ†åˆ«ä¸º</p>
<ul>
<li>/dev/sda1: swap</li>
<li>/dev/sda2: æ ¹ç›®å½•</li>
</ul>
<p>å› æ­¤æ ¼å¼åŒ–æ“ä½œå¦‚ä¸‹</p>
<pre><code>mkswap /dev/sda1 
swapon /dev/sda1
mkfs.ext4 /dev/sda2
</code></pre>
<h3 id="æŒ‚è½½">æŒ‚è½½</h3>
<p>åˆ†åŒºå®Œä¹‹åï¼Œå°†ç¡¬ç›˜æŒ‚è½½åˆ°<code>/mnt</code>ç›®å½•ä¸­ï¼Œefiç”¨æˆ·è¿˜éœ€è¦å°†å¼•å¯¼åˆ†åŒºæŒ‚è½½åˆ°<code>/mnt/boot</code>ä¸­</p>
<pre><code>mount /dev/sda2 /mnt
</code></pre>
<h2 id="æ­£å¼å®‰è£…">æ­£å¼å®‰è£…</h2>
<h3 id="æ›´æ¢é•œåƒæº">æ›´æ¢é•œåƒæº</h3>
<p>åœ¨æŒ‚è½½å®Œæ–‡ä»¶ç³»ç»Ÿåï¼Œå°±æ˜¯Archlinuxçš„æ­£å¼å®‰è£…äº†ã€‚ä¸è¿‡ç”±äºç½‘ç»œé—®é¢˜ï¼Œå›½å†…æ¨èæ›´æ¢é•œåƒæºæ¥åŠ å¿«å®‰è£…é€Ÿåº¦</p>
<p>ä½¿ç”¨<code>vim</code>æˆ–<code>nano</code>æ‰“å¼€<code>/etc/pacman.d/mirrorlist</code>ï¼Œå°†å›½å†…é•œåƒåœ°å€å¡«å†™åœ¨æ–‡ä»¶çš„æœ€å¼€å¤´å¤„ï¼Œä»¥æ¸…åé•œåƒä¸ºä¾‹</p>
<pre><code>Server = https://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch
</code></pre>
<h3 id="åŸºæœ¬å®‰è£…">åŸºæœ¬å®‰è£…</h3>
<p>ä½¿ç”¨<code>pacstrap</code>å°†åŸºç¡€åŒ…å®‰è£…è¿›æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸­ï¼Œå®˜æ–¹è¦æ±‚å®‰è£…ä»¥ä¸‹ä¸‰ä¸ª</p>
<pre><code>pacstrap /mnt base linux linux-firmware
</code></pre>
<p>ä½†æ˜¯ï¼Œä¸ºäº†åç»­ç³»ç»Ÿé¡ºåˆ©ä½¿ç”¨ï¼Œè¿˜éœ€è¦å®‰è£…æ–‡æœ¬å¤„ç†å·¥å…·å’Œç½‘ç»œè¿æ¥å·¥å…·å’Œdhcpcdï¼Œå¦‚æœéœ€è¦ç¼–è¯‘è¿˜å¯ä»¥å®‰è£…base-develï¼Œè¿™äº›éƒ½å¯ä»¥æŒ‰éœ€è¿›è¡Œå®‰è£…</p>
<pre><code>pacstrap /mnt vim dhcpcd base-devel sudo
</code></pre>
<h2 id="é…ç½®ç³»ç»Ÿ">é…ç½®ç³»ç»Ÿ</h2>
<h3 id="fstab">Fstab</h3>
<p>ç”Ÿæˆè‡ªåŠ¨æŒ‚è½½åˆ†åŒºæ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨<code>fstab</code>è¿›è¡Œ</p>
<pre><code>genfstab -U /mnt &gt;&gt; /mnt/etc/fstab
</code></pre>
<p>æ¥ä¸‹æ¥å°±éœ€è¦åœ¨æ–°ç³»ç»Ÿå†…éƒ¨è¿›è¡Œæ“ä½œäº†</p>
<pre><code>arch-chroot /mnt
</code></pre>
<h3 id="é…ç½®æ—¶é—´">é…ç½®æ—¶é—´</h3>
<p>æ–°ç³»ç»Ÿéœ€è¦å®šä¹‰å¥½æ—¶é—´ä¿¡æ¯ï¼Œåœ¨è¿™é€‰æ‹©<code>Asia/Shanghai</code></p>
<pre><code>ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
hwclock --systohc # ç”Ÿæˆ/etc/adjtime
</code></pre>
<h3 id="ä½ç½®ä¿¡æ¯">ä½ç½®ä¿¡æ¯</h3>
<p>æˆ‘ä»¬éœ€è¦å¯¹Archç³»ç»Ÿçš„åœ°ç†ä½ç½®ä¿¡æ¯è¿›è¡Œæ›´æ”¹ï¼Œé€šå¸¸ä½¿ç”¨<code>en_US.UTF-8</code>ã€‚ä¿®æ”¹<code>/etc/locale.gen</code>å°†å«æœ‰<code>zh_CN.UTF-8 UTF-8</code>ã€<code>zh_HK.UTF-8 UTF-8</code>ã€<code>zh_TW.UTF-8 UTF-8</code>ã€<code>en_US.UTF-8 UTF-8</code>çš„å­—æ®µå»é™¤æ³¨é‡Šåä¿å­˜</p>
<p>è¿è¡Œä¸‹é¢çš„æŒ‡ä»¤é…ç½®åœ°ç†ä½ç½®æ–‡ä»¶</p>
<pre><code>locale-gen
</code></pre>
<p>éšååˆ›å»º<code>locale.conf</code>æ–‡ä»¶ï¼Œå¹¶é…ç½®<code>LANG</code>å˜é‡</p>
<pre><code># /etc/locale.conf
LANG=en_US.UTF-8
</code></pre>
<h3 id="ç½‘ç»œé…ç½®">ç½‘ç»œé…ç½®</h3>
<p>åˆ›å»º<code>hostname</code>æ–‡ä»¶ï¼Œå¡«å…¥ä½ æƒ³è¦çš„ä¸»æœºåç§°</p>
<pre><code># /etc/hostname
archlinux
</code></pre>
<p>ç„¶åæ‰“å¼€<code>hosts</code>æ–‡ä»¶ï¼Œå¡«å…¥ä»¥ä¸‹ä¿¡æ¯</p>
<pre><code># /etc/hosts
127.0.0.1   localhost
::1         localhost
127.0.1.1   archlinux.localdomain archlinux
</code></pre>
<p>å¦‚æœä¸»æœºæ‹¥æœ‰æ°¸ä¹…æ€§IPåœ°å€ï¼Œå¯ä»¥æ›¿æ¢<code>127.0.1.1</code></p>
<h3 id="é…ç½®rootå¯†ç ">é…ç½®Rootå¯†ç </h3>
<pre><code>passwd
</code></pre>
<h3 id="æ·»åŠ ç”¨æˆ·">æ·»åŠ ç”¨æˆ·</h3>
<p>ä¸€èˆ¬æ¥è¯´ä¸ä¼šä½¿ç”¨Rootç”¨æˆ·æ¥è¿è¡Œç³»ç»Ÿï¼Œå› ä¸ºæƒé™å¤ªé«˜äº†ï¼Œå› æ­¤éœ€è¦åˆ›å»ºä¸€ä¸ªæ™®é€šç”¨æˆ·æ¥ä½¿ç”¨Archlinux</p>
<p>å¯ä»¥é€šè¿‡<code>useradd</code>æ¥åˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼Œå¹¶é€šè¿‡<code>passwd</code>æ¥æ›´æ”¹å¯†ç </p>
<pre><code>useradd -m coder
passwd coder
</code></pre>
<p>åœ¨åˆ›å»ºå®Œç”¨æˆ·ä¹‹åï¼Œè¿˜éœ€è¦å°†ç”¨æˆ·æ·»åŠ åˆ°<code>wheel</code>ç”¨æˆ·ç»„ä¸­ï¼Œè¿™æ ·åç»­å°±èƒ½å¤Ÿä½¿ç”¨<code>sudo</code>æ¥è¿è¡Œè¾ƒé«˜æƒé™çš„æŒ‡ä»¤äº†</p>
<pre><code>usermod -aG wheel,audio,video,optical,storage coder
</code></pre>
<p>éšåï¼Œé€šè¿‡<code>visudo</code>ä¿®æ”¹æ–‡ä»¶ä¸­çš„ç”¨æˆ·ç»„éƒ¨åˆ†ï¼Œæ‰¾åˆ°<code>wheel</code>é‚£ä¸€è¡Œå¹¶åˆ é™¤æ³¨é‡Šï¼Œä¿å­˜é€€å‡º</p>
<pre><code>%wheel ALL=(ALL) ALL
</code></pre>
<h3 id="å®‰è£…intel-ucodeéintel-cpuè·³è¿‡">å®‰è£…Intel-ucode(éIntel CPUè·³è¿‡)</h3>
<p>è¿™ä¸ªåŒ…æ˜¯ç”¨æ¥ä¼˜åŒ–intelçš„ï¼Œå…¶ä»–cpuå¯ä»¥æŸ¥çœ‹wiki</p>
<pre><code>pacman -S intel-ucode
</code></pre>
<h3 id="å®‰è£…bootloader">å®‰è£…Bootloader</h3>
<p>è¿™é‡Œé€‰æ‹©å®‰è£…ç›®å‰æœ€ä¸ºæµè¡Œçš„<code>grub2</code>ï¼Œåœ¨å®‰è£…ä¹‹å‰å¯ä»¥å®‰è£…å¦å¤–ä¸¤ä¸ªåŒ…æ¥è‡ªåŠ¨è®¾ç½®å¯åŠ¨é€‰é¡¹</p>
<pre><code>pacman -S os-prober ntfs-3g
</code></pre>
<p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯BIOSå¼•å¯¼</p>
<ul>
<li>
<p>å®‰è£…grub</p>
<pre><code>  pacman -S grub
</code></pre>
</li>
<li>
<p>éƒ¨ç½²grub</p>
<pre><code>  grub-install --target=i386-pc /dev/sda
</code></pre>
</li>
<li>
<p>ç”Ÿæˆé…ç½®æ–‡ä»¶</p>
<pre><code>  grub-mkconfig -o /boot/grub/grub.cfg
</code></pre>
</li>
</ul>
<p>å¦‚æœä½ ä½¿ç”¨UEFIå¼•å¯¼</p>
<ul>
<li>
<p>å®‰è£…grubå’Œefibootmgrç­‰</p>
<pre><code>  pacman -S grub efibootmgr dosfstools mtools
</code></pre>
</li>
<li>
<p>æŒ‚è½½efiåˆ†åŒº</p>
<pre><code>  mkdir /boot/efi
  mount /dev/sda1(ä½ çš„efiåˆ†åŒº) /boot/efi
</code></pre>
</li>
<li>
<p>éƒ¨ç½²grub</p>
<pre><code>  grub-install --target=x86_64-efi --bootloader-id=grub_uefi --recheck
</code></pre>
</li>
<li>
<p>ç”Ÿæˆé…ç½®æ–‡ä»¶</p>
<pre><code>  grub-mkconfg -o /boot/grub/grub.cfg
</code></pre>
</li>
</ul>
<p>åˆ°æ­¤ä¸ºæ­¢ï¼ŒArchçš„å®‰è£…åŸºæœ¬å®Œæˆï¼Œ<code>exit</code>é€€å‡ºåï¼Œå…³æœºï¼Œæ‹”å‡ºå¼•å¯¼Uç›˜åé‡å¯å³å¯è¿›å…¥ç³»ç»Ÿ</p>
<h3 id="aur">AUR</h3>
<p>é™¤äº†pacmanä¹‹å¤–ï¼Œè¿˜æœ‰ç¬¬ä¸‰æ–¹è½¯ä»¶åŒ…<code>aur</code>å¯ä»¥ä¾›archç”¨æˆ·ä½¿ç”¨ï¼Œè¿™é‡Œä½¿ç”¨<a href="https://github.com/Jguer/yay">yay</a>å·¥å…·æ¥ä½¿ç”¨<code>aur</code></p>
<p>é¦–å…ˆä¸‹è½½<code>yay</code>çš„<code>PKGBUILD</code>æ–‡ä»¶</p>
<pre><code>sudo pacman -S git
git clone https://aur.archlinux.org/yay.git
cd yay
</code></pre>
<p>ç”±äºç½‘ç»œé—®é¢˜ï¼Œåœ¨<code>clone</code>å’Œç¼–è¯‘å®‰è£…<code>yay</code>æ—¶ä¼šéå¸¸ç¼“æ…¢ï¼Œè¿™é‡Œå¯ä»¥ä¿®æ”¹<code>PKGBUILD</code>æ–‡ä»¶å’Œè®¾ç½®ç¯å¢ƒå˜é‡æ¥è§£å†³</p>
<p>ä¿®æ”¹<code>PKGBUILD</code>æ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„<code>https://github.com/Jguer/yay</code>åœ°å€æ›¿æ¢ä¸º<code>https://hub.fastgit.org/Jguer/yay</code></p>
<p>ç„¶åæ‰§è¡Œå®‰è£…æŒ‡ä»¤</p>
<pre><code>GO111MODULE=on GOPROXY=https://goproxy.cn makepkg -si
# å¦‚æœä¸æƒ³ä¿ç•™golangåˆ™
# GO111MODULE=on GOPROXY=https://goproxy.cn makepkg -sir
</code></pre>
<p>å®‰è£…å®Œ<code>yay</code>åï¼Œæ·»åŠ å›½å†…aur<code>archlinuxcn</code>ã€‚ä¿®æ”¹<code>/etc/pacman.conf</code>æ–‡ä»¶ï¼Œåœ¨æœ€åæ·»åŠ </p>
<pre><code># /etc/pacman.conf
[archlinuxcn]
Server = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/$arch
</code></pre>
<p>ç„¶åæ›´æ–°è½¯ä»¶æºå¹¶å®‰è£…GPG key</p>
<pre><code>sudo pacman -Syy &amp;&amp; sudo pacman -S archlinuxcn-keyring
</code></pre>
<p>å¦‚æœé‡åˆ°ä¸‹è¿°é”™è¯¯</p>
<pre><code>ERROR: 5984EA8F3C could not be locally signed
</code></pre>
<p>å¯ä»¥é€šè¿‡æ¸…é™¤ç¼“å­˜æ¥è§£å†³</p>
<pre><code>sudo rm -rf /etc/pacman.d/gnupg
sudo pacman-key --init
sudo pacman-key --populate archlinux
</code></pre>
<h2 id="æ¡Œé¢ç¯å¢ƒ">æ¡Œé¢ç¯å¢ƒ</h2>
<h3 id="å›¾å½¢é©±åŠ¨">å›¾å½¢é©±åŠ¨</h3>
<p>æŒ‰ç…§<a href="https://wiki.archlinux.org/index.php/Xorg#Driver_installation">å®˜æ–¹Wiki</a>çš„è¡¨æ ¼è‡ªè¡Œé€‰æ‹©é©±åŠ¨å®‰è£…ï¼Œä¾‹å¦‚æœ¬äººæ˜¯Intelé›†æ˜¾ï¼Œåˆ™æ‰§è¡Œ</p>
<pre><code>sudo pacman -S xf86-xvideo-intel
</code></pre>
<p>å¯¹äºNividiaç‹¬æ˜¾é©±åŠ¨ï¼Œç”±äºæŸåŸå› å¹¶ä¸æ¨èå®‰è£…ï¼Œå¦‚æœè¦å®‰è£…åˆ™åœ¨ä¸Šè¿°é“¾æ¥ä¸­è‡ªè¡ŒæŸ¥è¯¢</p>
<h3 id="x11">X11</h3>
<p>å®‰è£…å®Œå›¾å½¢é©±åŠ¨åï¼Œå°±å¯ä»¥æ­£å¼å®‰è£…æ¡Œé¢ç¯å¢ƒäº†ï¼Œè¿™é‡Œé€‰æ‹©<code>X11</code>ï¼Œç›´æ¥åœ¨ç»ˆç«¯æ‰§è¡Œ</p>
<pre><code>sudo pacman -S xorg xorg-init
</code></pre>
<p>å®‰è£…å®Œä¹‹åï¼Œé€‰æ‹©ä¸€ä¸ªä½ å–œæ¬¢çš„æ¡Œé¢ä¾‹å¦‚<code>Xfce</code>ã€<code>KDE</code>ã€<code>Gnome</code>ç­‰ç­‰ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©çš„æ˜¯æ¡Œé¢ç®¡ç†å™¨<code>sway</code></p>
<pre><code>sudo pacman -S sway alacritty adobe-source-code-pro-fonts dmenu
</code></pre>
<p>å®‰è£…å®Œä¹‹åï¼Œéœ€è¦é…ç½®ä¸€ä¸‹<code>X11</code>çš„å¯åŠ¨é¡¹ï¼Œå°†åˆå§‹é…ç½®æ–‡ä»¶å¤åˆ¶åˆ°ç”¨æˆ·ç›®å½•ä¸­ï¼Œç„¶ååœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ <code>exec sway</code>çš„é€‰é¡¹</p>
<pre><code>cp /etc/X11/xinit/xinitrc $HOME/.xinitrc
</code></pre>
<p>æœ€ååœ¨ç»ˆç«¯ä¸­è¾“å…¥<code>startx</code>å³å¯è¿›å…¥<code>sway</code>æ¡Œé¢äº†ï¼Œè¾“å…¥<code>win+shift+enter</code>å³å¯æ‰“å¼€ç»ˆç«¯</p>
<p>å…·ä½“<code>sway</code>çš„é…ç½®ï¼Œå¯ä»¥ä»<code>etc/sway/config</code>ä¸­æŸ¥çœ‹ï¼Œå°†è¯¥æ–‡ä»¶å¤åˆ¶åˆ°<code>$HOME/.config/sway/config</code>å°±å¯ä»¥è‡ªè¡Œä¿®æ”¹é…ç½®<code>sway</code>äº†ï¼Œä¾‹å¦‚æ·»åŠ </p>
<pre><code>font pongo:SourceCodePro Medium 12
</code></pre>
<p>å³å¯ä¿®æ”¹<code>sway</code>æ¡Œé¢çš„å­—ä½“å’Œå¤§å°äº†</p>
<p>å¦‚æœæƒ³åœ¨ç™»å½•åè‡ªåŠ¨å¯åŠ¨æ¡Œé¢ï¼Œåˆ™å¯ä»¥åœ¨ç»ˆç«¯é…ç½®æ–‡ä»¶ä¸­å¦‚bashç»ˆç«¯çš„<code>.bash_profile</code>æˆ–zshçš„<code>.zshrc</code>ä¸­ï¼Œæ·»åŠ ä¸‹è¿°å†…å®¹å³å¯</p>
<pre><code>[[ $(fgconsole 2&gt;/dev/null)==1 ]] &amp;&amp; exec startx --vt1</code></pre>
]]></content></item><item><title>Hugo+Github Actionè‡ªåŠ¨éƒ¨ç½²é™æ€é¡µé¢</title><link>https://blog.thinkmoe.icu/posts/hugo+github-action%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E9%9D%99%E6%80%81%E9%A1%B5%E9%9D%A2/</link><pubDate>Sat, 22 May 2021 17:37:27 +0800</pubDate><guid>https://blog.thinkmoe.icu/posts/hugo+github-action%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E9%9D%99%E6%80%81%E9%A1%B5%E9%9D%A2/</guid><description>Hugo Hugo is one of the most popular open-source static site generators. With its amazing speed and flexibility, Hugo makes building websites fun again. å®‰è£… å¦‚æœä½ æ˜¯Windowsç”¨æˆ·ï¼Œå¯ä»¥ç›´æ¥ä»Github Releaseé¡µé¢ä¸‹è½½å¯¹åº”çš„ç‰ˆæœ¬å³å¯ å¦‚</description><content type="html"><![CDATA[<h2 id="hugohttpsgohugoio"><a href="https://gohugo.io/">Hugo</a></h2>
<blockquote>
<p>Hugo is one of the most popular open-source static site generators. With its amazing speed and flexibility, Hugo makes building websites fun again.</p>
</blockquote>
<h3 id="å®‰è£…">å®‰è£…</h3>
<p>å¦‚æœä½ æ˜¯Windowsç”¨æˆ·ï¼Œå¯ä»¥ç›´æ¥ä»<a href="https://github.com/gohugoio/hugo/releases">Github Release</a>é¡µé¢ä¸‹è½½å¯¹åº”çš„ç‰ˆæœ¬å³å¯</p>
<p>å¦‚æœä½ æ˜¯Linuxç”¨æˆ·åˆ™æœ‰ä¸‰ç§æ–¹å¼æ¥å®‰è£…Hugo</p>
<ul>
<li>ä»<a href="https://github.com/gohugoio/hugo/releases">Github Release</a>ä¸‹è½½</li>
<li>ä»åŒ…ç®¡ç†å™¨ä¸‹è½½</li>
<li>è‡ªè¡Œç¼–è¯‘</li>
</ul>
<p>åœ¨è¿™ä»‹ç»ä¸‹è‡ªè¡Œç¼–è¯‘ï¼Œæœ€æ–°çš„Hugoä½¿ç”¨åˆ°äº†<code>go1.16</code>çš„<code>io/fs</code>åŒ…ï¼Œå› æ­¤å¦‚æœæƒ³è‡ªè¡Œç¼–è¯‘æœ€æ–°ç‰ˆæœ¬çš„Hugoåˆ™è¦å®‰è£…æˆ–æ›´æ–°ç³»ç»Ÿ<code>go</code>ç‰ˆæœ¬è‡³<code>1.16+</code>ã€‚å®‰è£…å®Œè¯­è¨€ç¼–è¯‘ç¯å¢ƒåæŒ‰ä»¥ä¸‹æ­¥éª¤è¿›è¡Œ</p>
<pre><code>mkdir $HOME/src
cd $HOME/src
git clone https://github.com/gohugoio/hugo.git
cd hugo
go install
</code></pre>
<p>å¦‚æœä½ æƒ³è®©Hugoæ”¯æŒ<code>sass</code>çš„è¯åˆ™éœ€è¦ç¼–è¯‘å¦ä¸€ä¸ªç‰ˆæœ¬</p>
<pre><code>CGO_ENABLED=1 go install --tags extended
</code></pre>
<p>åœ¨ç»ˆç«¯ä¸­è¾“å…¥<code>hugo version</code>æ¥æ£€æŸ¥æ˜¯å¦ç¼–è¯‘æˆåŠŸ</p>
<h3 id="åˆ›å»ºç«™ç‚¹">åˆ›å»ºç«™ç‚¹</h3>
<p>å®‰è£…å®ŒHugoåå°±å¯ä»¥æ¥åˆ›å»ºä¸€ä¸ªç½‘ç«™ç«™ç‚¹ï¼Œå‡è®¾åç§°ä¸º<code>demo</code></p>
<pre><code>hugo new site demo
cd demo
git init
</code></pre>
<p>åœ¨åˆå§‹åŒ–ç«™ç‚¹åï¼Œéœ€è¦ä¸ºç«™ç‚¹é€‰æ‹©ä¸€ä¸ªä¸»é¢˜ï¼Œè¿™é‡Œé€‰æ‹©æˆ‘ä½¿ç”¨çš„<a href="https://github.com/Track3/hermit">Hermit</a></p>
<pre><code>git submodule add https://github.com/Track3/hermit.git themes/hermit
cp themes/hermit/exampleSite/config.toml .
</code></pre>
<p>éšååˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« </p>
<pre><code>hugo new posts/Hello-hugo.md
</code></pre>
<p>æ·»åŠ å®Œæ–‡ç« åè¾“å…¥ä»¥ä¸‹æŒ‡ä»¤è¿›è¡Œé¢„è§ˆ</p>
<pre><code>hugo server -D
</code></pre>
<p><img src="https://i.loli.net/2021/05/22/ULygZGTj8bPilw6.png" alt="é¢„è§ˆå›¾"></p>
<h2 id="github-actionè‡ªåŠ¨åŒ–å‘å¸ƒ">Github Actionè‡ªåŠ¨åŒ–å‘å¸ƒ</h2>
<p>å½“å®Œæˆä¸€ä¸ªç«™ç‚¹ä¹‹åï¼Œå¯ä»¥å‘å¸ƒåˆ°github pageä¸­ï¼Œåœ¨è¿™ä»‹ç»å¦‚ä½•ä½¿ç”¨Github Actionæ¥è‡ªåŠ¨åŒ–éƒ¨ç½²ç«™ç‚¹åˆ°github pageä¸­</p>
<p>Github Pageåˆ†ä¸ºç”¨æˆ·Pageå’Œé¡¹ç›®Pageï¼Œç”¨æˆ·Pageé€šå¸¸ä¸º<code>username.github.io</code>è€Œé¡¹ç›®Pageé€šå¸¸ä¸º<code>username.github.io/project</code>ï¼Œä½†ä¹Ÿå¯ä»¥é€šè¿‡æ·»åŠ <code>CNAME</code>æ–‡ä»¶æ¥è‡ªå®šä¹‰åŸŸåï¼Œåœ¨è¿™å±•ç¤ºé¡¹ç›®Page</p>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªé¡¹ç›®(<code>Repository</code>)ï¼Œå‡è®¾ä¸º<code>demo</code>è®°ä½è¦è®¾ç½®ä¸ºå…¬å¼€ï¼Œç„¶ååœ¨ä½ çš„ç«™ç‚¹çš„æ ¹ç›®å½•åˆ›å»ºä»¥ä¸‹æ–‡ä»¶å¹¶å†™å…¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="c"># .github/workflows/gh-pages.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">github pages</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">push</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">master </span><span class="w"> </span><span class="c"># è¦ç¼–è¯‘çš„æ–‡ä»¶åˆ†æ”¯</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">jobs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">deploy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-20.04</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/checkout@v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">submodules</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">  </span><span class="c"># Fetch Hugo themes (true OR recursive)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">fetch-depth</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">    </span><span class="c"># Fetch all history for .GitInfo and .Lastmod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Setup Hugo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">peaceiris/actions-hugo@v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">hugo-version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;latest&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">extended</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Build</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l">hugo --minify</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Deploy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">peaceiris/actions-gh-pages@v3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">github_token</span><span class="p">:</span><span class="w"> </span><span class="l">${{ secrets.GITHUB_TOKEN }}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">publish_dir</span><span class="p">:</span><span class="w"> </span><span class="l">./public</span><span class="w">
</span></span></span></code></pre></div><p>åœ¨éƒ¨ç½²åˆ°Githubä¹‹å‰ï¼Œè¿˜éœ€è¦æ›´æ”¹Hugoçš„æ ¹é…ç½®ï¼Œå°†<code>config.toml</code>ä¸­çš„<code>baseURL</code>æ›´æ”¹ä¸º<code>https://{username}.github.io/demo</code>ï¼Œå¦‚æœé…ç½®äº†åŸŸååˆ™ä¸º<code>https://{CUSTOM_DOMAIN}/demo</code></p>
<p>éšåï¼Œå°†ä½ çš„ç«™ç‚¹æ‰€æœ‰æ–‡ä»¶pushåˆ°Githubä¸­</p>
<pre><code>git remote add origin https://github.com/{your_user_name}/{your_project}.git
git add .
git commit -m &quot;Upload&quot;
git push -u origin master
</code></pre>
<p>è¿™æ—¶ï¼Œå‰å¾€ä½ çš„é¡¹ç›®é¡µé¢æŸ¥çœ‹<code>Actions</code>æ ‡ç­¾æŸ¥çœ‹ç¼–è¯‘ç»“æœï¼Œå¦‚æœæˆåŠŸåˆ™å¦‚ä¸‹æ‰€ç¤º</p>
<p><img src="https://i.loli.net/2021/05/22/bwJztQ7qr9k2PnM.png" alt="Action"></p>
<p>å®Œæˆç¼–è¯‘ä¹‹åï¼Œè¿˜ä¸èƒ½ç«‹åˆ»é€šè¿‡ç½‘å€æ¥è®¿é—®ï¼Œéœ€è¦åœ¨é¡¹ç›®çš„<code>Settings\Pages</code>ä¸­ï¼Œé€‰æ‹©Github Pageçš„æ¥æºï¼Œåœ¨è¿™é€‰æ‹©<code>gh-pages</code></p>
<p>è®¾ç½®æˆåŠŸåè®¿é—®<code>https://{username}.github.com/{project_name}</code>å³å¯ï¼Œå¦‚æœé…ç½®äº†<code>CNAME</code>åˆ™é€šè¿‡<code>https://{CUSTOM_DOMAIN}/{project_name}</code>å³å¯</p>
<p><img src="https://i.loli.net/2021/05/22/Z6gRYaLcfUbpByx.png" alt="ç»“æœ"></p>
]]></content></item><item><title>TCPå’ŒHTTPå’ŒHTTPS</title><link>https://blog.thinkmoe.icu/posts/tcp%E5%92%8Chttp%E5%92%8Chttps/</link><pubDate>Wed, 24 Feb 2021 21:49:01 +0800</pubDate><guid>https://blog.thinkmoe.icu/posts/tcp%E5%92%8Chttp%E5%92%8Chttps/</guid><description>æœ¬æ–‡ä¸»è¦ä»‹ç»ä¸€ä¸‹TCPå’ŒHTTP&amp;amp;HTTPSä¹‹é—´çš„å…³ç³» TCP TCPæ˜¯ä¼ è¾“å±‚ä¸Šçš„é¢å‘è¿æ¥çš„å¯é ä¼ è¾“åè®® ä¸‰æ¬¡æ¡æ‰‹ TCPçš„è¿æ¥é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹æ¥å®Œ</description><content type="html"><![CDATA[<blockquote>
<p>æœ¬æ–‡ä¸»è¦ä»‹ç»ä¸€ä¸‹TCPå’ŒHTTP&amp;HTTPSä¹‹é—´çš„å…³ç³»</p>
</blockquote>
<h1 id="tcp">TCP</h1>
<p>TCPæ˜¯ä¼ è¾“å±‚ä¸Šçš„é¢å‘è¿æ¥çš„å¯é ä¼ è¾“åè®®</p>
<h2 id="ä¸‰æ¬¡æ¡æ‰‹">ä¸‰æ¬¡æ¡æ‰‹</h2>
<ol>
<li>TCPçš„è¿æ¥é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹æ¥å®Œæˆï¼Œç¬¬ä¸€æ¬¡æ¡æ‰‹ç”±å®¢æˆ·ç«¯å‘èµ·ï¼Œå®¢æˆ·ç«¯è®¾ç½®æ•°æ®åŒ…ä¸­SYNå­—æ®µä¸º1ï¼ŒACKå­—æ®µä¸º1å¹¶éšæœºé€‰å–ä¸€ä¸ªå€¼xä½œä¸ºè¯¥æ•°æ®åŒ…çš„seqå‘é€ç»™æœåŠ¡å™¨å¹¶è°ƒæ•´å½“å‰çŠ¶æ€ä¸ºSYN_SEND</li>
<li>æœåŠ¡å™¨åœ¨æ¥å—åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„SYN=1çš„æ•°æ®åŒ…åçŸ¥é“è¦å¼€å§‹å»ºç«‹è¿æ¥ï¼Œäºæ˜¯æœåŠ¡å™¨è®¾ç½®SYNå­—æ®µä¸º1ï¼ŒACKä¸º1ï¼Œéšæœºé€‰å–ä¸€ä¸ªå€¼yä½œä¸ºè¯¥åŒ…çš„seqå¹¶è®¾ç½®ä¸‹ä¸€ä¸ªå¸Œæœ›å¾—åˆ°çš„æ•°æ®åŒ…åºåˆ—å·ä¸ºx+1æœ€åå‘é€ç»™å®¢æˆ·ç«¯å¹¶è°ƒæ•´å½“å‰è½¬å°ä¸ºSYN_RECIVE</li>
<li>å®¢æˆ·ç«¯åœ¨æ”¶åˆ°ç¬¬äºŒä¸ªæ¡æ‰‹åŒ…åå¯ä»¥ç¡®å®šæœåŠ¡ç«¯ä¸è‡ªå·±çš„è¿æ¥æ˜¯äº’é€šçš„ï¼Œäºæ˜¯è®¾ç½®æ•°æ®åŒ…çš„ACKå­—æ®µä¸º1ï¼Œseqä¸ºx+1å¹¶è®¾ç½®å¸Œæœ›ä¸‹ä¸€ä¸ªæ¥è‡ªæœåŠ¡ç«¯çš„æ•°æ®åŒ…çš„åºåˆ—å·ä¸ºy+1å‘é€ç»™æœåŠ¡ç«¯æœåŠ¡ç«¯åœ¨æ¥å—åˆ°ç¬¬ä¸‰ä¸ªæ¡æ‰‹åŒ…åå¯ä»¥ç¡®å®šå®¢æˆ·ç«¯ä¸è‡ªå·±çš„è¿æ¥æ˜¯äº’é€šçš„ï¼Œç”±æ­¤å¯ä»¥ç¡®ä¿æ•°æ®çš„ä¼ è¾“</li>
</ol>
<h2 id="å››æ¬¡æŒ¥æ‰‹">å››æ¬¡æŒ¥æ‰‹</h2>
<p>TCPçš„æ–­å¼€è¿æ¥å¯ä»¥ç”±å®¢æˆ·ç«¯æˆ–æœåŠ¡ç«¯å‘èµ·ï¼Œè®¾å‘èµ·çš„ä¸€æ–¹ä¸ºå®¢æˆ·ç«¯</p>
<ol>
<li>å®¢æˆ·ç«¯è®¾ç½®æ•°æ®åŒ…çš„FINå­—æ®µä¸º1ï¼Œå‡è®¾å½“å‰seqä¸ºuå‘é€è¯¥åŒ…ä¹‹åå®¢æˆ·ç«¯è°ƒæ•´çŠ¶æ€ä¸ºFIN_WAIT1</li>
<li>æœåŠ¡ç«¯åœ¨æ”¶åˆ°FINçš„æ•°æ®åŒ…åè°ƒæ•´çŠ¶æ€ä¸ºCLOSE_WAITå¹¶è®¾ç½®æ•°æ®åŒ…çš„ACKä¸º1ï¼Œackä¸ºu+1,seqä¸ºw</li>
<li>å®¢æˆ·ç«¯åœ¨æ”¶åˆ°æœåŠ¡ç«¯çš„ACKåŒ…åè¿›å…¥FIN_WAIT2çŠ¶æ€ï¼ŒæŒç»­ç­‰å¾…ï¼›æœåŠ¡ç«¯åœ¨å‘é€å®ŒACKåŒ…åä¸ä¼šç«‹åˆ»æ–­å¼€è¿æ¥ï¼Œè€Œæ˜¯ä¼šç­‰å¾…æœåŠ¡ç«¯æ‰€æœ‰æ•°æ®å…¨éƒ¨ä¼ è¾“å®Œæˆä¹‹ååœ¨å‘å®¢æˆ·ç«¯å‘èµ·ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼Œå…¶FINä¸º1ï¼ŒACKä¸º1ï¼Œseqä¸ºvï¼Œackä¸ºu+1</li>
<li>å®¢æˆ·ç«¯åœ¨æ”¶åˆ°è¯¥FINåè¿›å…¥TIME_WAITçŠ¶æ€å¹¶å‘æœåŠ¡ç«¯å‘é€ACK=1ï¼Œseqä¸ºu+1ï¼Œack=v+1çš„æ•°æ®åŒ…é€šçŸ¥æœåŠ¡ç«¯å…³é—­è¿æ¥ï¼ŒæœåŠ¡ç«¯åœ¨æ”¶åˆ°åä¼šç«‹åˆ»å…³é—­è¿æ¥è€Œå®¢æˆ·ç«¯åˆ™ä¼šç­‰å¾…2</li>
</ol>
<h2 id="å¦‚æœå®¢æˆ·ç«¯å‡ºç°æ•…éšœä¼šå¦‚ä½•">å¦‚æœå®¢æˆ·ç«¯å‡ºç°æ•…éšœä¼šå¦‚ä½•</h2>
<p>æœåŠ¡ç«¯ä¼šåœ¨ä¸å®¢æˆ·ç«¯è¿æ¥ä¹‹åè®¾ç½®ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œå½“å®¢æˆ·ç«¯å‡ºç°æ•…éšœï¼ŒæœåŠ¡ç«¯ä¸å¯èƒ½ä¸€ç›´ç­‰å¾…ä¸‹å»ï¼Œè®¡æ—¶å™¨ä¼šåœ¨å»ºç«‹æ—¶å¼€å§‹åŠæ—¶ï¼Œé€šå¸¸ä¸º2ä¸ªæ¶ˆå¤±ï¼Œæ¯ä¸€æ¬¡æ”¶åˆ°å®¢æˆ·ç«¯è¿æ¥ä¹‹åéƒ½ä¼šé‡ç½®è®¡æ—¶å™¨ã€‚å½“è®¡æ—¶å™¨ç»“æŸä¹‹åæœåŠ¡ç«¯å¯ä»¥è®¤ä¸ºå®¢æˆ·ç«¯å‡ºç°æ•…éšœæˆ–ä¸å†éœ€è¦æ•°æ®ï¼Œæ­¤æ—¶å°±å…³é—­è¿æ¥</p>
<h1 id="http">HTTP</h1>
<p>HTTPæ˜¯ä¸€ç§æ˜æ–‡ä¼ è¾“çš„è¶…æ–‡æœ¬ä¼ è¾“åè®®</p>
<p>ç”±äºå…¶æ˜¯æ˜æ–‡çš„å› æ­¤éå¸¸çš„ä¸å®‰å…¨ï¼Œç”±æ­¤è¯ç”Ÿäº†HTTPS</p>
<h1 id="https">HTTPS</h1>
<p>HTTPSæ˜¯å»ºç«‹åœ¨HTTPä¹‹ä¸Šçš„ï¼Œå…¶åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­åŠ ä¸Šäº†ä¸€å±‚SSL/TLSç”¨äºç»™æ–‡æœ¬åŠ å¯†</p>
<p>HTTPSçš„åŠ å¯†è§£å¯†åŒæ—¶ä½¿ç”¨äº†å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ï¼Œç”±äºéå¯¹ç§°åŠ å¯†çš„æ€§èƒ½è¦æ¯”å¯¹ç§°åŠ å¯†ä½ï¼Œå› æ­¤HTTPSä¼šåœ¨äº¤æ¢å¯¹ç§°åŠ å¯†å¯†é’¥æ—¶è¿›è¡Œéå¯¹ç§°åŠ å¯†ä¼ è¾“ï¼Œé˜²æ­¢è¢«ä¸­é—´äººçŒœå‡ºã€‚ç„¶åå†æ ¹æ®å¾—åˆ°çš„å¯†é’¥æ–‡ä»¶å¯¹è¦ä¼ è¾“çš„å†…å®¹è¿›è¡Œå¯¹ç§°åŠ å¯†</p>
<h2 id="è®¤è¯é—®é¢˜">è®¤è¯é—®é¢˜</h2>
<p>åœ¨HTTPSä¸­ï¼Œæ¯ä¸€ä¸ªè¿æ¥éƒ½ä¼šåœ¨å…¶å¤´éƒ¨æ·»åŠ æ•°å­—ç­¾åï¼Œç”Ÿæˆæ•°å­—ç­¾åçš„å¯†é’¥ç”±CAå‘æ”¾</p>
<p>æœåŠ¡ç«¯æŠ¥æ–‡ç»è¿‡HASHå¤„ç†åç”Ÿæˆæ‘˜è¦ä¿¡æ¯ï¼Œæ‘˜è¦ä¿¡æ¯ä½¿ç”¨ç§é’¥åŠ å¯†ç”Ÿæˆç­¾åï¼ŒéšåŒæŠ¥æ–‡ä¸€èµ·å‘é€ç»™å®¢æˆ·ç«¯</p>
<p>å®¢æˆ·ç«¯æ¥å—åå°†ç­¾åæå–å‡ºæ¥å¹¶ç”¨å…¬é’¥è¿›è¡Œè§£å¯†ï¼Œå¦‚æœèƒ½æ­£ç¡®è§£å¯†åˆ™è¯´æ˜è¯¥æŠ¥æ–‡æ˜¯æ¥è‡ªæœåŠ¡ç«¯çš„</p>
<h2 id="æ•°æ®å®Œæ•´æ€§">æ•°æ®å®Œæ•´æ€§</h2>
<p>åœ¨è§£å†³è®¤è¯é—®é¢˜åå°±è¦è§£å†³æ•°æ®å®Œæ•´æ€§çš„é—®é¢˜ï¼Œè€Œè¿™ä¸ªé—®é¢˜å°±ä¼šä½¿ç”¨ä¸Šè¿°çš„æ‘˜è¦ä¿¡æ¯è¿›è¡Œå®Œæˆ</p>
<p>å®¢æˆ·ç«¯åœ¨å¯¹æ‘˜è¦è¿›è¡Œè§£å¯†åä¼šå¾—åˆ°è¯¥æŠ¥æ–‡çš„Hashæ‘˜è¦ï¼Œå®¢æˆ·ç«¯åªéœ€è¦é€šè¿‡æŠŠæŠ¥æ–‡ä¸­çš„æ•°æ®æå–å‡ºæ¥è¿›è¡Œç›¸åŒçš„Hashæ“ä½œå¾—åˆ°å¦ä¸€ä»½æ‘˜è¦åä¸å‰ä¸€ä»½è¿›è¡Œå¯¹æ¯”å°±èƒ½åˆ¤æ–­ä¼ è¾“çš„æ•°æ®æ˜¯å¦å®Œæ•´äº†</p>
<p>è€ŒHashç®—æ³•ç­‰ç›¸å…³ä¿¡æ¯éƒ½ä¼šåœ¨è¯ä¹¦äº¤æ¢ä¸­è¿›è¡Œä¼ é€</p>
<h2 id="å·¥ä½œæµç¨‹">å·¥ä½œæµç¨‹</h2>
<ol>
<li>Client Hello<br>
å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€Client Helloæ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯åŒ…å«å®¢æˆ·ç«¯ç”Ÿæˆçš„éšæœºæ•°Random1ã€å®¢æˆ·ç«¯æ”¯æŒçš„åŠ å¯†å¥—ä»¶å’ŒSSLç‰ˆæœ¬ä¿¡æ¯ç­‰</li>
<li>Server Hello<br>
æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€Server Helloæ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯ä¼šä»Client Helloä¸­ç¡®å®šä¸€ä»½åŠ å¯†å¥—ä»¶ï¼Œè¯¥å¥—ä»¶å†³å®šäº†åç»­åŠ å¯†å’Œç”Ÿæˆæ‘˜è¦æ‰€éœ€ä½¿ç”¨çš„é›†ä½“ç®—æ³•ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜ä¼šç”Ÿæˆä¸€ä¸ªéšæœºæ•°Random2</li>
<li>Certificate<br>
æœåŠ¡ç«¯ä¸‹å‘è¯ä¹¦ç»™å®¢æˆ·ç«¯ï¼Œè®©å®¢æˆ·ç«¯éªŒè¯è‡ªå·±çš„èº«ä»½ï¼Œå®¢æˆ·ç«¯éªŒè¯é€šè¿‡åå–å‡ºå…¬é’¥</li>
<li>Certificate Verify
å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„è¯ä¹¦åå…ˆä»CAéªŒè¯è¯ä¹¦åˆæ³•æ€§ï¼Œæå–è¯ä¹¦ä¸­çš„å…¬é’¥å¹¶ç”Ÿæˆéšæœºæ•°Random3ï¼Œå†ç”¨åˆšåˆšæå–çš„å…¬é’¥å¯¹éšæœºæ•°åŠ å¯†ç”ŸæˆPreMasterKeyå‘é€ç»™æœåŠ¡ç«¯</li>
<li>Client Key Exchange
æœåŠ¡ç«¯é€šè¿‡ç§é’¥è§£å¯†å¾—åˆ°Random3ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯æœåŠ¡ç«¯å‡åŒ…å«ä¸‰ä¸ªéšæœºæ•°ï¼ŒåŒæ–¹æ ¹æ®ä¹‹å‰åå®šçš„ç®—æ³•ç”Ÿæˆä¸€ä»½å¯†é’¥ï¼Œåœ¨æ¡æ‰‹ç»“æŸåçš„æ•°æ®ä¼ è¾“å‡ä½¿ç”¨è¯¥å¯†é’¥è¿›è¡Œå¯¹ç§°åŠ å¯†</li>
<li>EncryptedHandshakeMessage
å®¢æˆ·ç«¯å°†å‰é¢çš„æ¡æ‰‹æ¶ˆæ¯ç”Ÿæˆæ‘˜è¦å†ç”¨åå•†å¥½çš„å¯†é’¥åŠ å¯†å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ç”¨å¯†é’¥è§£å¯†å¦‚æœèƒ½å¤Ÿè§£å‡ºåˆ™è¯´æ˜å¯†é’¥ä¸€è‡´</li>
<li>Change Cipher Spec
æœåŠ¡ç«¯é€šçŸ¥å®¢æˆ·ç«¯åç»­æ¶ˆæ¯å‡ä½¿ç”¨åŠ å¯†</li>
<li>Encrypted Handshake Message
æœåŠ¡ç«¯å°†æ¡æ‰‹æ¶ˆæ¯ç”Ÿæˆæ‘˜è¦åŠ å¯†å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ¥å—åè§£å¯†ï¼ŒæˆåŠŸåˆ™è¯´æ˜ä¸€è‡´</li>
<li>Application data
æ­¤æ—¶åŒæ–¹å·²å®‰å…¨åå•†å¯†é’¥ï¼Œè‡³æ­¤åç»­æ‰€æœ‰åº”ç”¨å±‚æ•°æ®éƒ½å°†ä½¿ç”¨è¯¥å¯†é’¥è¿›è¡ŒåŠ å¯†åé€šè¿‡TCPè¿›è¡Œä¼ è¾“</li>
</ol>
<h2 id="tlsç‰ˆæœ¬åŒºåˆ«">TLSç‰ˆæœ¬åŒºåˆ«</h2>
<ol>
<li>åœ¨1.0å’Œ1.1è®¡ç®—FinishæŠ¥æ–‡æ—¶ï¼Œè¿›è¡Œçš„æ˜¯md5+sha1ç»„åˆè¿è¡Œè€Œ1.2ä¸‹å˜æˆäº†å•æ¬¡sha1</li>
<li>åœ¨è¯ä¹¦æ ¡éªŒä¸­ï¼Œ1.0å’Œ1.1ä¼šå¯¹æ¡æ‰‹ä¿¡æ¯ä½¿ç”¨md5+sha1è¿›è¡Œæ‘˜è¦è¿ç®—(å¯¹äºECCè¯ä¹¦åªåšSHA1è®¡ç®—)ï¼Œåœ¨1.2ä¸‹éªŒè¯æŠ¥æ–‡å¤šå‡ºä¸¤ä¸ªå­—èŠ‚hash_algå’Œsign_algï¼Œå‡å¦‚åŠ å¯†å¥—ä»¶å­˜åœ¨SHA384åˆ™ä½¿ç”¨SHA384è¿›è¡ŒåŠ å¯†</li>
</ol>
<h2 id="rtté—®é¢˜">RTTé—®é¢˜</h2>
<p>ç”±äºHTTPSæ˜¯å»ºç«‹åœ¨HTTPä¹‹ä¸Šçš„ï¼Œè€ŒHTTPæ˜¯é€šè¿‡TCPå®ç°çš„ï¼Œå› æ­¤HTTPSçš„å»ºç«‹ä¹Ÿéœ€è¦ç»å†TCPçš„3æ¬¡æ¡æ‰‹ä½†è¿œè¿œä¸å¤Ÿ</p>
<p>è¿™æ˜¯å› ä¸ºHTTPSé™¤äº†éœ€è¦äº¤æ¢è¿æ¥ä¿¡æ¯è¿˜éœ€è¦äº¤æ¢è¯ä¹¦æ–‡ä»¶ï¼Œä¿è¯æ•°æ®å®Œæ•´æ€§ç­‰ç­‰å†…å®¹ï¼Œè¿™ä¼šéœ€è¦å¢åŠ è¿æ¥çš„æ•°é‡</p>
<p>å®é™…ä¸ŠHTTPSä¼šæ¯”HTTPå¤š7ä¸ªRTTï¼Œé¦–å…ˆ3ä¸ªæ¡æ‰‹RTTï¼Œç„¶åè·³è½¬HTTPS1ä¸ªRTTï¼Œå†TCPè¿æ¥443ç«¯å£3ä¸ªRTTï¼Œç„¶åå¼€å§‹å®ŒæˆåŠ å¯†å¥—ä»¶çš„åå•†å’Œè¯ä¹¦èº«ä»½ç¡®è®¤ã€‚åœ¨æµè§ˆå™¨è·å–åˆ°è¯ä¹¦åä¹Ÿä¼šéªŒè¯è¯ä¹¦çš„æœ‰æ•ˆæ€§å¹¶è·å–CAåŸŸåï¼Œè§£æCAæˆåŠŸåä¸CAæ¡æ‰‹å¹¶è¿›è¡ŒOCSPè¯·æ±‚ç¡®è®¤è¯ä¹¦çŠ¶æ€</p>
<h2 id="æ¡æ‰‹ä¼˜åŒ–">æ¡æ‰‹ä¼˜åŒ–</h2>
<p>ç”±äºHTTPSä¼šæ¯”HTTPå¤šå¾ˆå¤šRTTï¼Œå› æ­¤å‡å¦‚åœ¨åŒä¸€æ—¶åˆ»å¤§é‡è¯·æ±‚ä¼šå¯¼è‡´æœåŠ¡ç«¯æ‰¿å—ä¸ä½å› æ­¤éœ€è¦å¯¹æ¡æ‰‹è¿›è¡Œä¼˜åŒ–</p>
<ol>
<li>Session id<br>
è¿™ä¸ªæ–¹æ³•çš„å®ç°æ”¾åœ¨æœåŠ¡ç«¯ï¼Œåœ¨å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯åä¼šå¯¹å®¢æˆ·ç«¯ç”Ÿæˆä¸€ä¸ªsession idï¼Œä¿å­˜ä¸è¯¥å®¢æˆ·ç«¯çš„åå•†ä¿¡æ¯ï¼Œåœ¨åç»­å†æ”¶åˆ°è¯¥å®¢æˆ·ç«¯è¿æ¥æ—¶å¯ä»¥ç›´æ¥é€šè¿‡session idæ¥è·å–åå•†ä¿¡æ¯ç›´æ¥å¼€å§‹æ•°æ®ä¼ è¾“</li>
<li>Session Ticket<br>
Session idåœ¨è´Ÿè½½å‡è¡¡ä¼šå‡ºç°é—®é¢˜ï¼Œè€ŒTicketçš„æ–¹æ³•åˆ™ä¸ä¼šå› ä¸ºä»–ä¸»è¦æ˜¯ç°åœ¨å®¢æˆ·ç«¯éœ€è¦æµè§ˆå™¨æ”¯æŒï¼Œticketæ˜¯åªæœ‰æœåŠ¡ç«¯çŸ¥é“çš„å®‰å…¨å¯†é’¥åŠ å¯†è¿‡çš„ä¼šè¯ä¿¡æ¯ï¼Œæµè§ˆå™¨åœ¨Helloæ—¶å¸¦ä¸ŠticketæœåŠ¡ç«¯å°±èƒ½æˆåŠŸè§£å¯†è¿›è¡Œå¿«é€Ÿæ¡æ‰‹</li>
</ol>
<h2 id="certificate-chain">Certificate Chain</h2>
<p>TLSçš„èº«ä»½è®¤è¯æ˜¯é€šè¿‡è¯ä¹¦ä¿¡ä»»é“¾å®Œæˆçš„ï¼Œæµè§ˆå™¨ä»ç«™ç‚¹è¯ä¹¦å¼€å§‹é€’å½’æ ¡éªŒçˆ¶è¯ä¹¦ï¼Œç›´è‡³å‡ºç°æ ¹è¯ä¹¦</p>
]]></content></item><item><title>Webç”¨æˆ·è®¤è¯æ–¹æ³•å¯¹æ¯”</title><link>https://blog.thinkmoe.icu/posts/web%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81%E6%96%B9%E6%B3%95%E5%AF%B9%E6%AF%94/</link><pubDate>Fri, 08 Jan 2021 21:33:13 +0000</pubDate><guid>https://blog.thinkmoe.icu/posts/web%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81%E6%96%B9%E6%B3%95%E5%AF%B9%E6%AF%94/</guid><description>&lt;blockquote>
&lt;p>æœ¬æ–‡ç¿»è¯‘è‡ª&lt;a href="https://testdriven.io/blog/web-authentication-methods/#authentication-vs-authorization">testdriven.io&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;p>åœ¨è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°†ä»ä¸€åPythonå¼€å‘è€…çš„è§†è§’æ¥è§‚å¯Ÿç›®å‰æœ€å¸¸è§çš„å‡ ç§å¤„ç†Webè®¤è¯çš„æ–¹å¼&lt;/p>
&lt;blockquote>
&lt;p>å°½ç®¡æœ¬ç‰‡æ–‡ç« æ‰€æœ‰çš„ä»£ç æ˜¯é¢å‘Pythonå¼€å‘è€…çš„ï¼Œä½†æ˜¯å®é™…ä¸Šå¯¹æ‰€æœ‰çš„Webå¼€å‘è€…ï¼Œæ¯ç§è®¤è¯æ–¹æ³•å®é™…ä¸Šéƒ½æ˜¯å·®ä¸å¤šçš„&lt;/p>
&lt;/blockquote>
&lt;h1 id="è®¤è¯vsæˆæƒauthentication-vs-authorization">è®¤è¯vsæˆæƒ(Authentication vs Authorization)&lt;/h1>
&lt;p>è®¤è¯æ˜¯ä¸€ç§å¤„ç†ç”¨æˆ·æˆ–è®¾å¤‡å°è¯•é€šè¿‡å‡­è¯æ¥è®¿é—®å—é™ç³»ç»Ÿçš„è¿‡ç¨‹ã€‚è€Œæˆæƒåˆ™æ˜¯éªŒè¯ç”¨æˆ·æˆ–è®¾å¤‡æ˜¯å¦æœ‰æƒé™æ¥è®¿é—®ç³»ç»Ÿæä¾›çš„ç¡®åˆ‡æœåŠ¡&lt;/p>
&lt;p>ç®€å•æ¥è®²å°±æ˜¯&lt;/p>
&lt;ul>
&lt;li>è®¤è¯ï¼šä½ æ˜¯è°ï¼Ÿ&lt;/li>
&lt;li>æˆæƒï¼šä½ å¯ä»¥åšä»€ä¹ˆï¼Ÿ&lt;/li>
&lt;/ul>
&lt;p>è®¤è¯æ¯”æˆæƒå‡ºç°çš„æ›´æ—©ï¼Œç”¨æˆ·å¿…é¡»åœ¨è·å¾—è®¿é—®èµ„æºæƒé™ä¹‹å‰ç»è¿‡åˆæ³•éªŒè¯ã€‚æœ€å¸¸è§çš„ç”¨æˆ·è®¤è¯æ–¹æ³•å°±æ˜¯&lt;code>username&lt;/code>å’Œ&lt;code>password&lt;/code>ã€‚ä¸€æ—¦è®¤è¯å®Œæˆï¼Œä¸åŒèº«ä»½ä¾‹å¦‚&lt;code>admin&lt;/code>ã€&lt;code>moderator&lt;/code>ç­‰ç­‰ï¼Œéƒ½å°†è¢«é™„åŠ åœ¨ç”¨æˆ·èº«ä¸Šç”¨äºæä¾›è®¿é—®ç³»ç»Ÿçš„èº«ä»½ä¿¡æ¯ã€‚&lt;/p>
&lt;p>æœ‰äº†ä¸Šè¿°çš„è§£é‡Šï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹éªŒè¯ç”¨æˆ·çš„ä¸åŒæ–¹æ³•å§&lt;/p></description><content type="html"><![CDATA[<blockquote>
<p>æœ¬æ–‡ç¿»è¯‘è‡ª<a href="https://testdriven.io/blog/web-authentication-methods/#authentication-vs-authorization">testdriven.io</a></p>
</blockquote>
<p>åœ¨è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°†ä»ä¸€åPythonå¼€å‘è€…çš„è§†è§’æ¥è§‚å¯Ÿç›®å‰æœ€å¸¸è§çš„å‡ ç§å¤„ç†Webè®¤è¯çš„æ–¹å¼</p>
<blockquote>
<p>å°½ç®¡æœ¬ç‰‡æ–‡ç« æ‰€æœ‰çš„ä»£ç æ˜¯é¢å‘Pythonå¼€å‘è€…çš„ï¼Œä½†æ˜¯å®é™…ä¸Šå¯¹æ‰€æœ‰çš„Webå¼€å‘è€…ï¼Œæ¯ç§è®¤è¯æ–¹æ³•å®é™…ä¸Šéƒ½æ˜¯å·®ä¸å¤šçš„</p>
</blockquote>
<h1 id="è®¤è¯vsæˆæƒauthentication-vs-authorization">è®¤è¯vsæˆæƒ(Authentication vs Authorization)</h1>
<p>è®¤è¯æ˜¯ä¸€ç§å¤„ç†ç”¨æˆ·æˆ–è®¾å¤‡å°è¯•é€šè¿‡å‡­è¯æ¥è®¿é—®å—é™ç³»ç»Ÿçš„è¿‡ç¨‹ã€‚è€Œæˆæƒåˆ™æ˜¯éªŒè¯ç”¨æˆ·æˆ–è®¾å¤‡æ˜¯å¦æœ‰æƒé™æ¥è®¿é—®ç³»ç»Ÿæä¾›çš„ç¡®åˆ‡æœåŠ¡</p>
<p>ç®€å•æ¥è®²å°±æ˜¯</p>
<ul>
<li>è®¤è¯ï¼šä½ æ˜¯è°ï¼Ÿ</li>
<li>æˆæƒï¼šä½ å¯ä»¥åšä»€ä¹ˆï¼Ÿ</li>
</ul>
<p>è®¤è¯æ¯”æˆæƒå‡ºç°çš„æ›´æ—©ï¼Œç”¨æˆ·å¿…é¡»åœ¨è·å¾—è®¿é—®èµ„æºæƒé™ä¹‹å‰ç»è¿‡åˆæ³•éªŒè¯ã€‚æœ€å¸¸è§çš„ç”¨æˆ·è®¤è¯æ–¹æ³•å°±æ˜¯<code>username</code>å’Œ<code>password</code>ã€‚ä¸€æ—¦è®¤è¯å®Œæˆï¼Œä¸åŒèº«ä»½ä¾‹å¦‚<code>admin</code>ã€<code>moderator</code>ç­‰ç­‰ï¼Œéƒ½å°†è¢«é™„åŠ åœ¨ç”¨æˆ·èº«ä¸Šç”¨äºæä¾›è®¿é—®ç³»ç»Ÿçš„èº«ä»½ä¿¡æ¯ã€‚</p>
<p>æœ‰äº†ä¸Šè¿°çš„è§£é‡Šï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹éªŒè¯ç”¨æˆ·çš„ä¸åŒæ–¹æ³•å§</p>
<h1 id="httpåŸºæœ¬è®¤è¯http-basic-authentication">HTTPåŸºæœ¬è®¤è¯(HTTP Basic Authentication)</h1>
<p>åŸºæœ¬è®¤è¯æ˜¯ä¸€ç§å»ºç«‹åœ¨HTTPåè®®ä¸Šçš„æœ€åŸºç¡€çš„éªŒè¯æ–¹å¼ã€‚åœ¨åŸºæœ¬è®¤è¯ä¸­ï¼Œæ¯ä¸€ä¸ªè¯·æ±‚<code>Header</code>éƒ½è¦æºå¸¦ç™»å½•å‡­è¯ä¿¡æ¯</p>
<pre tabindex="0"><code>&#34;Authorization: Basic dXNlcm5hbWU6cGFzc3dvcmQ=&#34; your-website.com
</code></pre><p>ç”¨æˆ·åå’Œå¯†ç éƒ½æ²¡æœ‰è¢«åŠ å¯†ï¼Œå¹¶ä¸”ç”¨æˆ·åå’Œå¯†ç é€šè¿‡<code>:</code>ç»„åˆåœ¨ä¸€èµ·<code>username:password</code>ã€‚è¿™ä¸ªå­—ç¬¦ä¸²é€šå¸¸éœ€è¦é€šè¿‡<code>Base64</code>ç¼–ç ç”Ÿæˆ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">auth</span> <span class="o">=</span> <span class="s2">&#34;username:password&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">auth_bytes</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span> <span class="c1"># convert to bytes</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">auth_bytes</span>
</span></span><span class="line"><span class="cl"><span class="sa">b</span><span class="s1">&#39;username:password&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">encoded</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">auth_bytes</span><span class="p">)</span> <span class="c1"># base64 encode</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">encoded</span>
</span></span><span class="line"><span class="cl"><span class="sa">b</span><span class="s1">&#39;dXNlcm5hbWU6cGFzc3dvcmQ=&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">encoded</span><span class="p">)</span> <span class="c1"># base64 decode</span>
</span></span><span class="line"><span class="cl"><span class="sa">b</span><span class="s1">&#39;username:password&#39;</span><span class="o">.</span>
</span></span></code></pre></div><p>è¿™ç§æ–¹æ³•æ˜¯æ— çŠ¶æ€çš„å› æ­¤å®¢æˆ·ç«¯å¿…é¡»åœ¨æ¯ä¸ªè¯·æ±‚ä¸­æºå¸¦æ¬¡å‡­è¯ï¼Œè¿™ç§æ–¹æ³•éå¸¸é€‚åˆå•ä¸€çš„ç®€å•çš„ä¸éœ€è¦æŒä¹…<code>sessions</code>çš„APIçš„è°ƒç”¨</p>
<h2 id="æµç¨‹">æµç¨‹</h2>
<ol>
<li>æœªè®¤è¯çš„å®¢æˆ·ç«¯è¯·æ±‚ä¸€ä¸ªå—é™çš„èµ„æº</li>
<li>HTTPè¿”å›401çŠ¶æ€ç å¹¶æºå¸¦<code>Basic</code>å€¼çš„åä¸º<code>WWW-Authenticate</code>çš„header</li>
<li><code>WWW-Authenticate: Basic</code>è®©æµè§ˆå™¨æç¤ºç”¨æˆ·å¯†ç è¾“å…¥</li>
<li>åœ¨è¾“å…¥å‡­è¯ä¹‹åï¼Œåœ¨æ¯ä¸€ä¸ªè¯·æ±‚çš„Headerä¸­éƒ½å°†æºå¸¦è¯¥å‡­è¯<code>Authorization: Basic dcdvcmQ=</code>
<img src="https://testdriven.io/static/images/blog/web-authentication-methods/basic_auth.png" alt="åŸºæœ¬è®¤è¯"></li>
</ol>
<h2 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h2>
<ol>
<li>æ­¥éª¤å°‘ï¼Œè®¤è¯è¿‡ç¨‹å¿«</li>
<li>å®ç°ç®€å•</li>
<li>ä¸»æµæµè§ˆå™¨éƒ½æ”¯æŒ</li>
</ol>
<h2 id="ç¼ºç‚¹">ç¼ºç‚¹</h2>
<ol>
<li>Base64å¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„åŠ å¯†ç®—æ³•ï¼Œåªæ˜¯å¦ä¸€ç§å‘ˆç°æ•°æ®çš„æ–¹å¼ã€‚Base64å­—ç¬¦ä¸²å¾ˆå®¹æ˜“åœ¨å‘é€æ–‡æœ¬çš„æ—¶å€™è¢«è§£ç ã€‚å¼±å®‰å…¨æ€§ä¼šé­æ¥å„ç§å„æ ·çš„æ”»å‡»ï¼Œå› æ­¤<code>HTTPS/SSL</code>éå¸¸æœ‰å¿…è¦</li>
<li>åœ¨æ¯ä¸ªè¯·æ±‚éƒ½å¿…é¡»æºå¸¦å‡­è¯</li>
<li>ç”¨æˆ·åªèƒ½é€šè¿‡å†™å…¥ä¸€ä¸ªé”™è¯¯çš„å‡­è¯ç”¨äºç™»å‡º</li>
</ol>
<h2 id="ç¬¬ä¸‰æ–¹ä¾èµ–pythonä¸‹åŒ">ç¬¬ä¸‰æ–¹ä¾èµ–(Pythonä¸‹åŒ)</h2>
<ul>
<li><a href="https://flask-httpauth.readthedocs.io/">Flask-HTTPAuth</a></li>
<li><a href="https://github.com/hirokiky/django-basicauth/">django-basicauth</a></li>
<li><a href="https://fastapi.tiangolo.com/advanced/security/http-basic-auth/">FastAPI:HTTP Basic Auth</a></li>
</ul>
<h2 id="ä»£ç ">ä»£ç </h2>
<p>ç”¨<code>Flask-HTTP</code>å¯ä»¥ä½¿ç”¨Flaskéå¸¸è½»æ¾çš„å®ç°åŸºæœ¬è®¤è¯</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask_httpauth</span> <span class="kn">import</span> <span class="n">HTTPBasicAuth</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">werkzeug.security</span> <span class="kn">import</span> <span class="n">generate_password_hash</span><span class="p">,</span> <span class="n">check_password_hash</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">auth</span> <span class="o">=</span> <span class="n">HTTPBasicAuth</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">users</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;username&#34;</span><span class="p">:</span> <span class="n">generate_password_hash</span><span class="p">(</span><span class="s2">&#34;password&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@auth.verify_password</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">verify_password</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">users</span> <span class="ow">and</span> <span class="n">check_password_hash</span><span class="p">(</span><span class="n">users</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;username&#34;</span><span class="p">),</span> <span class="n">password</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">username</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@auth.login_required</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;You have successfully logged in, </span><span class="si">{</span><span class="n">auth</span><span class="o">.</span><span class="n">current_user</span><span class="p">()</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span></span></code></pre></div><h2 id="èµ„æ–™">èµ„æ–™</h2>
<ul>
<li><a href="https://tools.ietf.org/html/rfc7617">IETF: The &lsquo;Basic&rsquo; HTTP Authentication Scheme</a></li>
<li><a href="https://blog.miguelgrinberg.com/post/restful-authentication-with-flask">RESTful Authentication with Flask</a></li>
<li><a href="https://www.django-rest-framework.org/api-guide/authentication/#basicauthentication">DRF Basic Authentication Guide</a></li>
<li><a href="https://gist.github.com/nilsdebruin/8b36cd98c9949a1a87e3a582f70146f1">FastAPI Basic Authentication Example</a></li>
</ul>
<h1 id="httpæ‘˜è¦éªŒè¯http-digest-authentication">HTTPæ‘˜è¦éªŒè¯(HTTP Digest Authentication)</h1>
<p>HTTPæ‘˜è¦éªŒè¯(æˆ–ç§°HTTPæ‘˜è¦æƒé™éªŒè¯)æ˜¯ä¸€ç§æ¯”HTTPåŸºæœ¬è®¤è¯æ›´å®‰å…¨çš„æ–¹å¼ã€‚è¿™ä¸¤ç§æ–¹æ³•çš„æœ€å¤§çš„åŒºåˆ«å°±æ˜¯ä¼ è¾“çš„å¯†ç æ˜¯ç”¨md5ç®—æ³•çš„Hashå­—ç¬¦ä¸²</p>
<h2 id="æµç¨‹-1">æµç¨‹</h2>
<ol>
<li>æœªéªŒè¯çš„å®¢æˆ·ç«¯è¯·æ±‚ä¸€ä¸ªå—é™èµ„æº</li>
<li>æœåŠ¡ç«¯ç”Ÿæˆä¸€ä¸ªéšæœºçš„å€¼ç”¨äºæç¤ºå¹¶é€šè¿‡è¿”å›ä¸€ä¸ªå€¼ä¸º<code>Digest</code>çš„<code>WWW-Authenticate</code>Headerå¹¶è¿”å›401æœªéªŒè¯çŠ¶æ€ç ï¼Œæ•´ä¸ªHeaderä¸º<code>WWW-Authenticate: Digest nonce=&quot;44f0437004157342f50f935906ad46fc&quot;</code></li>
<li><code>WWW-Authenticate</code>ä¼šè®©æµè§ˆå™¨æç¤ºè¾“å…¥å¸å·å¯†ç </li>
<li>åœ¨è¾“å…¥å‡­è¯ä¹‹åï¼Œå¯†ç ä¼šè¿›è¡ŒHashå¤„ç†å¹¶åœ¨æ¯ä¸€ä¸ªè¯·æ±‚çš„Headerä¸­æ·»åŠ ä¸€æ¡å£°æ˜ä¿¡æ¯<code>Authorization: Digest username=&quot;username&quot;,nonce=&quot;16e30069e45a7f47b4e2606aeeb7ab62&quot;, response=&quot;89549b93e13d438cd0946c6d93321c52&quot;</code></li>
<li>é€šè¿‡è´¦æˆ·åï¼ŒæœåŠ¡ç«¯è·å–å¯¹åº”çš„å¯†ç è¿›è¡ŒHashå¤„ç†å¹¶å¯¹å£°æ˜ä¸­çš„ä¿¡æ¯è¿›è¡Œæ¯”è¾ƒæ˜¯å¦ç›¸åŒ
![HTTP Digest Authentication]https://testdriven.io/static/images/blog/web-authentication-methods/digest_auth.png)</li>
</ol>
<h2 id="ä¼˜ç‚¹-1">ä¼˜ç‚¹</h2>
<ol>
<li>æ¯”åŸºæœ¬éªŒè¯æ‹¥æœ‰æ›´å¼ºçš„å®‰å…¨æ€§</li>
<li>å®ç°ç®€å•</li>
<li>ä¸»æµæµè§ˆå™¨åŸºæœ¬éƒ½æ”¯æŒ</li>
</ol>
<h2 id="ç¼ºç‚¹-1">ç¼ºç‚¹</h2>
<ol>
<li>å¿…é¡»åœ¨æ¯ä¸ªè¯·æ±‚éƒ½æºå¸¦å‡­è¯</li>
<li>ç”¨æˆ·åªèƒ½é‡æ–°æäº¤ä¸ªä¸æ­£ç¡®çš„å‡­è¯æ¥ç™»å‡º</li>
<li>ä¸åŸºæœ¬éªŒè¯ç›¸æ¯”ï¼Œç”±äºå¯†ç ä¸èƒ½åŠ å¯†ä¿å­˜å› æ­¤åœ¨æœåŠ¡ç«¯å®‰å…¨æ€§è¾ƒå·®</li>
<li>å¾ˆå®¹æ˜“æ”¶åˆ°ä¸­é—´äººè¢­å‡»</li>
</ol>
<h2 id="ç¬¬ä¸‰æ–¹ä¾èµ–">ç¬¬ä¸‰æ–¹ä¾èµ–</h2>
<ul>
<li><a href="https://flask-httpauth.readthedocs.io/">Flask-HTTPAuth</a></li>
</ul>
<h2 id="ä»£ç -1">ä»£ç </h2>
<p>ç”¨<code>Flask-HTTP</code>å¯ä»¥ä½¿ç”¨Flaskéå¸¸è½»æ¾çš„å®ç°</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask_httpauth</span> <span class="kn">import</span> <span class="n">HTTPDigestAuth</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&#34;SECRET_KEY&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;change me&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">auth</span> <span class="o">=</span> <span class="n">HTTPDigestAuth</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">users</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;username&#34;</span><span class="p">:</span> <span class="s2">&#34;password&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@auth.get_password</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">users</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@auth.login_required</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;You have successfully logged in, </span><span class="si">{</span><span class="n">auth</span><span class="o">.</span><span class="n">current_user</span><span class="p">()</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span></span></code></pre></div><h2 id="èµ„æ–™-1">èµ„æ–™</h2>
<ul>
<li><a href="https://tools.ietf.org/html/rfc7616">IETF: HTTP Digest Access Authentication</a></li>
<li><a href="https://2.python-requests.org/en/latest/user/authentication/#digest-authentication">Digest Authentication from the Requests library</a></li>
</ul>
<h1 id="ä¼šè¯è®¤è¯session-based-auth">ä¼šè¯è®¤è¯(Session-based Auth)</h1>
<p>é€šè¿‡ä¼šè¯ï¼Œç”¨æˆ·çŠ¶æ€å¯ä»¥å­˜å‚¨åœ¨æœåŠ¡ç«¯ä¸Šã€‚è¿™å¹¶ä¸éœ€è¦ç”¨æˆ·æ¯æ¬¡è¯·æ±‚éƒ½æºå¸¦è´¦æˆ·å¯†ç ä¿¡æ¯ã€‚è€Œæ˜¯åœ¨ä»–ä»¬ç™»å½•è¿‡åï¼Œåœ¨æœåŠ¡ç«¯ä¼šéªŒè¯ç™»å½•å‡­è¯ï¼Œå¦‚æœæ˜¯åˆæ³•çš„ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªä¼šè¯å¹¶å­˜å‚¨åœ¨ä¼šè¯æ± ä¸­ï¼Œç„¶åè¿”å›è¯¥ä¼šè¯çš„å”¯ä¸€æ ‡è¯†ID(Session ID)ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨ä¼šå°†è¯¥IDå½“ä½œcookieä¿å­˜åœ¨æµè§ˆå™¨ä¸­å¹¶åœ¨æ¯æ¬¡è¯·æ±‚æ—¶æºå¸¦è¯¥cookie</p>
<h2 id="æµç¨‹-2">æµç¨‹</h2>
<p><img src="https://testdriven.io/static/images/blog/web-authentication-methods/session_auth.png" alt="Session-based Auth"></p>
<h2 id="ä¼˜ç‚¹-2">ä¼˜ç‚¹</h2>
<ol>
<li>ç”±äºä¸éœ€è¦æºå¸¦ç™»å½•å‡­è¯ï¼Œåœ¨åç»­çš„åˆ¤æ–­ç™»å½•ä¼šååˆ†è¿…é€Ÿ</li>
<li>æé«˜äº†ç”¨æˆ·ä½“éªŒ</li>
<li>å®¹æ˜“å®ç°ï¼Œå¾ˆå¤šæ¡†æ¶(ä¾‹å¦‚Django)æä¾›äº†è¿™ç§éªŒè¯æ–¹æ³•å¹¶å¼€ç®±å³ç”¨</li>
</ol>
<h2 id="ç¼ºç‚¹-2">ç¼ºç‚¹</h2>
<ol>
<li>Sessionæ˜¯æœ‰çŠ¶æ€çš„ã€‚æœåŠ¡ç«¯ä¼šè·Ÿè¸ªæ¯ä¸€ä¸ªä¼šè¯ã€‚ç”¨äºå­˜å‚¨ä¼šè¯ä¿¡æ¯çš„ä¼šè¯æ± éœ€è¦ç»™ä¼—å¤šæœåŠ¡æä¾›éªŒè¯æœåŠ¡ã€‚å› æ­¤ï¼Œè¿™å¯¹RESTfulæœåŠ¡æ¥è¯´å¹¶ä¸å‹å¥½ï¼Œå› ä¸ºRESTæ˜¯ä¸€ç§æ— çŠ¶æ€åè®®</li>
<li>æ¯ä¸€ä¸ªè¯·æ±‚éƒ½ä¼šæºå¸¦cookieä¿¡æ¯ï¼Œå°±ç®—æ˜¯ä¸éœ€è¦éªŒè¯çš„è¯·æ±‚ä¹Ÿå¦‚æ­¤</li>
<li>å¯¹CSRFæ”»å‡»çš„é˜²æŠ¤ä¸è¶³([ä»€ä¹ˆæ˜¯CSRFï¼Œå¦‚ä½•åœ¨Flaskä¸­æŠµå¾¡CSRFæ”»å‡»]https://testdriven.io/blog/csrf-flask/))</li>
</ol>
<h2 id="ç¬¬ä¸‰æ–¹ä¾èµ–-1">ç¬¬ä¸‰æ–¹ä¾èµ–</h2>
<ol>
<li><a href="https://flask-login.readthedocs.io/">Flask-Login</a></li>
<li><a href="https://flask-httpauth.readthedocs.io/">Flask-HTTPAuth</a></li>
<li><a href="https://docs.djangoproject.com/en/3.1/topics/auth/">User authentication in Django</a></li>
<li><a href="https://github.com/MushroomMaula/fastapi_login">FastAPI-Login</a></li>
<li><a href="https://github.com/frankie567/fastapi-users">FastAPI-Users</a></li>
</ol>
<h2 id="ä»£ç -2">ä»£ç </h2>
<p><code>Flask-login</code>å¯¹ä¼šè¯éªŒè¯éå¸¸åˆé€‚ï¼Œè¯¥åŒ…è´Ÿè´£ç™»å½•å’Œæ³¨é”€ï¼Œå¹¶å¯ä»¥åœ¨ä¸€æ®µæ—¶é—´å†…è®°ä½ç”¨æˆ·ä¿¡æ¯</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask_login</span> <span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">LoginManager</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">UserMixin</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">current_user</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">login_required</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">login_user</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">werkzeug.security</span> <span class="kn">import</span> <span class="n">generate_password_hash</span><span class="p">,</span> <span class="n">check_password_hash</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">SECRET_KEY</span><span class="o">=</span><span class="s2">&#34;change_this_key&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">login_manager</span> <span class="o">=</span> <span class="n">LoginManager</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">login_manager</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">users</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;username&#34;</span><span class="p">:</span> <span class="n">generate_password_hash</span><span class="p">(</span><span class="s2">&#34;password&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">UserMixin</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@login_manager.user_loader</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">user_loader</span><span class="p">(</span><span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_model</span> <span class="o">=</span> <span class="n">User</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_model</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">username</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">user_model</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/login&#34;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;POST&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">login_page</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">username</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;username&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;password&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">check_password_hash</span><span class="p">(</span><span class="n">users</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="p">),</span> <span class="n">password</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">user_model</span> <span class="o">=</span> <span class="n">User</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">user_model</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">username</span>
</span></span><span class="line"><span class="cl">            <span class="n">login_user</span><span class="p">(</span><span class="n">user_model</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;Wrong credentials&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;logged in&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@login_required</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">protected</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;Current user: </span><span class="si">{</span><span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span></span></code></pre></div><h2 id="èµ„æ–™-2">èµ„æ–™</h2>
<ul>
<li><a href="https://tools.ietf.org/id/draft-broyer-http-cookie-auth-00.html">IETF: Cookie-based HTTP Authentication</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-add-authentication-to-your-app-with-flask-login">How To Add Authentication to Your App with Flask-Login</a></li>
<li><a href="https://testdriven.io/blog/flask-spa-auth/">Session-based Auth with Flask for Single Page Apps</a></li>
<li><a href="https://testdriven.io/blog/csrf-flask/">CSRF Protection in Flask</a></li>
<li><a href="https://learndjango.com/tutorials/django-login-and-logout-tutorial">Django Login and Logout Tutorial</a></li>
<li><a href="https://testdriven.io/blog/django-spa-auth/">Django Session-based Auth for Single Page Apps</a></li>
<li><a href="https://frankie567.github.io/fastapi-users/configuration/authentication/cookie/">FastAPI-Users: Cookie Auth</a></li>
</ul>
<h1 id="ä»¤ç‰ŒéªŒè¯token-based-authentication">ä»¤ç‰ŒéªŒè¯(Token-Based Authentication)</h1>
<p>è¿™ç§æ–¹æ³•æ˜¯å°†cookiesç”¨ä»¤ç‰Œè®¤è¯æ›¿ä»£ã€‚ç”¨æˆ·æä¾›ç™»å½•å‡­è¯æœåŠ¡ç«¯è¿”å›ä¸€ç§æ ‡è¯†ä»¤ç‰Œï¼Œè¿™ä¸ªä»¤ç‰Œå°†ä¼šåœ¨åç»­çš„è¯·æ±‚ä¸­æºå¸¦</p>
<p>æœ€å¸¸è§å¹¶å¹¿æ³›åº”ç”¨çš„ä»¤ç‰Œæ˜¯<code>JSON Web Token</code>([JWT]https://jwt.io/))ã€‚JWTç”±ä¸‰éƒ¨åˆ†ç»„æˆ</p>
<ul>
<li>Header(æºå¸¦ä»¤ç‰Œçš„ç±»å‹å’Œä½¿ç”¨çš„Hashç®—æ³•ç±»å‹)</li>
<li>Payload(æºå¸¦å¯¹è¯¥ä»¤ç‰Œä¿¡æ¯çš„å£°æ˜ç»“æ„ä½“)</li>
<li>Signature(ç”¨äºéªŒè¯ä¿¡æ¯æ˜¯å¦åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯)</li>
</ul>
<p>ä»¥ä¸Šä¸‰éƒ¨åˆ†éƒ½å°†ä½¿ç”¨base64ç¼–ç ï¼Œå¹¶ä¸”æ¯éƒ¨åˆ†éƒ½ä¼šè¿›è¡ŒHashå¤„ç†ï¼Œä¸åŒç±»å‹ä¸­é—´ç”¨<code>.</code>åˆ†å‰²ã€‚ç”±äºè¿™äº›ä¿¡æ¯éƒ½è¢«ç¼–ç è¿‡ï¼Œä»»ä½•äººéƒ½èƒ½é€šè¿‡è§£ç æ¥æŸ¥çœ‹æºå¸¦çš„ä¿¡æ¯ã€‚ä½†æ˜¯åªæœ‰éªŒè¯çš„ç”¨æˆ·æ‰èƒ½ç”Ÿæˆåˆæ³•çš„ä»¤ç‰Œã€‚ä»¤ç‰Œå°†ä¼šé€šè¿‡ç­¾åæ¥éªŒè¯åˆæ³•æ€§ã€‚</p>
<blockquote>
<p>JWTæ˜¯ä¸€ç§ç´§å‡‘çš„ã€URLå®‰å…¨çš„æ–¹æ³•ï¼Œç”¨äºè¡¨ç¤ºåœ¨ä¸¤æ–¹äº’ç›¸ä¼ è¾“çš„å£°æ˜ã€‚åœ¨JWTä¸­ï¼Œå£°æ˜ä¿¡æ¯è¢«ç¼–ç æˆJSONä¿¡æ¯ï¼Œç”¨äºJWSæˆ–è€…JWEï¼Œä»è€Œä½¿å£°æ˜å¯ä»¥è¿›è¡Œæ•°å­—ç­¾åæˆ–å®Œæ•´æ€§ä¿æŠ¤[IETE]https://tools.ietf.org/html/rfc7519)(ç¿»è¯‘çš„ä¸æ˜¯å¾ˆå¥½)</p>
</blockquote>
<p>æœåŠ¡ç«¯å¹¶ä¸éœ€è¦ä¿å­˜ä»¤ç‰Œï¼Œä»¤ç‰Œåªèƒ½ä½¿ç”¨ç­¾åæ¥éªŒè¯ã€‚æœ€è¿‘ï¼Œç”±äºRESTful APIå’Œå•é¡µåº”ç”¨ç¨‹åºçš„å…´èµ·ï¼Œä»¤ç‰ŒéªŒè¯è¿™ç§æ–¹æ³•çš„é‡‡ç”¨æœ‰æ‰€å¢åŠ </p>
<h2 id="æµç¨‹-3">æµç¨‹</h2>
<p><img src="https://testdriven.io/static/images/blog/web-authentication-methods/token_auth.png" alt="Token-Based Auth"></p>
<h2 id="ä¼˜ç‚¹-3">ä¼˜ç‚¹</h2>
<ol>
<li>æ— çŠ¶æ€ã€‚æœåŠ¡ç«¯ä¸éœ€è¦å­˜å‚¨ä»¤ç‰Œï¼Œåªéœ€è¦ä»¤ç‰Œä¸­çš„ç­¾åç”¨äºéªŒè¯ã€‚è¿™æ–¹æ¯ä¸ªè¯·æ±‚ä¸éœ€è¦è°ƒç”¨æ•°æ®åº“ä»è€Œæ›´åŠ å¿«é€Ÿ</li>
<li>å¯¹å¤šä¸ªæœåŠ¡éœ€è¦éªŒè¯çš„å¾®æœåŠ¡æ¶æ„æ¥è¯´éå¸¸åˆé€‚ã€‚æˆ‘ä»¬åªéœ€è¦é…ç½®å¦‚ä½•å¤„ç†ä»¤ç‰Œå’Œä»¤ç‰Œå¯†é’¥ã€‚</li>
</ol>
<h2 id="ç¼ºç‚¹-3">ç¼ºç‚¹</h2>
<ol>
<li>å®¢æˆ·ç«¯éœ€è¦è€ƒè™‘å¦‚ä½•å­˜å‚¨ä»¤ç‰Œï¼Œè¿™å¯èƒ½å¯¼è‡´XSSæˆ–è€…CSRFæ”»å‡»</li>
<li>ä»¤ç‰Œä¸å¯åˆ é™¤ï¼Œåªèƒ½è¿‡æœŸã€‚è¿™æ„å‘³ç€å¦‚æœä»¤ç‰Œæ³„æ¼ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨è¿™ä¸ªä»¤ç‰Œç›´è‡³è¿‡æœŸã€‚å› æ­¤éå¸¸æœ‰å¿…è¦å¯¹ä»¤ç‰Œè®¾ç½®ä¸€ä¸ªè¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ä¾‹å¦‚15åˆ†é’Ÿ</li>
<li>éœ€è¦åœ¨ä»¤ç‰Œå¿«è¿‡æœŸæ—¶è¿›è¡Œä»¤ç‰Œçš„è‡ªåŠ¨åˆ·æ–°</li>
<li>åˆ é™¤ä»¤ç‰Œçš„å”¯ä¸€æ–¹å¼æ˜¯åˆ›å»ºä¸€ä¸ªæ•°æ®åº“æˆ–è€…é»‘åå•ã€‚è¿™ä¼šå¯¹å¾®æœåŠ¡æ¶æ„æ¥è¯´å¢åŠ é¢å¤–çš„è´Ÿæ‹…å’Œæ½œåœ¨çš„é—®é¢˜ã€‚</li>
</ol>
<h2 id="ç¬¬ä¸‰æ–¹ä¾èµ–-2">ç¬¬ä¸‰æ–¹ä¾èµ–</h2>
<ul>
<li><a href="https://github.com/vimalloc/flask-jwt-extended">Flask-JWT-Extended</a></li>
<li><a href="https://flask-httpauth.readthedocs.io/">Flask-HTTPAuth</a></li>
<li><a href="https://github.com/SimpleJWT/django-rest-framework-simplejwt">Simple JWT for Django REST Framework</a></li>
<li><a href="https://github.com/IndominusByte/fastapi-jwt-auth">FastAPI JWT Auth</a></li>
</ul>
<h2 id="ä»£ç -3">ä»£ç </h2>
<p><code>Flask-JWT-Extended</code>å¯ä»¥æä¾›å¤„ç†JWTçš„è®¸å¤šæ–¹æ³•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask_jwt_extended</span> <span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">JWTManager</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">jwt_required</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">create_access_token</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">get_jwt_identity</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">werkzeug.security</span> <span class="kn">import</span> <span class="n">check_password_hash</span><span class="p">,</span> <span class="n">generate_password_hash</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">JWT_SECRET_KEY</span><span class="o">=</span><span class="s2">&#34;please_change_this&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">jwt</span> <span class="o">=</span> <span class="n">JWTManager</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">users</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;username&#34;</span><span class="p">:</span> <span class="n">generate_password_hash</span><span class="p">(</span><span class="s2">&#34;password&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/login&#34;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;POST&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">login_page</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;username&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;password&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">check_password_hash</span><span class="p">(</span><span class="n">users</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="p">),</span> <span class="n">password</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">access_token</span> <span class="o">=</span> <span class="n">create_access_token</span><span class="p">(</span><span class="n">identity</span><span class="o">=</span><span class="n">username</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">access_token</span><span class="o">=</span><span class="n">access_token</span><span class="p">),</span> <span class="mi">200</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;Wrong credentials&#34;</span><span class="p">,</span> <span class="mi">400</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@jwt_required</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">protected</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">logged_in_as</span><span class="o">=</span><span class="n">get_jwt_identity</span><span class="p">()),</span> <span class="mi">200</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span></span></code></pre></div><h2 id="èµ„æ–™-3">èµ„æ–™</h2>
<ul>
<li><a href="https://jwt.io/introduction">Introduction to JSON Web Tokens</a></li>
<li><a href="https://tools.ietf.org/html/rfc7519">IETF: JSON Web Token (JWT)</a></li>
<li><a href="https://simpleisbetterthancomplex.com/tutorial/2018/12/19/how-to-use-jwt-authentication-with-django-rest-framework.html">How to Use JWT Authentication with Django REST Framework</a></li>
<li><a href="https://testdriven.io/blog/fastapi-jwt-auth/">Securing FastAPI with JWT Token-based Authentication</a></li>
<li><a href="https://blog.asayer.io/jwt-authentication-best-practices">JWT Authentication Best Practices</a></li>
</ul>
<h1 id="ä¸€æ¬¡æ€§å¯†ç one-time-passwords">ä¸€æ¬¡æ€§å¯†ç (One Time Passwords)</h1>
<p>ä¸€æ¬¡æ€§å¯†ç é€šå¸¸ç”¨äºç¡®è®¤è®¤è¯æ¶ˆæ¯ã€‚OTPsä¼šéšæœºç”Ÿæˆä»£ç ç”¨äºéªŒè¯ç”¨æˆ·æ˜¯å¦æ˜¯å£°æ˜ä¸­çš„ã€‚ä¹Ÿç»å¸¸ç”¨äºAPPä¸­çš„äºŒæ¬¡éªŒè¯</p>
<p>ä¸ºäº†ä½¿ç”¨OTPsï¼Œå¿…é¡»è¦æœ‰ä¸€ä¸ªå¯é å¯ä¿¡èµ–çš„ç³»ç»Ÿã€‚è¿™ä¸ªç³»ç»Ÿå°†ä¼šç”¨äºéªŒè¯emailæˆ–ç”µè¯</p>
<p>ç°ä»£OTPsæ˜¯æ— çŠ¶æ€çš„ï¼Œå¹¶ä¸”æœ‰å¾ˆå¤šæ–¹æ³•æ¥éªŒè¯ã€‚å°½ç®¡æœ‰å¾ˆå¤šç±»å‹çš„OTPsï¼Œä½†æ˜¯åŸºäºæ—¶é—´çš„OTPs(TOTPs)æ˜¯ç›®å‰æ¯«æ— äº‰è®®ä½¿ç”¨æœ€å¤šçš„æ–¹æ³•ã€‚éªŒè¯ä»£ç åœ¨ç”Ÿæˆè¿‡åä¼šåœ¨ä¸€æ®µæ—¶é—´åè¿‡æœŸã€‚</p>
<p>ç”±äºä½ æ·»åŠ äº†ä¸€å±‚å®‰å…¨æ£€æŸ¥ï¼ŒOTPSå¯ä»¥ç”¨äºå¤„ç†ä¸€äº›å®‰å…¨æ€§é«˜åº¦éœ€è¦çš„APPä¾‹å¦‚é“¶è¡Œæˆ–å…¶ä»–é‡‘èæœåŠ¡</p>
<h2 id="æµç¨‹-4">æµç¨‹</h2>
<p>ä¼ ç»Ÿçš„OTPSéªŒè¯æµç¨‹å¦‚ä¸‹</p>
<ul>
<li>å®¢æˆ·ç«¯å‘é€ç”¨æˆ·å¯†ç </li>
<li>åœ¨è®¤è¯è¿‡åï¼ŒæœåŠ¡ç«¯ç”Ÿæˆéšæœºçš„ä»£ç ï¼Œä¿å­˜åœ¨æœåŠ¡ç«¯å¹¶è¿”å›ç»™å¯ä¿¡èµ–çš„ç³»ç»Ÿ</li>
<li>å®¢æˆ·é€šè¿‡å¯ä¿¡èµ–ç³»ç»Ÿè·å–ç”Ÿæˆçš„ä»£ç ï¼Œåœ¨APPä¸­è¾“å…¥è¿”å›ç»™å®¢æˆ·ç«¯</li>
<li>æœåŠ¡ç«¯éªŒè¯ä»£ç æ˜¯å¦å’Œä¿å­˜çš„ä¸€è‡´ï¼Œå¦‚æœç¬¦åˆåˆ™æ”¾è¡Œ</li>
</ul>
<p>åŸºäºæ—¶é—´çš„TOTPSæµç¨‹å¦‚ä¸‹</p>
<ul>
<li>å®¢æˆ·ç«¯å‘é€ç”¨æˆ·å¯†ç </li>
<li>åœ¨è®¤è¯åï¼ŒæœåŠ¡ç«¯é€šè¿‡éšæœºç§å­ç”Ÿæˆéšæœºä»£ç ï¼Œä¿å­˜åœ¨æœåŠ¡ç«¯å¹¶è¿”å›ç»™å¯ä¿¡èµ–çš„ç³»ç»Ÿ</li>
<li>å®¢æˆ·é€šè¿‡å¯ä¿¡èµ–ç³»ç»Ÿè·å–ç”Ÿæˆçš„ä»£ç ï¼Œåœ¨APPä¸­è¾“å…¥è¿”å›ç»™å®¢æˆ·ç«¯</li>
<li>æœåŠ¡ç«¯éªŒè¯ä»£ç æ˜¯å¦å’Œå­˜å‚¨çš„ä»£ç ä¸€è‡´å¹¶ä¸”æ²¡æœ‰è¿‡æœŸï¼Œå¦‚æœç¬¦åˆåˆ™æ”¾è¡Œ</li>
</ul>
<p>ä¾‹å¦‚<a href="https://en.wikipedia.org/wiki/Google_Authenticator">Google Authenticator</a>, <a href="https://www.microsoft.com/en-us/account/authenticator">Microsoft Authenticator</a>, <a href="https://en.wikipedia.org/wiki/FreeOTP">FreeOTP</a>çš„OTPä»£ç†å•†å·¥ä½œæµç¨‹</p>
<ul>
<li>åœ¨ä»£ç†ç”Ÿè®¤è¯2FAåï¼ŒæœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªéšæœºç§å­ï¼Œå¹¶ä»¥å”¯ä¸€çš„äºŒç»´ç å½¢å¼å‘é€ç»™ç”¨æˆ·</li>
<li>ç”¨æˆ·é€šè¿‡2FAåº”ç”¨æ‰«æäºŒç»´ç ç”¨äºéªŒè¯ä¿¡èµ–è®¾å¤‡</li>
<li>å½“OTPéœ€è¦æ—¶ï¼Œç”¨æˆ·ä¼šæ£€æŸ¥è®¾å¤‡ä¸­çš„ä»£ç ï¼Œå¹¶ä¸”åœ¨Webä¸­è¾“å…¥</li>
<li>æœåŠ¡ç«¯éªŒè¯è¾“å…¥çš„ä»£ç ï¼Œå¦‚æœç¬¦åˆåˆ™æ”¾è¡Œ</li>
</ul>
<h2 id="ä¼˜ç‚¹-4">ä¼˜ç‚¹</h2>
<ul>
<li>æ·»åŠ äº†ä¸€å±‚é˜²æŠ¤å±‚</li>
<li>å¯†ç æ³„æ¼çš„å±é™©æ€§é™ä½ï¼Œæˆ–è€…è¯´æœåŠ¡åªä¼šé€šè¿‡OTPéªŒè¯</li>
</ul>
<h2 id="ç¼ºç‚¹-4">ç¼ºç‚¹</h2>
<ul>
<li>ä½ éœ€è¦å­˜å‚¨OTPsç”Ÿæˆçš„ç§å­</li>
<li>å¦‚æœä½ ä¸¢å¤±äº†å›å¤ä»£ç ï¼ŒOTPä»£ç†å•†ä¾‹å¦‚Google Authenticatoréå¸¸éš¾è®¾ç½®</li>
<li>å½“å¯ä¿¡èµ–è®¾å¤‡ä¸å¯ä½¿ç”¨æ—¶ä¼šäº§ç”Ÿè¯¸å¤šé—®é¢˜(æ²¡ç”µï¼Œç½‘ç»œé”™è¯¯ç­‰ç­‰)ã€‚å› æ­¤ï¼Œæ·»åŠ å¤‡ç”¨è®¾å¤‡éå¸¸æœ‰å¿…è¦</li>
</ul>
<h2 id="ç¬¬ä¸‰æ–¹ä¾èµ–-3">ç¬¬ä¸‰æ–¹ä¾èµ–</h2>
<ul>
<li><a href="https://pyauth.github.io/pyotp/">PyOTP - The Python One-Time Password Library</a></li>
<li><a href="https://github.com/django-otp/django-otp">django-otp</a></li>
</ul>
<h2 id="ä»£ç -4">ä»£ç </h2>
<p><code>PyOTP</code>æä¾›äº†åŸºäºæ—¶é—´å’ŒåŸºäºè®¡æ•°å™¨çš„OTPs</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pyotp</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">otp</span> <span class="o">=</span> <span class="n">pyotp</span><span class="o">.</span><span class="n">TOTP</span><span class="p">(</span><span class="n">pyotp</span><span class="o">.</span><span class="n">random_base32</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">code</span> <span class="o">=</span> <span class="n">otp</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;OTP generated: </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Verify OTP: </span><span class="si">{</span><span class="n">otp</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="n">code</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Verify after 30s: </span><span class="si">{</span><span class="n">otp</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="n">code</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>OTP generated: 474771
Verify OTP: True
Verify after 30s: False
</code></pre><h2 id="èµ„æ–™-4">èµ„æ–™</h2>
<ul>
<li><a href="https://tools.ietf.org/html/rfc6238">IETF: TOTP: Time-Based One-Time Password Algorithm</a></li>
<li><a href="https://tools.ietf.org/html/rfc2289">IETF: A One-Time Password System</a></li>
<li><a href="https://hackernoon.com/implementing-2fa-how-time-based-one-time-password-actually-works-with-python-examples-cm1m3ywt">Implementing 2FA: How Time-Based One-Time Password Actually Works (With Python Examples)</a></li>
</ul>
<h1 id="oauthå’Œopenid">OAuthå’ŒOpenID</h1>
<p>OAuth/OAuth2å’ŒOpenIDæ—¶ç›®å‰æ¯”è¾ƒç«çš„è®¤è¯æ–¹æ³•ã€‚ä»–ä»¬éƒ½è¦æ±‚å®ç°ç¤¾äº¤ç™»å½•(ä¸€ç§å•ç‚¹ç™»å½•å½¢å¼)ï¼Œä½¿ç”¨æ¥è‡ªç¤¾äº¤ç½‘ç»œæœåŠ¡(ä¾‹å¦‚Facebookï¼ŒTwitteræˆ–è°·æ­Œ)ç°æœ‰çš„ä¿¡æ¯ä»‹å…¥ç¬¬ä¸‰æ–¹ç½‘ç«™ï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ç™»å½•è´¦æˆ·</p>
<p>è¿™ç§ç±»å‹çš„è®¤è¯æˆæƒå¯ä»¥åœ¨ä½ éœ€è¦é«˜åº¦å®‰å…¨è®¤è¯æ—¶ä½¿ç”¨ã€‚ä¸€äº›æä¾›å•†æœ‰ç»„å¤Ÿå¤šçš„èµ„æºæ¥å¤„ç†è®¤è¯ã€‚åˆ©ç”¨è¿™äº›ä¹…ç»è€ƒéªŒçš„è®¤è¯ç³»ç»Ÿå¯ä»¥è®©ä½ çš„åº”ç”¨æ›´ä¸ºçš„å®‰å…¨ã€‚</p>
<p>è¿™ç§æ–¹æ³•é€šå¸¸ä¸ä¼šè¯è®¤è¯æ­é…ä½¿ç”¨</p>
<h2 id="æµç¨‹-5">æµç¨‹</h2>
<p>ä½ æµè§ˆä¸€äº›éœ€è¦ç™»å½•çš„ç½‘ç«™ï¼Œä½ è¿›å…¥ç™»å½•ç•Œé¢å¹¶å‘ç°ä¸€ä¸ª<code>ä½¿ç”¨è°·æ­Œç™»å½•</code>çš„æŒ‰é’®ã€‚ä½ ç‚¹å‡»æŒ‰é’®åä¼šå¼•å¯¼ä½ è¿›å…¥è°·æ­Œç™»å½•ç•Œé¢ã€‚ä¸€æ—¦ç™»å½•è®¤è¯å®Œæˆï¼Œä½ ä¼šè¢«é‡å®šå‘è‡³åˆšåˆšæµè§ˆçš„éœ€è¦ç™»å½•çš„ç½‘ç«™ã€‚è¿™æ˜¯ä¸€ç§ä½¿ç”¨OpenIDè®¤è¯çš„ä¾‹å­ã€‚å®ƒä¼šè®©ä½ ç”¨ä¸€ä¸ªç°æˆçš„è´¦æˆ·ç™»å½•è€Œå¹¶ä¸éœ€è¦å†åˆ›å»ºä¸€ä¸ªæ–°å¸å·</p>
<p>æœ€è‘—åçš„OpenIDæä¾›å•†æœ‰è°·æ­Œï¼ŒFacebookï¼ŒGithub</p>
<p>åœ¨ç™»å½•è¿‡åï¼Œä½ è¿›å…¥ç½‘ç«™çš„ä¸‹è½½æœåŠ¡ï¼Œåœ¨ä¸‹è½½å¤§æ–‡ä»¶æ—¶ç›´æ¥æ¥å…¥åˆ°è°·æ­Œäº‘ä¸­ã€‚ç½‘ç«™æ˜¯å¦‚ä½•è®¿é—®ä½ çš„è°·æ­Œäº‘çš„å‘¢ï¼Ÿè¿™å°±æ˜¯OAuthå‘æŒ¥ä½œç”¨çš„æ—¶å€™ã€‚ä½ å¯ä»¥åœ¨æˆäºˆè®¿é—®å…¶ä»–ç½‘ç«™ä¸Šèµ„æºçš„æƒé™ï¼Œæ¯”å¦‚æ­¤æ—¶çš„è°·æ­Œäº‘è®¿é—®æƒé™ã€‚</p>
<h2 id="ä¼˜ç‚¹-5">ä¼˜ç‚¹</h2>
<ul>
<li>æé«˜äº†å®‰å…¨æ€§</li>
<li>æ›´å®¹æ˜“ä¸”å¿«é€Ÿçš„ç™»å½•æµç¨‹ï¼Œä¸éœ€è¦é¢å¤–åˆ›å»ºä¸€ä¸ªè´¦æˆ·</li>
<li>ç”±äºè®¤è¯æ—¶æ— å¯†ç çš„ï¼Œä¸€æ—¦å‡ºç°å®‰å…¨æ¼æ´ï¼Œä¸ä¼šå¯¹ç¬¬ä¸‰æ–¹é€ æˆæŸå®³</li>
</ul>
<h2 id="ç¼ºç‚¹-5">ç¼ºç‚¹</h2>
<ul>
<li>ä½ éœ€è¦ä¾èµ–ä¸åœ¨ä½ æŒæ§çš„ç¬¬ä¸‰æ–¹APPã€‚å¦‚æœOpenIDæœåŠ¡å®•æœºï¼Œç”¨æˆ·å°±ä¸èƒ½å†è¿›è¡Œç™»å½•</li>
<li>äººé€šå¸¸ä¼šæŠ¤å£«OAuthåº”ç”¨çš„æˆæƒä¿¡æ¯</li>
<li>æ²¡æœ‰é…ç½®OpenIDæä¾›ä¸Šè´¦æˆ·çš„ç”¨æˆ·å°†æ— æ³•è®¿é—®ä½ çš„åº”ç”¨ã€‚æœ€å¥½çš„æ–¹æ³•æ˜¯æœ¬ç«™æ³¨å†Œå’ŒOAuthè®¤è¯åŒæ—¶åšã€‚</li>
</ul>
<h2 id="ç¬¬ä¸‰æ–¹ä¾èµ–-4">ç¬¬ä¸‰æ–¹ä¾èµ–</h2>
<p>ç¤¾äº¤ç™»å½•</p>
<ul>
<li><a href="https://authomatic.github.io/authomatic/">Authomatic</a></li>
<li><a href="https://python-social-auth.readthedocs.io/">Python Social Auth</a></li>
<li><a href="https://flask-dance.readthedocs.io/">Flask-Dance</a></li>
<li><a href="https://django-allauth.readthedocs.io/">django-allauth</a></li>
</ul>
<p>åˆ›å»ºè‡ªå·±çš„OAuthæˆ–OpenIDæœåŠ¡</p>
<ul>
<li><a href="https://authlib.org/">Authlib</a></li>
<li><a href="https://oauthlib.readthedocs.io/">OAuthLib</a></li>
<li><a href="https://flask-oauthlib.readthedocs.io/">Flask-OAuthlib</a></li>
<li><a href="https://django-oauth-toolkit.readthedocs.io/">Django OAuth Toolkit</a></li>
<li><a href="https://django-oidc-provider.readthedocs.io/">Django OIDC Provider</a></li>
<li><a href="https://fastapi.tiangolo.com/tutorial/security/simple-oauth2/">FastAPI: Simple OAuth2 with Password and Bearer</a></li>
<li><a href="https://fastapi.tiangolo.com/tutorial/security/oauth2-jwt/#advanced-usage-with-scopes">FastAPI: OAuth2 with Password (and hashing), Bearer with JWT tokens</a></li>
</ul>
<h2 id="ä»£ç -5">ä»£ç </h2>
<p>ä½ å¯ä»¥é€šè¿‡<code>Flask-Dance</code>æ¥å…¥GithubæœåŠ¡</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">redirect</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask_dance.contrib.github</span> <span class="kn">import</span> <span class="n">make_github_blueprint</span><span class="p">,</span> <span class="n">github</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="s2">&#34;change me&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&#34;GITHUB_OAUTH_CLIENT_ID&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;1aaf1bf583d5e425dc8b&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&#34;GITHUB_OAUTH_CLIENT_SECRET&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;dee0c5bc7e0acfb71791b21ca459c008be992d7c&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">github_blueprint</span> <span class="o">=</span> <span class="n">make_github_blueprint</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">github_blueprint</span><span class="p">,</span> <span class="n">url_prefix</span><span class="o">=</span><span class="s2">&#34;/login&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">github</span><span class="o">.</span><span class="n">authorized</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&#34;github.login&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp</span> <span class="o">=</span> <span class="n">github</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;/user&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">ok</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;You have successfully logged in, </span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;login&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span></span></code></pre></div><h2 id="èµ„æ–™-5">èµ„æ–™</h2>
<ul>
<li><a href="https://developer.okta.com/blog/2019/10/21/illustrated-guide-to-oauth-and-oidc">An Illustrated Guide to OAuth and OpenID Connect</a></li>
<li><a href="https://mherman.org/presentations/node-oauth-openid/#1">Introduction to OAuth 2.0 and OpenID Connect</a></li>
<li><a href="https://realpython.com/flask-google-login/">Create a Flask Application With Google Login</a></li>
<li><a href="https://learndjango.com/tutorials/django-allauth-tutorial">Django-allauth Tutorial</a></li>
<li><a href="https://medium.com/data-rebels/fastapi-google-as-an-external-authentication-provider-3a527672cf33">FastAPI â€” Google as an external authentication provider</a></li>
</ul>
<h1 id="ç»“è®º">ç»“è®º</h1>
<p>åœ¨è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬è®¤è¯†äº†ä¸€äº›ä¸åŒçš„Webè®¤è¯æ–¹æ³•ï¼Œæ¯ä¸€ç§éƒ½æœ‰å„è‡ªçš„ä¼˜ç‚¹å’Œç¼ºç‚¹</p>
<p>åœ¨ä½•æ—¶ä½¿ç”¨å‘¢ï¼Ÿè¿™å°±éœ€è¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æï¼Œé€šå¸¸æœ‰å‡ æ¡è§„åˆ™</p>
<ul>
<li>å¯¹åˆ©ç”¨æœåŠ¡å™¨æ¨¡æ¿çš„Webåº”ç”¨ç¨‹åºï¼Œé€šè¿‡ç”¨æˆ·å¯†ç è¿›è¡Œä¼šè¯è®¤è¯æ˜¯æœ€åˆé€‚çš„ã€‚ä¹Ÿå¯ä»¥å¢åŠ OAuthå’ŒOpenIDä½œä¸ºå¦ä¸€ç§æ–¹å¼</li>
<li>å¯¹RESTfulAPIsæ¥è¯´ï¼Œæ— çŠ¶æ€çš„ä»¤ç‰ŒéªŒè¯æ–¹æ³•æ˜¯æœ€åˆé€‚çš„</li>
<li>å¦‚æœä½ æƒ³å¤„ç†é«˜åº¦æ•æ„Ÿçš„æ•°æ®ï¼Œä½ å¯èƒ½éœ€è¦åœ¨è®¤è¯è¿‡ç¨‹ä¸­æ·»åŠ OTPs</li>
</ul>
<p>æœ€åä½ è¦çŸ¥é“ï¼Œä¸Šè¿°çš„ä¾‹å­åªæ˜¯æ¥è§¦åˆ°äº†è®¤è¯çš„è¡¨çš®ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éœ€è¦æ›´æ·±å±‚çš„é…ç½®ã€‚</p>]]></content></item></channel></rss>