<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content="#494f5c"><meta name=msapplication-TileColor content="#494f5c"><meta itemprop=name content="诡异的nerdctl端口转发问题"><meta itemprop=description content="没有什么是重启解决不了的，如果有那就重启两次吧 由于某些原因，需要从Docker转到containerd上面来，为了保持和Docker相同的体"><meta itemprop=datePublished content="2023-03-16T10:40:57+08:00"><meta itemprop=dateModified content="2023-03-16T10:40:57+08:00"><meta itemprop=wordCount content="1124"><meta itemprop=image content="https://images.unsplash.com/photo-1615796153287-98eacf0abb13?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=774&q=80"><meta itemprop=keywords content="Container,"><meta property="og:title" content="诡异的nerdctl端口转发问题"><meta property="og:description" content="没有什么是重启解决不了的，如果有那就重启两次吧 由于某些原因，需要从Docker转到containerd上面来，为了保持和Docker相同的体"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.thinkmoe.icu/posts/%E8%AF%A1%E5%BC%82%E7%9A%84nerdctl%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E9%97%AE%E9%A2%98/"><meta property="og:image" content="https://images.unsplash.com/photo-1615796153287-98eacf0abb13?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=774&q=80"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-03-16T10:40:57+08:00"><meta property="article:modified_time" content="2023-03-16T10:40:57+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://images.unsplash.com/photo-1615796153287-98eacf0abb13?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=774&q=80"><meta name=twitter:title content="诡异的nerdctl端口转发问题"><meta name=twitter:description content="没有什么是重启解决不了的，如果有那就重启两次吧 由于某些原因，需要从Docker转到containerd上面来，为了保持和Docker相同的体"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><title>诡异的nerdctl端口转发问题</title><link rel=stylesheet href=https://blog.thinkmoe.icu/css/style.min.7debdcf19d586386682f3c48bb90b3570a5a865f3ccc32856007b524691ce795.css integrity="sha256-fevc8Z1YY4ZoLzxIu5CzVwpahl88zDKFYAe1JGkc55U=" crossorigin=anonymous><style>.bg-img{background-image:url(https://images.unsplash.com/photo-1615796153287-98eacf0abb13?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=774&q=80)}</style></head><body id=page><header id=site-header class="animated slideInUp"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=https://blog.thinkmoe.icu>狸猫窝</a></div><nav class="site-nav hide-in-mobile"><a href=https://blog.thinkmoe.icu/posts/>Posts</a>
<a href=https://blog.thinkmoe.icu/tags/>Tags</a>
<a href=https://blog.thinkmoe.icu/about-me/>About</a></nav></div><div class="hdr-right hdr-icons"><button id=img-btn class=hdr-btn title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-image"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg></button><span class="hdr-social hide-in-mobile"><a href=https://github.com/miRemid target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></span><button id=menu-btn class=hdr-btn title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=https://blog.thinkmoe.icu/posts/>Posts</a></li><li><a href=https://blog.thinkmoe.icu/tags/>Tags</a></li><li><a href=https://blog.thinkmoe.icu/about-me/>About</a></li></ul></div><div class=bg-img></div><main class="site-main section-inner animated fadeIn faster"><article class=thin><header class=post-header><div class=post-meta><span>Mar 16, 2023</span></div><h1>诡异的nerdctl端口转发问题</h1></header><div class=content><blockquote><p>没有什么是重启解决不了的，如果有那就重启两次吧</p></blockquote><p>由于某些原因，需要从Docker转到containerd上面来，为了保持和Docker相同的体验选择Nerdctl作为cli工具</p><p>但是在安装之后运行简单的nginx测试时出现了网络问题</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>nerdctl pull nginx:alpine
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>nerdctl run -d --name nginx -p 80:80 nginx:alpine
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>➜  ~ nerdctl ps
</span></span><span class=line><span class=cl>CONTAINER ID    IMAGE                             COMMAND                   CREATED          STATUS    PORTS                 NAMES
</span></span><span class=line><span class=cl>25ec8773aa63    docker.io/library/nginx:alpine    <span class=s2>&#34;/docker-entrypoint.…&#34;</span>    <span class=m>5</span> minutes ago    Up        0.0.0.0:80-&gt;80/tcp    nginx
</span></span></code></pre></div><p>从打印的日志上来看，当前Nerdctl已经将nginx容器的80端口转发到宿主机的80端口，在宿主机的shell中使用curl访问80端口也能正常访问</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜  ~ curl http://localhost:80
</span></span><span class=line><span class=cl>&lt;!DOCTYPE html&gt;
</span></span><span class=line><span class=cl>&lt;html&gt;
</span></span><span class=line><span class=cl>&lt;head&gt;
</span></span><span class=line><span class=cl>&lt;title&gt;Welcome to nginx!&lt;/title&gt;
</span></span><span class=line><span class=cl>&lt;style&gt;
</span></span><span class=line><span class=cl>html <span class=o>{</span> color-scheme: light dark<span class=p>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>body <span class=o>{</span> width: 35em<span class=p>;</span> margin: <span class=m>0</span> auto<span class=p>;</span>
</span></span><span class=line><span class=cl>font-family: Tahoma, Verdana, Arial, sans-serif<span class=p>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>&lt;/style&gt;
</span></span><span class=line><span class=cl>&lt;/head&gt;
</span></span><span class=line><span class=cl>&lt;body&gt;
</span></span><span class=line><span class=cl>&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
</span></span><span class=line><span class=cl>&lt;p&gt;If you see this page, the nginx web server is successfully installed and
</span></span><span class=line><span class=cl>working. Further configuration is required.&lt;/p&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;p&gt;For online documentation and support please refer to
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;http://nginx.org/&#34;</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
</span></span><span class=line><span class=cl>Commercial support is available at
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;http://nginx.com/&#34;</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;p&gt;&lt;em&gt;Thank you <span class=k>for</span> using nginx.&lt;/em&gt;&lt;/p&gt;
</span></span><span class=line><span class=cl>&lt;/body&gt;
</span></span><span class=line><span class=cl>&lt;/html&gt;
</span></span></code></pre></div><p>但是从宿主机外部访问时，却怎么也访问不到</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>curl http://10.0.8.9:80
</span></span></code></pre></div><p>但是我换Docker则一切正常</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>docker pull nginx:alpine
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>docker run -d --name nginx -p 80:80 nginx:alpine
</span></span><span class=line><span class=cl>curl http://10.0.8.9:80
</span></span></code></pre></div><p>检查iptables可以发现，nerdctl已经帮我们把nerdctl创建的网桥转发出去了</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 这是还没创建容器时的iptables</span>
</span></span><span class=line><span class=cl>➜  ~ iptables --list-rules
</span></span><span class=line><span class=cl>-P INPUT ACCEPT
</span></span><span class=line><span class=cl>-P FORWARD DROP
</span></span><span class=line><span class=cl>-P OUTPUT ACCEPT
</span></span><span class=line><span class=cl>-N CNI-ADMIN
</span></span><span class=line><span class=cl>-N CNI-FORWARD
</span></span><span class=line><span class=cl>-N CNI-ISOLATION-STAGE-1
</span></span><span class=line><span class=cl>-N CNI-ISOLATION-STAGE-2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>-A FORWARD -m comment --comment <span class=s2>&#34;CNI firewall plugin rules (ingressPolicy: same-bridge)&#34;</span> -j CNI-ISOLATION-STAGE-1
</span></span><span class=line><span class=cl>-A FORWARD -m comment --comment <span class=s2>&#34;CNI firewall plugin rules&#34;</span> -j CNI-FORWARD
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>-A CNI-FORWARD -m comment --comment <span class=s2>&#34;CNI firewall plugin admin overrides&#34;</span> -j CNI-ADMIN
</span></span><span class=line><span class=cl>-A CNI-ISOLATION-STAGE-1 -i nerdctl0 ! -o nerdctl0 -m comment --comment <span class=s2>&#34;CNI firewall plugin rules (ingressPolicy: same-bridge)&#34;</span> -j CNI-ISOLATION-STAGE-2
</span></span><span class=line><span class=cl>-A CNI-ISOLATION-STAGE-1 -m comment --comment <span class=s2>&#34;CNI firewall plugin rules (ingressPolicy: same-bridge)&#34;</span> -j RETURN
</span></span><span class=line><span class=cl>-A CNI-ISOLATION-STAGE-2 -o nerdctl0 -m comment --comment <span class=s2>&#34;CNI firewall plugin rules (ingressPolicy: same-bridge)&#34;</span> -j DROP
</span></span><span class=line><span class=cl>-A CNI-ISOLATION-STAGE-2 -m comment --comment <span class=s2>&#34;CNI firewall plugin rules (ingressPolicy: same-bridge)&#34;</span> -j RETURN
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 当创建nginx容器之后的iptables</span>
</span></span><span class=line><span class=cl>-P INPUT ACCEPT
</span></span><span class=line><span class=cl>-P FORWARD DROP
</span></span><span class=line><span class=cl>-P OUTPUT ACCEPT
</span></span><span class=line><span class=cl>-N CNI-ADMIN
</span></span><span class=line><span class=cl>-N CNI-FORWARD
</span></span><span class=line><span class=cl>-N CNI-ISOLATION-STAGE-1
</span></span><span class=line><span class=cl>-N CNI-ISOLATION-STAGE-2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>-A FORWARD -m comment --comment <span class=s2>&#34;CNI firewall plugin rules (ingressPolicy: same-bridge)&#34;</span> -j CNI-ISOLATION-STAGE-1
</span></span><span class=line><span class=cl>-A FORWARD -m comment --comment <span class=s2>&#34;CNI firewall plugin rules&#34;</span> -j CNI-FORWARD
</span></span><span class=line><span class=cl>-A FORWARD -j DOCKER-USER
</span></span><span class=line><span class=cl>-A FORWARD -j DOCKER-ISOLATION-STAGE-1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>-A CNI-FORWARD -m comment --comment <span class=s2>&#34;CNI firewall plugin admin overrides&#34;</span> -j CNI-ADMIN
</span></span><span class=line><span class=cl>-A CNI-FORWARD -d 10.4.0.8/32 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
</span></span><span class=line><span class=cl>-A CNI-FORWARD -s 10.4.0.8/32 -j ACCEPT
</span></span><span class=line><span class=cl>-A CNI-ISOLATION-STAGE-1 -i nerdctl0 ! -o nerdctl0 -m comment --comment <span class=s2>&#34;CNI firewall plugin rules (ingressPolicy: same-bridge)&#34;</span> -j CNI-ISOLATION-STAGE-2
</span></span><span class=line><span class=cl>-A CNI-ISOLATION-STAGE-1 -m comment --comment <span class=s2>&#34;CNI firewall plugin rules (ingressPolicy: same-bridge)&#34;</span> -j RETURN
</span></span><span class=line><span class=cl>-A CNI-ISOLATION-STAGE-2 -o nerdctl0 -m comment --comment <span class=s2>&#34;CNI firewall plugin rules (ingressPolicy: same-bridge)&#34;</span> -j DROP
</span></span><span class=line><span class=cl>-A CNI-ISOLATION-STAGE-2 -m comment --comment <span class=s2>&#34;CNI firewall plugin rules (ingressPolicy: same-bridge)&#34;</span> -j RETURN
</span></span></code></pre></div><p>可以发现，nerdctl帮助我们为nginx容器创建了两条iptables规则，检查nginx容器的ip地址可以发现与上述规则是对应的</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜  ~ nerdctl inspect nginx
</span></span><span class=line><span class=cl><span class=o>[</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Id&#34;</span>: <span class=s2>&#34;029f32038d2ab668cae206620b83f143fa799638d6fd623808aa55175825b251&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Created&#34;</span>: <span class=s2>&#34;2023-03-16T02:58:34.799160852Z&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Path&#34;</span>: <span class=s2>&#34;/docker-entrypoint.sh&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Args&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;nginx&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;-g&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;daemon off;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>]</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;State&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Status&#34;</span>: <span class=s2>&#34;running&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Running&#34;</span>: true,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Paused&#34;</span>: false,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Restarting&#34;</span>: false,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Pid&#34;</span>: 1552,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;ExitCode&#34;</span>: 0,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;FinishedAt&#34;</span>: <span class=s2>&#34;0001-01-01T00:00:00Z&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Image&#34;</span>: <span class=s2>&#34;docker.io/library/nginx:alpine&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ResolvConfPath&#34;</span>: <span class=s2>&#34;/var/lib/nerdctl/1935db59/containers/default/029f32038d2ab668cae206620b83f143fa799638d6fd623808aa55175825b251/resolv.conf&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;HostnamePath&#34;</span>: <span class=s2>&#34;/var/lib/nerdctl/1935db59/containers/default/029f32038d2ab668cae206620b83f143fa799638d6fd623808aa55175825b251/hostname&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;LogPath&#34;</span>: <span class=s2>&#34;/var/lib/nerdctl/1935db59/containers/default/029f32038d2ab668cae206620b83f143fa799638d6fd623808aa55175825b251/029f32038d2ab668cae206620b83f143fa799638d6fd623808aa55175825b251-json.log&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Name&#34;</span>: <span class=s2>&#34;nginx&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;RestartCount&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Driver&#34;</span>: <span class=s2>&#34;overlayfs&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Platform&#34;</span>: <span class=s2>&#34;linux&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;AppArmorProfile&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Mounts&#34;</span>: null,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Config&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>          ...
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;NetworkSettings&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Ports&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;80/tcp&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>                    <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;HostIp&#34;</span>: <span class=s2>&#34;0.0.0.0&#34;</span>,
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;HostPort&#34;</span>: <span class=s2>&#34;80&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=o>}</span>
</span></span><span class=line><span class=cl>                <span class=o>]</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;GlobalIPv6Address&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;GlobalIPv6PrefixLen&#34;</span>: 0,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;IPAddress&#34;</span>: <span class=s2>&#34;10.4.0.8&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;IPPrefixLen&#34;</span>: 24,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;MacAddress&#34;</span>: <span class=s2>&#34;02:52:2f:d9:d2:52&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Networks&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;unknown-eth0&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;IPAddress&#34;</span>: <span class=s2>&#34;10.4.0.8&#34;</span>, <span class=c1># IP地址</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;IPPrefixLen&#34;</span>: 24,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;GlobalIPv6Address&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;GlobalIPv6PrefixLen&#34;</span>: 0,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;MacAddress&#34;</span>: <span class=s2>&#34;02:52:2f:d9:d2:52&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span></code></pre></div><p>按道理按照规则<code>-A CNI-FORWARD -s 10.4.0.8/32 -j ACCEPT</code>已经可以从外部访问80端口的服务了，但是怎么都行不通，所以干脆手动添加一条iptable规则吧，直接指定转发80端口出去</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜  ~ iptables -A CNI-FORWARD -p tcp -m tcp --dport <span class=m>80</span> -j ACCEPT
</span></span></code></pre></div><p>这时，访问对应地址的80端口就可以访问服务了，但这明显只是一个临时解决方案，那如何彻底解决呢？直到我找到这个<a href=https://github.com/containerd/nerdctl/issues/1048#issuecomment-1325991013>issue</a>&mldr;</p><p>没有什么是重启解决不了的，如果有那就重启两次！重启之后，删除刚才临时添加的iptable之后测试直接启动nginx服务，发现就可以从外部访问了🤣</p></div><hr class=post-end><footer class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://blog.thinkmoe.icu/tags/container>Container</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2023-03-16 02:40 +0000</p></footer></article><div class="post-nav thin"><a class=prev-post href=https://blog.thinkmoe.icu/posts/topk%E9%9D%A2%E8%AF%95%E9%A2%981/><span class=post-nav-label>&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></span><br><span>TopK面试题1</span></a></div><div id=comments class=thin></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2023 <a href=https://blog.thinkmoe.icu>miRemid</a> &#183; <a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank rel=noopener>CC BY-NC 4.0</a></p><p>Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=https://blog.thinkmoe.icu/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></footer><script src=https://blog.thinkmoe.icu/js/bundle.min.580988ed2982bcbb74a1773c7abea97b43e4c43b9324e10cda0813ec6ec4bb67.js integrity="sha256-WAmI7SmCvLt0oXc8er6pe0PkxDuTJOEM2ggT7G7Eu2c=" crossorigin=anonymous></script></body></html>